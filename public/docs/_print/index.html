<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=64853&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="//localhost:64853/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="//localhost:64853/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>krkn-chaos | Krkn</title>
<meta name="description" content="Krkn Chaos Tool">
<meta property="og:url" content="//localhost:64853/docs/">
  <meta property="og:site_name" content="Krkn">
  <meta property="og:title" content="krkn-chaos">
  <meta property="og:description" content="Chaos and resiliency testing tool for Kubernetes with a focus on improving performance under failure conditions. A CNCF sandbox project. Github">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="krkn-chaos">
  <meta itemprop="description" content="Chaos and resiliency testing tool for Kubernetes with a focus on improving performance under failure conditions. A CNCF sandbox project. Github">
  <meta itemprop="dateModified" content="2024-09-16T09:27:31-04:00">
  <meta itemprop="wordCount" content="21">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="krkn-chaos">
  <meta name="twitter:description" content="Chaos and resiliency testing tool for Kubernetes with a focus on improving performance under failure conditions. A CNCF sandbox project. Github">
<link href="/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/prism.css"/>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><defs><style>.cls-1{fill:none}.cls-1,.cls-2,.cls-3,.cls-4,.cls-5,.cls-6,.cls-7,.cls-8{stroke-width:0}.cls-3{fill:#0e58a0}.cls-4{fill:#0d58a1}.cls-5{fill:#102d4f}.cls-6{fill:#9b1c1f}.cls-7{fill:#fff}.cls-8{fill:#ec1c24}</style></defs><path class="cls-3" d="M163.75 116.65l-1.36.66c.57-.17 1.15-.32 1.73-.48l-.37-.18z"/><path class="cls-3" d="M133 133.87h0q.72.61.0.0z"/><polygon class="cls-8" points="133 133.87 147.09 124.7 133 133.87 133 133.87"/><path class="cls-8" d="M124.41 150.23l3.24-12.87 5.36-3.49 14.09-9.17v-.02l12.83-6.18 2.47-1.19c-2.4.69-4.75 1.48-7.06 2.25-3.11 1.04-6.13 2.05-9.09 2.77l-1.51-4.27c-1.64-4.1-3.34-9.2-4.98-14.56.74-4.26.97-8.66.72-13.04.92.34 1.86.65 2.83.9 6.74 1.69 13.32.05 17.61-4.39 4.76-4.92 6.22-13.03 3.74-20.65-1.97-6.05-5.76-10.64-9.11-14.68l-.39-.48-10.48-8.4c-2.6-2.08-6.38-1.67-8.47.93-2.08 2.59-1.67 6.38.93 8.47l9.51 7.63c2.67 3.23 5.34 6.58 6.55 10.27 1.05 3.22.64 6.9-.95 8.55-1.48 1.53-4.08 1.56-6.02 1.07-2.7-.68-5.46-2.34-8.37-4.1-.11-.07-.22-.13-.32-.19-.7-2.04-1.52-4.03-2.47-5.94-10.92-22.15-37.7-31.28-59.8-20.38-22.1 10.9-31.17 37.69-20.25 59.85 4.99 10.12 14.09 18.58 24.61 23.75l1.1 10.21c-.41 4.17-.89 8.43-2.65 11.89-1.54 3.02-4.43 5.32-6.72 5.36h-.06c-2.11.0-3.94-1.8-4.95-3.5-1.43-2.39-2.19-5.52-3.01-8.83-.13-.51-.25-1.02-.38-1.53-1.32-5.25-3.18-11.31-6.97-16.41-3.27-4.39-7.43-7.25-12.03-8.26-5.44-1.19-10.48.36-13.75 1.86-4.16 1.92-7.57 4.69-10.07 6.89s-2.74 6-.54 8.5c2.2 2.5 6 2.74 8.5.54 2.8-2.46 5-4 7.15-4.99 2.23-1.02 4.47-1.4 6.14-1.04 2.18.48 3.89 2.26 4.94 3.67 2.52 3.39 3.87 7.85 4.96 12.16.12.49.24.98.36 1.46.94 3.84 2.01 8.18 4.36 12.12 3.51 5.89 9.21 9.38 15.3 9.38.08.0.16.0.25.0 6.85-.11 13.62-4.79 17.26-11.93 2.89-5.67 3.46-11.59 3.97-16.82l.06-.61-.33-3.02c2.07 2.29 4.06 4.75 5.87 7.35.44 3.01.79 5.93 1.01 8.43.24 7.96-.97 12.64-3.8 14.71-1.38 1.01-3.42 1.58-5.77 2.24-1.49.42-3.03.85-4.61 1.46-11.1 4.23-18.84 15.49-18.81 27.37.0 3.32 2.7 6.01 6.02 6.01h.01c3.33.0 6.02-2.71 6.01-6.04-.01-6.87 4.64-13.64 11.06-16.09 1.08-.41 2.29-.75 3.58-1.12 3.03-.85 6.47-1.82 9.61-4.11 8.37-6.1 8.99-17.19 8.74-25l-.02-.32c-.06-.72-.18-1.93-.35-3.49l.13-.31.84.31c.01 1.03.29 2.07.85 3.01 3.23 5.38 3.3 12.64.17 18.08-.95 1.65-2.23 3.29-3.6 5.02-2.59 3.3-5.52 7.03-6.86 11.89-2.57 9.32 1.89 18.34 4.84 24.3 1.05 2.12 3.18 3.36 5.4 3.36.9.0 1.81-.2 2.66-.63 2.98-1.47 4.2-5.09 2.73-8.07-2.83-5.73-5.27-11.25-4.02-15.77.69-2.53 2.56-4.9 4.72-7.65.22-.28.44-.56.66-.84.92-1.18 1.84-2.39 2.71-3.69.42-.62.82-1.26 1.2-1.93 4.53-7.88 5.1-17.68 1.77-26.07h0c-.24-.61-.51-1.22-.79-1.81"/><path class="cls-8" d="M125.27 152.2c-.24-.61-.51-1.22-.79-1.81.28.6.55 1.2.79 1.81z"/><polygon class="cls-8" points="133 133.87 127.64 137.36 133 133.87 133 133.87"/><path class="cls-7" d="M109.05 60.27c10.17 5.87 16.58 14.81 16.72 22.23 3.48-7.92-2.18-19.01-13.23-25.4-8.92-5.15-18.74-5.72-24.89-2.09 6.21-.75 14.01.98 21.41 5.25z"/><ellipse class="cls-7" cx="124.64" cy="108.25" rx="4.78" ry="5.91"/><circle class="cls-2" cx="126.13" cy="111.92" r="2.42"/><path class="cls-7" d="M115.8 130.96c.85-.76 1.86-1.52 3.05-2.22-3.01-.86-12.56-3.14-13.32 2.08.0.0-.81 2.32 7.25 3.67.28-.44.63-.95 1.09-1.51l1.92-2.02z"/><path class="cls-2" d="M128.78 125.87c-4.22.28-7.47 1.44-9.93 2.87-1.2.7-2.21 1.46-3.05 2.22l-4.43-1.05c-.65-.16-1.3.25-1.45.89-.15.65.25 1.3.89 1.45l3.06.72c-.45.56-.81 1.07-1.09 1.51-.49.77-.73 1.3-.76 1.39-.26.61.02 1.31.63 1.58.16.07.32.1.48.1.47.0.91-.27 1.11-.73.14-.32 3.54-7.83 14.71-8.56.66-.04 1.17-.62 1.12-1.28-.04-.66-.62-1.16-1.28-1.12z"/><path class="cls-2" d="M80.49 116.01c.54-2.16 2.42-3.9 4.67-4.1 2.96-.26 5.7 1.9 8.24 3.08 2.89 1.35 6.87 3.08 9.93 1.27 3.06-1.82 2.93-6.13-.39-7.51-1-.42-2.21.45-2.47 1.4-.32 1.15.4 2.05 1.4 2.47.67.28-.45-.25-.32-.23.65.09-.17.34.03.13-.26.27-.48.41-.87.48-1.21.2-2.61-.43-3.71-.83-2.71-.99-5.09-2.68-7.82-3.64-2.64-.93-5.48-.86-7.96.49-2.26 1.23-3.97 3.42-4.6 5.91-.63 2.51 3.24 3.58 3.87 1.07h0z"/><path class="cls-4" d="M71.99 65.75 55.66 50.84S31.43 66.09 37.64 85.85l19.46 7.44s14.67-24.51 14.89-27.53z"/><path class="cls-6" d="M57.17 93.18l-.07.1c.36 4.79 2.63 7.89 5.31 9.9 3.72 2.79 9.04.19 9.06-4.46.02-6.87.95-16.03 1.7-22.41-.61 2.13-1.57 4.39-2.86 6.63-3.89 6.73-9.45 10.94-13.14 10.23z"/><path class="cls-4" d="M73.95 70.21c-.03-.34-.07-.66-.13-.97-.3-1.66-1.02-2.93-2.18-3.6-3.59-2.07-10 2.32-14.32 9.81-4.32 7.49-4.92 15.24-1.34 17.31.36.21.76.34 1.18.42 3.69.71 9.26-3.5 13.14-10.23 1.29-2.24 2.25-4.5 2.86-6.63.65-2.25.92-4.35.78-6.11z"/><ellipse class="cls-5" cx="48.91" cy="70.52" rx="15.66" ry="7.5" transform="translate(-36.62 77.62) rotate(-60)"/><path class="cls-2" d="M96.23 128.29c-.63.0-1.16-.48-1.2-1.12.0-.12-.17-2.97 2.19-5.08 2.33-2.07 6.15-2.64 11.38-1.69.65.12 1.09.75.97 1.4s-.75 1.08-1.4.97c-4.37-.8-7.59-.43-9.31 1.09-1.49 1.31-1.42 3.08-1.42 3.15.03.66-.47 1.23-1.13 1.27-.02.0-.05.0-.07.0z"/><path class="cls-4" d="M45.67 79.05s-6.32-13.34 9.3-15.44c0 0 .88 9.3-9.3 15.44z"/><path class="cls-7" d="M66.44 80.81c-.08.0-.16-.02-.23-.07l-7.44-5.27c-.18-.13-.22-.38-.1-.56.13-.18.38-.22.56-.1l7.44 5.27c.18.13.22.38.1.56-.08.11-.2.17-.33.17z"/><path class="cls-7" d="M61.37 83.61c-.22.0-.4-.18-.4-.4s.18-.4.4-.4c2.12.0 3.68-.62 4.64-1.86 1.89-2.43.89-6.45.88-6.49-.05-.21.08-.43.29-.49.21-.06.43.08.49.29.05.18 1.1 4.45-1.02 7.18-1.12 1.44-2.89 2.17-5.27 2.17z"/><path class="cls-7" d="M59.92 80.51c-.07.0-.15-.02-.21-.06-.19-.12-.25-.36-.13-.55l3.68-5.94c.12-.19.37-.24.55-.13.19.12.25.36.13.55l-3.68 5.94c-.08.12-.21.19-.34.19z"/><path class="cls-3" d="M133 133.87l-5.36 3.49-3.24 12.87c.03.05.05.11.07.16.28.6.55 1.2.79 1.81h0c3.33 8.39 2.76 18.18-1.77 26.07-.38.67-.79 1.31-1.2 1.93-.87 1.3-1.79 2.51-2.71 3.69l19.75 24.77 2.65 3.33h43.52l2.65-3.33 3.87-4.86-2.11-4.44-2.11-4.44-1.53-3.21 5.22-1.42 1.9-.52.81-2.88 1.46-5.22 2.26.55 4.73 1.16 4.73 1.16 2.59-3.25 2.65-3.33-.95-4.15-5.08-22.27-2.71-11.87-.95-4.15-3.83-1.85-31.54-15.19-3.46-1.67c-.58.15-1.16.31-1.73.48l-2.47 1.19-12.84 6.18v.02l-14.08 9.17"/><path class="cls-7" d="M176.83 169.95c.1-.37.43-.63.81-.63h4.41c.14-.9.21-1.77.21-2.65s-.07-1.74-.21-2.65h-4.41c-.38.0-.72-.26-.81-.63-.31-1.18-.78-2.31-1.4-3.35-.2-.33-.14-.75.13-1.02l3.11-3.11c-1.07-1.43-2.33-2.68-3.76-3.73l-3.13 3.13c-.27.27-.69.32-1.01.13-1.03-.6-2.15-1.05-3.33-1.34-.37-.09-.64-.43-.64-.82v-4.39c-1.84-.27-3.52-.25-5.29.03v4.43c0 .38-.25.71-.62.81-1.14.31-2.23.77-3.24 1.37-.33.2-.75.15-1.02-.13l-3.11-3.11c-1.43 1.07-2.68 2.33-3.73 3.76l3.13 3.13c.27.27.32.69.13 1.02-.58.99-1.02 2.08-1.32 3.21-.1.37-.43.63-.81.63h-4.41c-.14.9-.21 1.77-.21 2.65s.07 1.74.21 2.65h4.41c.38.0.72.26.81.63.3 1.14.74 2.22 1.32 3.21.19.33.14.75-.13 1.02l-3.13 3.13c1.05 1.43 2.3 2.68 3.73 3.76l3.11-3.11c.27-.27.7-.32 1.02-.13 1.01.6 2.1 1.06 3.24 1.37.37.1.62.43.62.81v4.43c1.77.28 3.45.3 5.29.03v-4.39c0-.39.26-.72.64-.82 1.17-.29 2.29-.75 3.33-1.34.33-.19.74-.14 1.01.13l3.13 3.13c1.43-1.05 2.69-2.3 3.76-3.73l-3.11-3.11c-.27-.27-.32-.69-.13-1.02.62-1.04 1.09-2.17 1.4-3.35zM164.28 174.34c-4.23.0-7.67-3.44-7.67-7.67s3.44-7.67 7.67-7.67 7.67 3.44 7.67 7.67-3.44 7.67-7.67 7.67z"/><polygon class="cls-5" points="195.75 132.09 189.83 137.14 192.61 143.99 180.11 144.21 191.23 147.66 189.37 154.85 195.84 146.32 193.15 138.65 200.11 134.06 195.75 132.09"/><polygon class="cls-5" points="126.43 142.34 133.2 146.69 139.04 142.17 142.63 154.14 142.95 142.5 150.38 142.35 140.41 138.43 133.75 143.09 127.55 137.77 126.43 142.34"/><polygon class="cls-5" points="141.99 211.98 151.62 206.63 147.49 195.75 149.23 193.05 153.13 187.67 143.3 194.01 147.65 204.83 138.76 207.97 141.99 211.98"/><path class="cls-1" d="M125.19 96.63c-6.01.0-10.89 4.89-10.89 10.89s4.89 10.89 10.89 10.89 10.89-4.89 10.89-10.89-4.89-10.89-10.89-10.89z"/><path class="cls-2" d="M158.9 109.67h9.99c1.33.0 2.41-1.08 2.41-2.41s-1.08-2.41-2.41-2.41h-5.48c-1.71 1.37-3.22 2.99-4.5 4.82z"/><path class="cls-8" d="M213.42 121.88l-.06.08c-.57-19.01-16.2-34.3-35.35-34.3-12.46.0-23.94 6.56-30.32 17.19-.24.4-.49.79-.71 1.2-.63 1.15-.84 2.41-.69 3.62.23 1.86 1.31 3.59 3.08 4.56 2.92 1.6 6.58.53 8.18-2.39.41-.76.88-1.48 1.36-2.17 1.28-1.83 2.8-3.45 4.5-4.82 4.08-3.27 9.2-5.14 14.6-5.14 12.86.0 23.33 10.47 23.33 23.33.0 2.63-.13 3.57-.77 5.61-.21.68-.29 1.37-.26 2.05-7.77-8.95-17.68-16.91-29.9-15.17-2.15.31-4.24.76-6.29 1.31l3.46 1.67 31.54 15.19 3.83 1.85.95 4.15 2.71 11.87c.49-.19.97-.42 1.42-.75 2.69-1.96 3.29-5.72 1.33-8.41-.17-.24-.35-.48-.52-.72 1.88-3.42 2.99-7.38 3.64-10.85.75-2.8.9-4.87.9-7.78.0-.01.0-.02.0-.03.03-.71.03-1.12.03-1.12z"/><path class="cls-2" d="M147.69 104.85h-7.04c-1.28-7.39-7.72-13.04-15.47-13.04-8.66.0-15.71 7.05-15.71 15.71s7.05 15.71 15.71 15.71c7.94.0 14.5-5.92 15.55-13.57h5.55c-.15-1.21.06-2.47.69-3.62.22-.41.47-.8.71-1.2zm-22.5 13.57c-6.01.0-10.89-4.89-10.89-10.89s4.89-10.89 10.89-10.89 10.89 4.89 10.89 10.89-4.89 10.89-10.89 10.89z"/><polygon class="cls-4" points="23.71 152.66 40.01 153.84 40.9 145.48 47.6 142.38 39.37 130.63 20.5 143.35 23.71 152.66"/></svg></span><span class="navbar-brand__name">Krkn</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/blog/"><span>Blog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/community/"><span>Community</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/krkn-chaos/" target="_blank" rel="noopener"><i class='fab fa-github'></i> <span>Github</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">krkn-chaos</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-f3b56000093113bd3bfb6c9c05e7e945">krkn</a></li>


    
  
    
    
	
<li>2: <a href="#pg-273a1d3f87830cbffaaf95a64d1ab7e6">Installation</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-8c9605482c6e59ce227f8b5d30f4cf72">Krkn</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-9f1e7b14395487f38a6774585d9f101c">krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-ed5e4e2a5768b77b50e8f92bb406319b">Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-c519395ea211e39cc6cc5ef047185c90">Application Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1.1: <a href="#pg-c6685cc58811d9965da768590d1c7b36">Application Outage Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.1.2: <a href="#pg-56794da11c19d01c8746a72290b04ae1">Application outage Scenario using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-a0f3c55c3812d8d9972fb401fa90997f">Arcaflow Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.2.1: <a href="#pg-3b6badec7f06927507195203795ebd14">Arcaflow Scenarios using Krkn</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.3: <a href="#pg-5b042b0ace5c7a9fddf4314f18cffbe8">Container Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.3.1: <a href="#pg-6b0970e4eb72407e459e00dcf868edd0">Container Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.3.2: <a href="#pg-93508b71407800a4fd12c130146c8c29">Container Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.4: <a href="#pg-453f0d3bacab710a741dfc6447534e67">CPU Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.4.1: <a href="#pg-c35b125e7cb7975c42e6c99f8e45340a">CPU Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.4.2: <a href="#pg-f182958d88fb20776b8a10c969271e32">CPU Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.5: <a href="#pg-92869ed19e15fe8a8f9327d35eb0a8ef">IO Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.5.1: <a href="#pg-061db2db4cf2d6fb8b918615b8fd2dda">IO Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.5.2: <a href="#pg-3a7a19e3ba7417a217ade8504634e037">IO Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.6: <a href="#pg-f25a2b90c8720ca76c4391ef2a5779e8">ManagedCluster Scenarios</a></li>


    
  
    
    
	
<li>3.7: <a href="#pg-4afdb6f0fd755ca703a0d7520b8daf50">Memory Hog Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.7.1: <a href="#pg-dbc32c76f347cc59694c7aa38a113a33">Memory Hog Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.7.2: <a href="#pg-4235987e3f2a8cb2f643e68610a28e16">Memory Hog Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.8: <a href="#pg-993237ebf800e696ef64cc0a59b19cee">Network Chaos Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.8.1: <a href="#pg-6946ebccc0f4758c518336c6a1eab7ef">Network Chaos Scenario using Krkn</a></li>


    
  
    
    
	
<li>3.8.2: <a href="#pg-58617b5353469d215cd71c3a97f65a3d">Network Chaos Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.9: <a href="#pg-f16f359a8dea60e9d83ad2f901728e3d">Node Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.9.1: <a href="#pg-774f55781c04704bbc35442200005082">Node Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.9.2: <a href="#pg-41b7887a58c35ebdc959d9678afaee4b">Node Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.10: <a href="#pg-affd85910adbdf9ad08c6ed992c6bb14">Pod Network Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.10.1: <a href="#pg-3113de3ae94ded0c459e52ecda391a77">Pod Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.10.2: <a href="#pg-5edf70896392385f5e879c8c6af1559c">Pod Network Chaos Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.11: <a href="#pg-abccb6686f7f738ead88a179903bd631">Pod Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.11.1: <a href="#pg-95b830de59fc16f5bfb39617cfcd5402">Pod Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.11.2: <a href="#pg-dd864f90e71659610098eefe5ef8e784">Pod Scenarios using Krkn-hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.12: <a href="#pg-ce8b54635e230b2999da190ebd1e41be">Power Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.12.1: <a href="#pg-86b7bbcde807ac105b3ed9bf4854bc3d">Power Outage Scenario using Krkn</a></li>


    
  
    
    
	
<li>3.12.2: <a href="#pg-f78409366ed557faa404a782e364505b">Power Outage Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.13: <a href="#pg-894d789e8e0ad80e01add4fc659d4230">PVC Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.13.1: <a href="#pg-042a0835bd60597669c3f484912f9e1e">PVC Scenario using Krkn</a></li>


    
  
    
    
	
<li>3.13.2: <a href="#pg-a07e0c044e3bf878a9d652efab248a8a">PVC Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.14: <a href="#pg-71b2337dd184e179e48995c1b262ac17">Service Disruption Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.14.1: <a href="#pg-c229626aef295356c4fa6fb05ffe42db">Service Disruption Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.14.2: <a href="#pg-afd27124a9063adebb9970a5b2f94b01">Service Disruption Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.15: <a href="#pg-ce393854ff3da73a278e77f5f3f45ac4">Service Hijacking Scenario</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.15.1: <a href="#pg-0326ec69aa2cf1ccbeb0b57479a77dba">Service Hijacking Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.15.2: <a href="#pg-8645cf3ca8634c69a0c8ad7ac90fbe06">Service Hijacking Scenario using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.16: <a href="#pg-a4fbbfbd8b11ce2dd79180e169a6c09c">Time Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.16.1: <a href="#pg-4e099f299e4e2e9c590fc5a8f3dbdb1f">Time Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.16.2: <a href="#pg-f029f0161de9931fff733ccc2fde58e5">Time Skew Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.17: <a href="#pg-de67113eb2d27bfedac46c07b5c4db22">Zone Outage Scenarios</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.17.1: <a href="#pg-a98bdfa4b92598e3eeed675e2a73ea11">Zone Outage Scenarios using Krkn</a></li>


    
  
    
    
	
<li>3.17.2: <a href="#pg-ac460820001befdfa88a92bc5f36f753">Zone Outage Scenarios using Krkn-Hub</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.18: <a href="#pg-31dc471e07bb163ac298937597cfdea2">All Scenarios Variables</a></li>


    
  
    
    
	
<li>3.19: <a href="#pg-41ff6593888c87620d21a5a31c783466">Supported Cloud Providers</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-c0ffe4f5ae7990ffa2481add52e8ce49">Chaos Testing Guide</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-70fda4d115500a0f25e876b6cccb9693">Cerberus</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-2ff67b136c71c2a08174669fbf2d344d">Installation</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-72c880d1d638941a4e30e0c6916c8f47">Config</a></li>


    
  
    
    
	
<li>5.3: <a href="#pg-35bbedcac6771a21142e8ca78bc8e0ff">Example Report</a></li>


    
  
    
    
	
<li>5.4: <a href="#pg-4c228cfc2415b191b59fb8446f977274">Usage</a></li>


    
  
    
    
	
<li>5.5: <a href="#pg-757a8dd261ba40e0ca5b0593378a7086">Alerts</a></li>


    
  
    
    
	
<li>5.6: <a href="#pg-b190bfdc5464d39eeebf07936769c72a">Node Problem Detector</a></li>


    
  
    
    
	
<li>5.7: <a href="#pg-f6d34f30535049c05bb8b5e73a3d5b92">Slack Integration</a></li>


    
  
    
    
	
<li>5.8: <a href="#pg-6c4f8214a4098b69dd33dbf386bacb8a">Contribute</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-e28bedba0f169b3cc306e40f3a990286">Chaos Recommendation Tool</a></li>


    
  
    
    
	
<li>7: <a href="#pg-99a93ef9534d11fef4be3e4b3b1a6381">Contribution Guidelines</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-cb673d42652e2dadae972711a10addab">Testing your changes</a></li>


    
  
    
    
	
<li>7.2: <a href="#pg-17ea1d6a1e6627d08a7d6f4d2898cca1">Contributions</a></li>


    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-0021252844b4e6fe46ed5340a858b6d3">Krkn Roadmap</a></li>


    
  
    
    
	
<li>9: <a href="#pg-d39a8a737bc5c13f36e41aa92a0c7602"></a></li>


    
  
    
    
	
<li>10: <a href="#pg-a39c9f7aa728d5fa3b973bc6ba49228a"></a></li>


    
  
    
    
	
<li>11: <a href="#pg-8b98cd9a1c9e3bb7243f12e47e925f13"></a></li>


    
  

    </ul>


<div class="content">
      <p>Chaos and resiliency testing tool for Kubernetes with a focus on improving performance under failure conditions.
<strong>A CNCF sandbox project.</strong> <a href="https://github.com/krkn-chaos/">Github</a></p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f3b56000093113bd3bfb6c9c05e7e945">1 - krkn</h1>
    <div class="lead">Chaos and Resiliency Testing Tool for Kubernetes</div>
	<p><strong>krkn</strong> is a chaos and resiliency testing tool for Kubernetes. Kraken injects deliberate failures into Kubernetes clusters to check if it is resilient to turbulent conditions.</p>
<h2 id="why-do-i-want-it">Why do I want it?<a class="td-heading-self-link" href="#why-do-i-want-it" aria-label="Heading self-link"></a></h2>
<p>There are a couple of false assumptions that users might have when operating and running their applications in distributed systems:</p>
<ul>
<li><strong>The network is reliable</strong></li>
<li><strong>There is zero latency</strong></li>
<li><strong>Bandwidth is infinite</strong></li>
<li><strong>The network is secure</strong></li>
<li><strong>Topology never changes</strong></li>
<li><strong>The network is homogeneous</strong></li>
<li><strong>Consistent resource usage with no spikes</strong></li>
<li><strong>All shared resources are available from all places</strong></li>
</ul>
<p>Various assumptions led to a number of outages in production environments in the past. The services suffered from poor performance or were inaccessible to the customers, leading to missing Service Level Agreement uptime promises, revenue loss, and a degradation in the perceived reliability of said services.</p>
<p>How can we best avoid this from happening? This is where <strong>Chaos testing</strong> can add value</p>
<h3 id="workflow">Workflow<a class="td-heading-self-link" href="#workflow" aria-label="Heading self-link"></a></h3>
<p><img alt="Kraken workflow" src="/images/kraken-workflow.png"></p>
<h3 id="how-to-get-started">How to Get Started<a class="td-heading-self-link" href="#how-to-get-started" aria-label="Heading self-link"></a></h3>
<p>Instructions on how to setup, configure and run Kraken can be found at <a href="/docs/installation/">Installation</a>.</p>
<p>You may consider utilizing the chaos recommendation tool prior to initiating the chaos runs to profile the application service(s) under test. This tool discovers a list of Krkn scenarios with a high probability of causing failures or disruptions to your application service(s). The tool can be accessed at <a href="/docs/chaos-recommender/">Chaos-Recommender</a>.</p>
<p>See the <a href="/docs/getting-started/">getting started doc</a> on support on how to get started with your own custom scenario or editing current scenarios for your specific usage.</p>
<p>After installation, refer back to the below sections for supported scenarios and how to tweak the kraken config to load them on your cluster.</p>
<h4 id="running-kraken-with-minimal-configuration-tweaks">Running Kraken with minimal configuration tweaks<a class="td-heading-self-link" href="#running-kraken-with-minimal-configuration-tweaks" aria-label="Heading self-link"></a></h4>
<p>For cases where you want to run Kraken with minimal configuration changes, refer to <a href="https://github.com/krkn-chaos/krkn-hub">krkn-hub</a>. One use case is CI integration where you do not want to carry around different configuration files for the scenarios.</p>
<h3 id="config">Config<a class="td-heading-self-link" href="#config" aria-label="Heading self-link"></a></h3>
<p>Instructions on how to setup the config and the options supported can be found at <a href="/docs/config/">Config</a>.</p>
<h3 id="kraken-scenario-passfail-criteria-and-report">Kraken scenario pass/fail criteria and report<a class="td-heading-self-link" href="#kraken-scenario-passfail-criteria-and-report" aria-label="Heading self-link"></a></h3>
<p>It is important to make sure to check if the targeted component recovered from the chaos injection and also if the Kubernetes cluster is healthy as failures in one component can have an adverse impact on other components. Kraken does this by:</p>
<ul>
<li>Having built in checks for pod and node based scenarios to ensure the expected number of replicas and nodes are up. It also supports running custom scripts with the checks.</li>
<li>Leveraging <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster under test and consuming the aggregated go/no-go signal to determine pass/fail post chaos. It is highly recommended to turn on the Cerberus health check feature available in Kraken. Instructions on installing and setting up Cerberus can be found <a href="/docs/cerberus/">here</a> or can be installed from Kraken using the <a href="/docs/installation/">instructions</a>. Once Cerberus is up and running, set cerberus_enabled to True and cerberus_url to the url where Cerberus publishes go/no-go signal in the Kraken config file. Cerberus can monitor <a href="/docs/cerberus/config/">application routes</a> during the chaos and fails the run if it encounters downtime as it is a potential downtime in a customers, or users environment as well. It is especially important during the control plane chaos scenarios including the API server, Etcd, Ingress etc. It can be enabled by setting <code>check_applicaton_routes: True</code> in the <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml">Kraken config</a> provided application routes are being monitored in the <a href="https://github.com/redhat-chaos/krkn/blob/main/config/cerberus.yaml">cerberus config</a>.</li>
<li>Leveraging built-in alert collection feature to fail the runs in case of critical alerts.</li>
</ul>
<h3 id="signaling">Signaling<a class="td-heading-self-link" href="#signaling" aria-label="Heading self-link"></a></h3>
<p>In CI runs or any external job it is useful to stop Kraken once a certain test or state gets reached. We created a way to signal to kraken to pause the chaos or stop it completely using a signal posted to a port of your choice.</p>
<p>For example if we have a test run loading the cluster running and kraken separately running; we want to be able to know when to start/stop the kraken run based on when the test run completes or gets to a certain loaded state.</p>
<p>More detailed information on enabling and leveraging this feature can be found <a href="/docs/signal/">here</a>.</p>
<h3 id="performance-monitoring">Performance monitoring<a class="td-heading-self-link" href="#performance-monitoring" aria-label="Heading self-link"></a></h3>
<p>Monitoring the Kubernetes/OpenShift cluster to observe the impact of Kraken chaos scenarios on various components is key to find out the bottlenecks as it is important to make sure the cluster is healthy in terms if both recovery as well as performance during/after the failure has been injected. Instructions on enabling it can be found <a href="docs/performance_dashboards.md">here</a>.</p>
<h3 id="slos-validation-during-and-post-chaos">SLOs validation during and post chaos<a class="td-heading-self-link" href="#slos-validation-during-and-post-chaos" aria-label="Heading self-link"></a></h3>
<ul>
<li>In addition to checking the recovery and health of the cluster and components under test, Kraken takes in a profile with the Prometheus expressions to validate and alerts, exits with a non-zero return code depending on the severity set. This feature can be used to determine pass/fail or alert on abnormalities observed in the cluster based on the metrics.</li>
<li>Kraken also provides ability to check if any critical alerts are firing in the cluster post chaos and pass/fail&rsquo;s.</li>
</ul>
<p>Information on enabling and leveraging this feature can be found <a href="docs/SLOs_validation.md">here</a></p>
<h3 id="ocm--acm-integration">OCM / ACM integration<a class="td-heading-self-link" href="#ocm--acm-integration" aria-label="Heading self-link"></a></h3>
<p>Kraken supports injecting faults into <a href="https://open-cluster-management.io/">Open Cluster Management (OCM)</a> and <a href="https://www.krkn.com/en/technologies/management/advanced-cluster-management">Red Hat Advanced Cluster Management for Kubernetes (ACM)</a> managed clusters through <a href="docs/managedcluster_scenarios.md">ManagedCluster Scenarios</a>.</p>
<h2 id="where-should-i-go-next">Where should I go next?<a class="td-heading-self-link" href="#where-should-i-go-next" aria-label="Heading self-link"></a></h2>
<ul>
<li><a href="/docs/installation/">Installation</a>: Get started using krkn!</li>
<li><a href="/docs/scenarios/">Scenarios</a>: Check out the scenarios we offer!</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-273a1d3f87830cbffaaf95a64d1ab7e6">2 - Installation</h1>
    
	<!-- 

<div class="pageinfo pageinfo-primary">
<p>This is a placeholder page that shows you how to use this template site.</p>

</div>
 -->
<p>The following ways are supported to run Kraken:</p>
<ul>
<li>Standalone python program through Git.</li>
<li>Containerized version using either Podman or Docker as the runtime via <a href="/docs/installation/krkn-hub/">Krkn-hub</a></li>
<li>Kubernetes or OpenShift deployment ( unsupported )</li>
</ul>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    It is recommended to run Kraken external to the cluster ( Standalone or Containerized ) hitting the Kubernetes/OpenShift API as running it internal to the cluster might be disruptive to itself and also might not report back the results if the chaos leads to clusterâ€™s API server instability.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    To run Kraken on Power (ppc64le) architecture, build and run a containerized version by following the instructions given <a href="https://github.com/krkn-chaos/krkn/blob/main/containers/build_own_image-README.md">here</a>.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Helper functions for interactions in Krkn are part of <a href="https://github.com/krkn-chaos/krkn-lib">krkn-lib</a>. Please feel free to reuse and expand them as you see fit when adding a new scenario or expanding the capabilities of the current supported scenarios.

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8c9605482c6e59ce227f8b5d30f4cf72">2.1 - Krkn</h1>
    <div class="lead">Krkn aka Kraken</div>
	<h2 id="installation">Installation<a class="td-heading-self-link" href="#installation" aria-label="Heading self-link"></a></h2>
<h4 id="git">Git<a class="td-heading-self-link" href="#git" aria-label="Heading self-link"></a></h4>
<h6 id="clone-the-repository">Clone the repository<a class="td-heading-self-link" href="#clone-the-repository" aria-label="Heading self-link"></a></h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git clone https://github.com/krkn-chaos/krkn.git --branch &lt;release version&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">cd</span> krkn 
</span></span></code></pre></div><h6 id="install-the-dependencies">Install the dependencies<a class="td-heading-self-link" href="#install-the-dependencies" aria-label="Heading self-link"></a></h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python3.9 -m venv chaos
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">source</span> chaos/bin/activate
</span></span><span style="display:flex;"><span>$ pip3.9 install -r requirements.txt
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Make sure python3-devel and latest pip versions are installed on the system. The dependencies install has been tested with pip &gt;= 21.1.3 versions.

</div>

Where can your user find your project code? How can they install it (binaries, installable package, build from source)? Are there multiple options/versions they can install and how should they choose the right one for them?</p>
<h2 id="running-krkn">Running Krkn<a class="td-heading-self-link" href="#running-krkn" aria-label="Heading self-link"></a></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python3.9 run_kraken.py --config &lt;config_file_location&gt;
</span></span></code></pre></div><h2 id="run-containerized-version">Run containerized version<a class="td-heading-self-link" href="#run-containerized-version" aria-label="Heading self-link"></a></h2>
<p><a href="/docs/installation/krkn-hub/">Krkn-hub</a> is a wrapper that allows running Krkn chaos scenarios via podman or docker runtime with scenario parameters/configuration defined as environment variables.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9f1e7b14395487f38a6774585d9f101c">2.2 - krkn-hub</h1>
    <div class="lead">Krkn-hub aka kraken-hub</div>
	<!-- 

<div class="pageinfo pageinfo-primary">
<p>Krkn-hub aka kraken-hub</p>

</div>
 -->
<p>Hosts container images and wrapper for running scenarios supported by <a href="https://github.com/krkn-chaos/krkn/">Krkn</a>, a chaos testing tool for Kubernetes clusters to ensure it is resilient to failures. All we need to do is run the containers with the respective environment variables defined as supported by the scenarios without having to maintain and tweak files!</p>
<h2 id="set-up">Set Up<a class="td-heading-self-link" href="#set-up" aria-label="Heading self-link"></a></h2>
<p>You can use docker or podman to run kraken-hub</p>
<p>Install Podman your certain operating system based on these <a href="https://podman.io/docs/installation">instructions</a></p>
<p>or</p>
<p>Install <a href="https://docs.docker.com/engine/install/">Docker</a> on your system.</p>
<p>Docker is also supported but all variables you want to set (separate from the defaults) need to be set at the command line In the form <code>-e &lt;VARIABLE&gt;=&lt;value&gt;</code></p>
<p>You can take advantage of the <a href="https://github.com/krkn-chaos/krkn-hub/blob/main/get_docker_params.sh">get_docker_params.sh</a> script to create your parameters string This will take all environment variables and put them in the form &ldquo;-e =&rdquo; to make a long string that can get passed to the command</p>
<p>For example: <code>docker run $(./get_docker_params.sh) --net=host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/redhat-chaos/krkn-hub:power-outages</code></p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands: <code>kubectl config view &ndash;flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) &ndash;name=&lt;container_name&gt; &ndash;net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>


</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ed5e4e2a5768b77b50e8f92bb406319b">3 - Scenarios</h1>
    
	<h3 id="supported-chaos-scenarios">Supported chaos scenarios<a class="td-heading-self-link" href="#supported-chaos-scenarios" aria-label="Heading self-link"></a></h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/docs/scenarios/pod-scenario/">Pod failures</a></td>
<td>Injects pod failures</td>
</tr>
<tr>
<td><a href="/docs/scenarios/container-scenario/">Container failures</a></td>
<td>Injects container failures based on the provided kill signal</td>
</tr>
<tr>
<td><a href="/docs/scenarios/node-scenarios/">Node failures</a></td>
<td>Injects node failure through OpenShift/Kubernetes, cloud API&rsquo;s</td>
</tr>
<tr>
<td><a href="/docs/scenarios/zone-outage-scenarios/">zone outages</a></td>
<td>Creates zone outage to observe the impact on the cluster, applications</td>
</tr>
<tr>
<td><a href="/docs/scenarios/time-scenarios/">time skew</a></td>
<td>Skews the time and date</td>
</tr>
<tr>
<td><a href="/docs/scenarios/cpu-hog-scenario/">Node cpu hog</a></td>
<td>Hogs CPU on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/memory-hog-scenario/">Node memory hog</a></td>
<td>Hogs memory on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/io-hog-scenario/">Node IO hog</a></td>
<td>Hogs io on the targeted nodes</td>
</tr>
<tr>
<td><a href="/docs/scenarios/service-disruption-scenarios/">Service Disruption</a></td>
<td>Deleting all objects within a namespace</td>
</tr>
<tr>
<td><a href="/docs/scenarios/application-outage/">Application outages</a></td>
<td>Isolates application Ingress/Egress traffic to observe the impact on dependent applications and recovery/initialization timing</td>
</tr>
<tr>
<td><a href="/docs/scenarios/power-outage-scenarios/">Power Outages</a></td>
<td>Shuts down the cluster for the specified duration and turns it back on to check the cluster health</td>
</tr>
<tr>
<td><a href="/docs/scenarios/pvc-scenario/">PVC disk fill</a></td>
<td>Fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it</td>
</tr>
<tr>
<td><a href="/docs/scenarios/network-chaos-scenario/">Network Chaos</a></td>
<td>Introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node&rsquo;s interface using tc and Netem</td>
</tr>
<tr>
<td><a href="/docs/scenarios/pod-network-scenario/">Pod Network Chaos</a></td>
<td>Introduces network chaos at pod level</td>
</tr>
<tr>
<td><a href="/docs/scenarios/service-hijacking-scenario/">Service Hijacking</a></td>
<td>Hijacks a service http traffic to simulate custom HTTP responses</td>
</tr>
</tbody>
</table>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c519395ea211e39cc6cc5ef047185c90">3.1 - Application Outage Scenarios</h1>
    
	<h3 id="application-outages">Application outages<a class="td-heading-self-link" href="#application-outages" aria-label="Heading self-link"></a></h3>
<p>Scenario to block the traffic ( Ingress/Egress ) of an application matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during downtime. This helps with planning the requirements accordingly, be it improving the timeouts or tweaking the alerts etc.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c6685cc58811d9965da768590d1c7b36">3.1.1 - Application Outage Scenarios using Krkn</h1>
    
	<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">application_outage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                  </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage of an application by blocking traffic</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">600</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Duration in seconds after which the routes will be accessible</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;namespace-with-application&gt;           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Namespace to target - all application routes will go inaccessible if pod selector is empty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">foo}                           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Pods to target</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">block</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">Ingress, Egress]                          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># It can be Ingress or Egress or Ingress, Egress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="debugging-steps-in-case-of-failures">Debugging steps in case of failures<a class="td-heading-self-link" href="#debugging-steps-in-case-of-failures" aria-label="Heading self-link"></a></h5>
<p>Kraken creates a network policy blocking the ingress/egress traffic to create an outage, in case of failures before reverting back the network policy, you can delete it manually by executing the following commands to stop the outage:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ oc delete networkpolicy/kraken-deny -n &lt;targeted-namespace&gt;
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-56794da11c19d01c8746a72290b04ae1">3.1.2 - Application outage Scenario using Krkn-hub</h1>
    
	<p>This scenario disrupts the traffic to the specified application to be able to understand the impact of the outage on the dependent service/user experience. Refer <a href="/docs/scenarios/application-outage/">docs</a> for more details.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds after which the routes will be accessible</td>
<td>600</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace to target - all application routes will go inaccessible if pod selector is empty ( Required )</td>
<td>No default</td>
</tr>
<tr>
<td>POD_SELECTOR</td>
<td>Pods to target. For example &ldquo;{app: foo}&rdquo;</td>
<td>No default</td>
</tr>
<tr>
<td>BLOCK_TRAFFIC_TYPE</td>
<td>It can be Ingress or Egress or Ingress, Egress ( needs to be a list )</td>
<td>[Ingress, Egress]</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Defining the <code>NAMESPACE</code> parameter is required for running this scenario while the pod_selector is optional. In case of using pod selector to target a particular application, make sure to define it using the following format with a space between key and value: â€œ{key: value}â€.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:application-outages
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452403?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a0f3c55c3812d8d9972fb401fa90997f">3.2 - Arcaflow Scenarios</h1>
    
	<p>Arcaflow is a workflow engine in development which provides the ability to execute workflow steps in sequence, in parallel, repeatedly, etc. The main difference to competitors such as Netflix Conductor is the ability to run ad-hoc workflows without an infrastructure setup required.</p>
<p>The engine uses containers to execute plugins and runs them either locally in Docker/Podman or remotely on a Kubernetes cluster. The workflow system is strongly typed and allows for generating JSON schema and OpenAPI documents for all data formats involved.</p>
<h3 id="available-scenarios">Available Scenarios<a class="td-heading-self-link" href="#available-scenarios" aria-label="Heading self-link"></a></h3>
<h4 id="hog-scenarios">Hog scenarios:<a class="td-heading-self-link" href="#hog-scenarios" aria-label="Heading self-link"></a></h4>
<ul>
<li><a href="/docs/scenarios/cpu-hog-scenario/">CPU Hog</a></li>
<li><a href="/docs/scenarios/memory-hog-scenario/">Memory Hog</a></li>
<li><a href="/docs/scenarios/io-hog-scenario/">I/O Hog</a></li>
</ul>
<h3 id="prequisites">Prequisites<a class="td-heading-self-link" href="#prequisites" aria-label="Heading self-link"></a></h3>
<p>Arcaflow supports three deployment technologies:</p>
<ul>
<li>Docker</li>
<li>Podman</li>
<li>Kubernetes</li>
</ul>
<h4 id="docker">Docker<a class="td-heading-self-link" href="#docker" aria-label="Heading self-link"></a></h4>
<p>In order to run Arcaflow Scenarios with the Docker deployer, be sure that:</p>
<ul>
<li>Docker is correctly installed in your Operating System (to find instructions on how to install docker please refer to <a href="https://www.docker.com/">Docker Documentation</a>)</li>
<li>The Docker daemon is running</li>
</ul>
<h4 id="podman">Podman<a class="td-heading-self-link" href="#podman" aria-label="Heading self-link"></a></h4>
<p>The podman deployer is built around the podman CLI and doesn&rsquo;t need necessarily to be run along with the podman daemon.
To run Arcaflow Scenarios in your Operating system be sure that:</p>
<ul>
<li>podman is correctly installed in your Operating System (to find instructions on how to install podman refer to <a href="https://podman.io/">Podman Documentation</a>)</li>
<li>the podman CLI is in your shell PATH</li>
</ul>
<h4 id="kubernetes">Kubernetes<a class="td-heading-self-link" href="#kubernetes" aria-label="Heading self-link"></a></h4>
<p>The kubernetes deployer integrates directly the Kubernetes API Client and needs only a valid kubeconfig file and a reachable Kubernetes/OpenShift Cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3b6badec7f06927507195203795ebd14">3.2.1 - Arcaflow Scenarios using Krkn</h1>
    
	<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5b042b0ace5c7a9fddf4314f18cffbe8">3.3 - Container Scenarios</h1>
    
	<p>Kraken uses the <code>oc exec</code> command to <code>kill</code> specific containers in a pod.
This can be based on the pods namespace or labels. If you know the exact object you want to kill, you can also specify the specific container name or pod name in the scenario yaml file.
These scenarios are in a simple yaml format that you can manipulate to run your specific tests or use the pre-existing scenarios to see how it works.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6b0970e4eb72407e459e00dcf868edd0">3.3.1 - Container Scenarios using Krkn</h1>
    
	<h4 id="example-config">Example Config<a class="td-heading-self-link" href="#example-config" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes for which a basic chaos scenario config exists today.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;name of scenario&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;specific namespace&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># can specify &#34;*&#34; if you want to find in all namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;label of pod(s)&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;specific container name&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is optional, can take out and will kill all containers in all pods found under namespace and label</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pod_names</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is optional, can take out and will select all pods with given namespace and label</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">&lt;pod_name&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;number of containers to disrupt, default=1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;kill signal to run. For example 1 ( hang up ) or 9. Default is set to 1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expected_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;number of seconds to wait for container to be running again&gt; (defaults to 120seconds)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="post-action">Post Action<a class="td-heading-self-link" href="#post-action" aria-label="Heading self-link"></a></h4>
<p>In all scenarios we do a post chaos check to wait and verify the specific component.</p>
<p>Here there are two options:</p>
<ol>
<li>Pass a custom script in the main config scenario list that will run before the chaos and verify the output matches post chaos scenario.</li>
</ol>
<p>See <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/post_action_etcd_container.py">scenarios/post_action_etcd_container.py</a> for an example.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">container_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                 </span><span style="color:#8f5902;font-style:italic"># List of chaos pod scenarios to load.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- - <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/container_etcd.yml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/post_action_etcd_container.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol start="2">
<li>Allow kraken to wait and check the killed containers until they become ready again. Kraken keeps a list of the specific
containers that were killed as well as the namespaces and pods to verify all containers that were affected recover properly.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">expected_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;seconds to wait for container to recover&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-93508b71407800a4fd12c130146c8c29">3.3.2 - Container Scenarios using Krkn-hub</h1>
    
	<p>This scenario disrupts the containers matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster</td>
<td>openshift-etcd</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the container(s) to target</td>
<td>k8s-app=etcd</td>
</tr>
<tr>
<td>DISRUPTION_COUNT</td>
<td>Number of container to disrupt</td>
<td>1</td>
</tr>
<tr>
<td>CONTAINER_NAME</td>
<td>Name of the container to disrupt</td>
<td>etcd</td>
</tr>
<tr>
<td>ACTION</td>
<td>kill signal to run. For example 1 ( hang up ) or 9</td>
<td>1</td>
</tr>
<tr>
<td>EXPECTED_RECOVERY_TIME</td>
<td>Time to wait before checking if all containers that were affected recover properly</td>
<td>60</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/BXqs9JSGDSEKcydTIJ5LpPZBM?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-453f0d3bacab710a741dfc6447534e67">3.4 - CPU Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create cpu pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c35b125e7cb7975c42e6c99f8e45340a">3.4.1 - CPU Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/cpu-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/cpu-hog-scenario/cpu-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>cpu_count :</strong> <em>int</em> the number of CPU cores to be used (0 means all)</li>
<li><strong>cpu_method :</strong> <em>string</em> a fine-grained control of which cpu stressors to use (ackermann, cfloat etc. see <a href="https://manpages.org/sysbench">manpage</a> for all the cpu_method options)</li>
<li><strong>cpu_load_percentage :</strong> <em>int</em> the CPU load by percentage</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f182958d88fb20776b8a10c969271e32">3.4.2 - CPU Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the cpu on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/cpu-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>60</td>
</tr>
<tr>
<td>NODE_CPU_CORE</td>
<td>Number of cores (workers) of node CPU to be consumed</td>
<td>2</td>
</tr>
<tr>
<td>NODE_CPU_PERCENTAGE</td>
<td>Percentage of total cpu to be consumed</td>
<td>50</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-cpu-hog
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452762">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92869ed19e15fe8a8f9327d35eb0a8ef">3.5 - IO Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create disk pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.
The scenario allows to attach a node path to the pod as a <code>hostPath</code> volume.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-061db2db4cf2d6fb8b918615b8fd2dda">3.5.1 - IO Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/io-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/io-hog-scenario/io-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>target_pod_folder :</strong> <em>string</em> the path in the pod where the volume is mounted</li>
<li><strong>target_pod_volume :</strong> <em>object</em> the <code>hostPath</code> volume definition in the <a href="https://docs.openshift.com/container-platform/3.11/install_config/persistent_storage/using_hostpath.html">Kubernetes/OpenShift</a> format, that will be attached to the pod as a volume</li>
<li><strong>io_write_bytes :</strong> <em>string</em> writes N bytes for each hdd process. The size can be expressed as % of free space on the file system or in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g</li>
<li><strong>io_block_size :</strong> <em>string</em> size of each write in bytes. Size can be from 1 byte to 4m.</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3a7a19e3ba7417a217ade8504634e037">3.5.2 - IO Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the IO on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/io-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>180</td>
</tr>
<tr>
<td>IO_BLOCK_SIZE</td>
<td>string size of each write in bytes. Size can be from 1 byte to 4m</td>
<td>1m</td>
</tr>
<tr>
<td>IO_WORKERS</td>
<td>Number of stressorts</td>
<td>5</td>
</tr>
<tr>
<td>IO_WRITE_BYTES</td>
<td>string writes N bytes for each hdd process. The size can be expressed as % of free space on the file system or in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g</td>
<td>10m</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/root/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/root/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/root/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-io-hog
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f25a2b90c8720ca76c4391ef2a5779e8">3.6 - ManagedCluster Scenarios</h1>
    
	<p><a href="https://open-cluster-management.io/concepts/managedcluster/">ManagedCluster</a> scenarios provide a way to integrate kraken with <a href="https://open-cluster-management.io/">Open Cluster Management (OCM)</a> and <a href="https://www.redhat.com/en/technologies/management/advanced-cluster-management">Red Hat Advanced Cluster Management for Kubernetes (ACM)</a>.</p>
<p>ManagedCluster scenarios leverage <a href="https://open-cluster-management.io/concepts/manifestwork/">ManifestWorks</a> to inject faults into the ManagedClusters.</p>
<p>The following ManagedCluster chaos scenarios are supported:</p>
<ol>
<li><strong>managedcluster_start_scenario</strong>: Scenario to start the ManagedCluster instance.</li>
<li><strong>managedcluster_stop_scenario</strong>: Scenario to stop the ManagedCluster instance.</li>
<li><strong>managedcluster_stop_start_scenario</strong>: Scenario to stop and then start the ManagedCluster instance.</li>
<li><strong>start_klusterlet_scenario</strong>: Scenario to start the klusterlet of the ManagedCluster instance.</li>
<li><strong>stop_klusterlet_scenario</strong>: Scenario to stop the klusterlet of the ManagedCluster instance.</li>
<li><strong>stop_start_klusterlet_scenario</strong>: Scenario to stop and start the klusterlet of the ManagedCluster instance.</li>
</ol>
<p>ManagedCluster scenarios can be injected by placing the ManagedCluster scenarios config files under <code>managedcluster_scenarios</code> option in the Kraken config. Refer to <a href="https://github.com/redhat-chaos/krkn/blob/main/scenarios/kube/managedcluster_scenarios_example.yml">managedcluster_scenarios_example</a> config file.</p>
<pre tabindex="0"><code>managedcluster_scenarios:
  - actions:                                                        # ManagedCluster chaos scenarios to be injected
    - managedcluster_stop_start_scenario
    managedcluster_name: cluster1                                   # ManagedCluster on which scenario has to be injected; can set multiple names separated by comma
    # label_selector:                                               # When managedcluster_name is not specified, a ManagedCluster with matching label_selector is selected for ManagedCluster chaos scenario injection
    instance_count: 1                                               # Number of managedcluster to perform action/select that match the label selector
    runs: 1                                                         # Number of times to inject each scenario under actions (will perform on same ManagedCluster each time)
    timeout: 420                                                    # Duration to wait for completion of ManagedCluster scenario injection
                                                                    # For OCM to detect a ManagedCluster as unavailable, have to wait 5*leaseDurationSeconds
                                                                    # (default leaseDurationSeconds = 60 sec)
  - actions:
    - stop_start_klusterlet_scenario
    managedcluster_name: cluster1
    # label_selector:
    instance_count: 1
    runs: 1
    timeout: 60
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4afdb6f0fd755ca703a0d7520b8daf50">3.7 - Memory Hog Scenario</h1>
    
	<p>This scenario is based on the arcaflow <a href="https://github.com/arcalot/arcaflow-plugin-stressng">arcaflow-plugin-stressng</a> plugin.
The purpose of this scenario is to create Virtual Memory pressure on a particular node of the Kubernetes/OpenShift cluster for a time span.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-dbc32c76f347cc59694c7aa38a113a33">3.7.1 - Memory Hog Scenarios using Krkn</h1>
    
	<p>To enable this plugin add the pointer to the scenario input file <code>scenarios/arcaflow/memory-hog/input.yaml</code> as described in the
<a href="/docs/scenarios/memory-hog-scenario/memory-hog-scenario-krkn/#usage">Usage</a> section.
This scenario takes a list of objects named <code>input_list</code> with the following properties:</p>
<ul>
<li><strong>kubeconfig :</strong> <em>string</em> the kubeconfig needed by the deployer to deploy the sysbench plugin in the target cluster</li>
<li><strong>namespace :</strong> <em>string</em> the namespace where the scenario container will be deployed
<strong>Note:</strong> this parameter will be automatically filled by kraken if the <code>kubeconfig_path</code> property is correctly set</li>
<li><strong>node_selector :</strong> <em>key-value map</em> the node label that will be used as <code>nodeSelector</code> by the pod to target a specific cluster node</li>
<li><strong>duration :</strong> <em>string</em> stop  stress  test  after  N  seconds.  One  can  also specify the units of time in seconds, minutes, hours, days or years with the suffix s, m, h, d or y.</li>
<li><strong>vm_bytes :</strong> <em>string</em> N bytes per vm process or percentage of memory used (using the % symbol). The size can be expressed in units of Bytes, KBytes, MBytes and GBytes using the suffix b, k, m or g.</li>
<li><strong>vm_workers :</strong> <em>int</em> Number of VM stressors to be run (0 means 1 stressor per CPU)</li>
</ul>
<p>To perform several load tests in the same run simultaneously (eg. stress two or more nodes in the same run) add another item
to the <code>input_list</code> with the same properties (and eventually different values eg. different node_selectors
to schedule the pod on different nodes). To reduce (or increase) the parallelism change the value <code>parallelism</code> in <code>workload.yaml</code> file</p>
<h3 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h3>
<p>To enable arcaflow scenarios edit the kraken config file, go to the section <code>kraken -&gt; chaos_scenarios</code> of the yaml structure
and add a new element to the list named <code>arcaflow_scenarios</code> then add the desired scenario
pointing to the <code>input.yaml</code> file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">arcaflow_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">scenarios/arcaflow/cpu-hog/input.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="inputyaml">input.yaml<a class="td-heading-self-link" href="#inputyaml" aria-label="Heading self-link"></a></h4>
<p>The implemented scenarios can be found in <em>scenarios/arcaflow/&lt;scenario_name&gt;</em> folder.
The entrypoint of each scenario is the <em>input.yaml</em> file.
In this file there are all the options to set up the scenario accordingly to the desired target</p>
<h3 id="configyaml">config.yaml<a class="td-heading-self-link" href="#configyaml" aria-label="Heading self-link"></a></h3>
<p>The arcaflow config file. Here you can set the arcaflow deployer and the arcaflow log level.
The supported deployers are:</p>
<ul>
<li>Docker</li>
<li>Podman (podman daemon not needed, suggested option)</li>
<li>Kubernetes</li>
</ul>
<p>The supported log levels are:</p>
<ul>
<li>debug</li>
<li>info</li>
<li>warning</li>
<li>error</li>
</ul>
<h3 id="workflowyaml">workflow.yaml<a class="td-heading-self-link" href="#workflowyaml" aria-label="Heading self-link"></a></h3>
<p>This file contains the steps that will be executed to perform the scenario against the target.
Each step is represented by a container that will be executed from the deployer and its options.
Note that we provide the scenarios as a template, but they can be manipulated to define more complex workflows.
To have more details regarding the arcaflow workflows architecture and syntax it is suggested to refer to the <a href="https://arcalot.io/arcaflow/">Arcaflow Documentation</a>.</p>
<p>This edit is no longer in quay image
Working on fix in ticket: <a href="https://issues.redhat.com/browse/CHAOS-494">https://issues.redhat.com/browse/CHAOS-494</a>
This will effect all versions 4.12 and higher of OpenShift</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4235987e3f2a8cb2f643e68610a28e16">3.7.2 - Memory Hog Scenario using Krkn-Hub</h1>
    
	<p>This scenario hogs the memory on the specified node on a Kubernetes/OpenShift cluster for a specified duration. For more information refer the following <a href="/docs/scenarios/memory-hog-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>TOTAL_CHAOS_DURATION</td>
<td>Set chaos duration (in sec) as desired</td>
<td>60</td>
</tr>
<tr>
<td>MEMORY_CONSUMPTION_PERCENTAGE</td>
<td>percentage  (expressed with the suffix %) or amount (expressed with the suffix b, k, m or g) of memory to be consumed by the scenario</td>
<td>90%</td>
</tr>
<tr>
<td>NUMBER_OF_WORKERS</td>
<td>Total number of workers (stress-ng threads)</td>
<td>1</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace where the scenario container will be deployed</td>
<td>default</td>
</tr>
<tr>
<td>NODE_SELECTORS</td>
<td>Node selectors where the scenario containers will be scheduled in the format &ldquo;<code>&lt;selector&gt;=&lt;value&gt;</code>&rdquo;. <strong>NOTE</strong>: This value can be specified as a list of node selectors separated by &ldquo;<code>;</code>&rdquo;. Will be instantiated a container per each node selector with the same scenario options. This option is meant to run one or more stress scenarios simultaneously on different nodes, kubernetes will schedule the pods on the target node accordingly with the selector specified. Specifying the same selector multiple times will  instantiate as many scenario container as the number of times the selector is specified on the same node</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-memory-hog
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452742?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-993237ebf800e696ef64cc0a59b19cee">3.8 - Network Chaos Scenario</h1>
    
	<p>Scenario to introduce network latency, packet loss, and bandwidth restriction in the Node&rsquo;s host network interface. The purpose of this scenario is to observe faults caused by random variations in the network.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6946ebccc0f4758c518336c6a1eab7ef">3.8.1 - Network Chaos Scenario using Krkn</h1>
    
	<h5 id="sample-scenario-config-for-egress-traffic-shaping">Sample scenario config for egress traffic shaping<a class="td-heading-self-link" href="#sample-scenario-config-for-egress-traffic-shaping" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">network_chaos</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage by simulating random variations in the network.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">300</span><span style="color:#f8f8f8;text-decoration:underline">                                   </span><span style="color:#8f5902;font-style:italic"># In seconds - duration network chaos will be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">node_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Comma separated node names on which scenario has to be injected.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># When node_name is not specified, a node with matching label_selector is selected for running the scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">instance_count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                               </span><span style="color:#8f5902;font-style:italic"># Number of nodes in which to execute network chaos.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                     </span><span style="color:#8f5902;font-style:italic"># List of interface on which to apply the network restriction.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;ens5&#34;</span><span style="color:#f8f8f8;text-decoration:underline">                                        </span><span style="color:#8f5902;font-style:italic"># Interface name would be the Kernel host network interface name.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">execution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">serial|parallel                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Execute each of the egress options as a single scenario(parallel) or as separate scenario(serial).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">egress</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">loss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000">%                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># percentage</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bandwidth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">10mbit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="sample-scenario-config-for-ingress-traffic-shaping-using-a-plugin">Sample scenario config for ingress traffic shaping (using a plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-ingress-traffic-shaping-using-a-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">network_chaos</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_interface_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Dictionary with key as node name(s) and value as a list of its interfaces to test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ip-10-0-128-153.us-west-2.compute.internal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">ens5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">genev_sys_6081</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># When node_interface_name is not specified, nodes with matching label_selector is selected for node chaos scenario injection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">instance_count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                               </span><span style="color:#8f5902;font-style:italic"># Number of nodes to perform action/select that match the label selector</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubeconfig_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">~/.kube/config                </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path to kubernetes config file. If not specified, it defaults to ~/.kube/config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">execution_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">parallel                       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Execute each of the ingress options as a single scenario(parallel) or as separate scenario(serial).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">loss</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;50%&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">bandwidth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">10mbit</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">wait_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">test_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#4e9a06">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">Note: For ingress traffic shaping, ensure that your node doesn&#39;</span><span style="color:#000">t have any [IFB](https://wiki.linuxfoundation.org/networking/ifb) interfaces already present. The scenario relies on creating IFBs to do the shaping, and they are deleted at the end of the scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">##### Steps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Pick the nodes to introduce the network anomaly either from node_name or label_selector.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Verify interface list in one of the nodes or use the interface with a default route, as test interface, if no interface is specified by the user.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Set traffic shaping config on node&#39;s interface using tc and netem.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Wait for the duration time.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Remove traffic shaping config on node&#39;s interface.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"> </span>- <span style="color:#000">Remove the job that spawned the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-58617b5353469d215cd71c3a97f65a3d">3.8.2 - Network Chaos Scenario using Krkn-Hub</h1>
    
	<p>This scenario introduces network latency, packet loss, bandwidth restriction in the egress traffic of a Node&rsquo;s interface using the tc and Netem. For more information refer the following <a href="/docs/scenarios/network-chaos-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:network-chaos
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:network-chaos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>export TRAFFIC_TYPE=egress</code> for Egress scenarios and <code>export TRAFFIC_TYPE=ingress</code> for Ingress scenarios

</div>

<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<h5 id="egress-scenarios">Egress Scenarios<a class="td-heading-self-link" href="#egress-scenarios" aria-label="Heading self-link"></a></h5>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds - during with network chaos will be applied.</td>
<td>300</td>
</tr>
<tr>
<td>NODE_NAME</td>
<td>Node name to inject faults in case of targeting a specific node; Can set multiple node names separated by a comma</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>When NODE_NAME is not specified, a node with matching label_selector is selected for running.</td>
<td>node-role.kubernetes.io/master</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>INTERFACES</td>
<td>List of interface on which to apply the network restriction.</td>
<td>[]</td>
</tr>
<tr>
<td>EXECUTION</td>
<td>Execute each of the egress option as a single scenario(parallel) or as separate scenario(serial).</td>
<td>parallel</td>
</tr>
<tr>
<td>EGRESS</td>
<td>Dictonary of values to set  network latency(latency: 50ms), packet loss(loss: 0.02), bandwidth restriction(bandwidth: 100mbit)</td>
<td>{bandwidth: 100mbit}</td>
</tr>
</tbody>
</table>
<h5 id="ingress-scenarios">Ingress Scenarios<a class="td-heading-self-link" href="#ingress-scenarios" aria-label="Heading self-link"></a></h5>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>DURATION</td>
<td>Duration in seconds - during with network chaos will be applied.</td>
<td>300</td>
</tr>
<tr>
<td>TARGET_NODE_AND_INTERFACE</td>
<td># Dictionary with key as node name(s) and value as a list of its interfaces to test. For example: {ip-10-0-216-2.us-west-2.compute.internal: [ens5]}</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>When NODE_NAME is not specified, a node with matching label_selector is selected for running.</td>
<td>node-role.kubernetes.io/master</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>EXECUTION</td>
<td>Used to specify whether you want to apply filters on interfaces one at a time or all at once.</td>
<td>parallel</td>
</tr>
<tr>
<td>NETWORK_PARAMS</td>
<td>latency, loss and bandwidth are the three supported network parameters to alter for the chaos test. For example: {latency: 50ms, loss: &lsquo;0.02&rsquo;}</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Ensure that it is at least about twice of test_duration</td>
<td>300</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f16f359a8dea60e9d83ad2f901728e3d">3.9 - Node Scenarios</h1>
    
	<p>This scenario disrupts the node(s) matching the label on a Kubernetes/OpenShift cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-774f55781c04704bbc35442200005082">3.9.1 - Node Scenarios using Krkn</h1>
    
	<p>The following node chaos scenarios are supported:</p>
<ol>
<li><strong>node_start_scenario</strong>: Scenario to stop the node instance.</li>
<li><strong>node_stop_scenario</strong>: Scenario to stop the node instance.</li>
<li><strong>node_stop_start_scenario</strong>: Scenario to stop and then start the node instance. Not supported on VMware.</li>
<li><strong>node_termination_scenario</strong>: Scenario to terminate the node instance.</li>
<li><strong>node_reboot_scenario</strong>: Scenario to reboot the node instance.</li>
<li><strong>stop_kubelet_scenario</strong>: Scenario to stop the kubelet of the node instance.</li>
<li><strong>stop_start_kubelet_scenario</strong>: Scenario to stop and start the kubelet of the node instance.</li>
<li><strong>restart_kubelet_scenario</strong>: Scenario to restart the kubelet of the node instance.</li>
<li><strong>node_crash_scenario</strong>: Scenario to crash the node instance.</li>
<li><strong>stop_start_helper_node_scenario</strong>: Scenario to stop and start the helper node and check service status.</li>
</ol>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    If the node does not recover from the node_crash_scenario injection, reboot the node to get it back to Ready state.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    node_start_scenario, node_stop_scenario, node_stop_start_scenario, node_termination_scenario
, node_reboot_scenario and stop_start_kubelet_scenario are supported on AWS, Azure, OpenStack, BareMetal, GCP
, VMware and Alibaba.

</div>

<h4 id="aws">AWS<a class="td-heading-self-link" href="#aws" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#aws">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/aws_node_scenarios.yml">here</a>.</p>
<h4 id="baremetal">Baremetal<a class="td-heading-self-link" href="#baremetal" aria-label="Heading self-link"></a></h4>
<p>Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/baremetal_node_scenarios.yml">here</a>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>Baremetal requires setting the IPMI user and password to power on, off, and reboot nodes, using the config options <code>bm_user</code> and <code>bm_password</code>. It can either be set in the root of the entry in the scenarios config, or it can be set per machine.</p>
<p>If no per-machine addresses are specified, kraken attempts to use the BMC value in the BareMetalHost object. To list them, you can do &lsquo;oc get bmh -o wide &ndash;all-namespaces&rsquo;. If the BMC values are blank, you must specify them per-machine using the config option &lsquo;bmc_addr&rsquo; as specified below.</p>
<p>For per-machine settings, add a &ldquo;bmc_info&rdquo; section to the entry in the scenarios config. Inside there, add a configuration section using the node name. In that, add per-machine settings. Valid settings are &lsquo;bmc_user&rsquo;, &lsquo;bmc_password&rsquo;, and &lsquo;bmc_addr&rsquo;.
See the example node scenario or the example below.</p>


</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Baremetal requires oc (openshift client) be installed on the machine running Kraken.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Baremetal machines are fragile. Some node actions can occasionally corrupt the filesystem if it does not shut down properly, and sometimes the kubelet does not start properly.

</div>

<h4 id="docker">Docker<a class="td-heading-self-link" href="#docker" aria-label="Heading self-link"></a></h4>
<p>The Docker provider can be used to run node scenarios against kind clusters.</p>
<p><a href="https://kind.sigs.k8s.io/">kind</a> is a tool for running local Kubernetes clusters using Docker container &ldquo;nodes&rdquo;.</p>
<p>kind was primarily designed for testing Kubernetes itself, but may be used for local development or CI.</p>
<h4 id="gcp">GCP<a class="td-heading-self-link" href="#gcp" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#gcp">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/gcp_node_scenarios.yml">here</a>.</p>
<h4 id="openstack">Openstack<a class="td-heading-self-link" href="#openstack" aria-label="Heading self-link"></a></h4>
<p>How to set up Openstack cli to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#openstack">here</a>.</p>
<p>The supported node level chaos scenarios on an OPENSTACK cloud are <code>node_stop_start_scenario</code>, <code>stop_start_kubelet_scenario</code> and <code>node_reboot_scenario</code>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For <code>stop_start_helper_node_scenario</code>,  visit <a href="https://github.com/redhat-cop/ocp4-helpernode">here</a> to learn more about the helper node and its usage.

</div>

<p>To execute the scenario, ensure the value for <code>ssh_private_key</code> in the node scenarios config file is set with the correct private key file path for ssh connection to the helper node. Ensure passwordless ssh is configured on the host running Kraken and the helper node to avoid connection errors.</p>
<h4 id="azure">Azure<a class="td-heading-self-link" href="#azure" aria-label="Heading self-link"></a></h4>
<p>Cloud setup instructions can be found <a href="/docs/scenarios/cloud_setup/#azure">here</a>. Sample scenario config can be found <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/azure_node_scenarios.yml">here</a>.</p>
<h4 id="alibaba">Alibaba<a class="td-heading-self-link" href="#alibaba" aria-label="Heading self-link"></a></h4>
<p>How to set up Alibaba cli to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#alibaba">here</a>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    There is no &ldquo;terminating&rdquo; idea in Alibaba, so any scenario with terminating will &ldquo;release&rdquo; the node
. Releasing a node is 2 steps, stopping the node and then releasing it.

</div>

<h4 id="vmware">VMware<a class="td-heading-self-link" href="#vmware" aria-label="Heading self-link"></a></h4>
<p>How to set up VMware vSphere to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#vmware">here</a></p>
<p>This cloud type uses a different configuration style, see actions below and <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/vmware_node_scenarios.yml">example config file</a></p>
<ul>
<li>vmware-node-terminate</li>
<li>vmware-node-reboot</li>
<li>vmware-node-stop</li>
<li>vmware-node-start</li>
</ul>
<h4 id="ibmcloud">IBMCloud<a class="td-heading-self-link" href="#ibmcloud" aria-label="Heading self-link"></a></h4>
<p>How to set up IBMCloud to run node scenarios is defined <a href="/docs/scenarios/cloud_setup/#ibmcloud">here</a></p>
<p>This cloud type uses a different configuration style, see actions below and <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/ibmcloud_node_scenarios.yml">example config file</a></p>
<ul>
<li>ibmcloud-node-terminate</li>
<li>ibmcloud-node-reboot</li>
<li>ibmcloud-node-stop</li>
<li>ibmcloud-node-start</li>
</ul>
<h4 id="general">General<a class="td-heading-self-link" href="#general" aria-label="Heading self-link"></a></h4>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The <code>node_crash_scenario</code> and <code>stop_kubelet_scenario</code> scenario is supported independent of the cloud platform.

</div>

<p>Use &lsquo;generic&rsquo; or do not add the &lsquo;cloud_type&rsquo; key to your scenario if your cluster is not set up using one of the current supported cloud types.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41b7887a58c35ebdc959d9678afaee4b">3.9.2 - Node Scenarios using Krkn-Hub</h1>
    
	<p>This scenario disrupts the node(s) matching the label on a Kubernetes/OpenShift cluster. Actions/disruptions supported are listed <a href="/docs/scenarios/node-scenarios/">here</a></p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:node-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACTION</td>
<td>Action can be one of the <a href="https://github.com/krkn-chaos/krkn/blob/master/docs/node_scenarios.md">following</a></td>
<td>node_stop_start_scenario for aws and vmware-node-reboot for vmware, ibmcloud-node-reboot for ibmcloud</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Node label to target</td>
<td>node-role.kubernetes.io/worker</td>
</tr>
<tr>
<td>NODE_NAME</td>
<td>Node name to inject faults in case of targeting a specific node; Can set multiple node names separated by a comma</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Targeted instance count matching the label selector</td>
<td>1</td>
</tr>
<tr>
<td>RUNS</td>
<td>Iterations to perform action on a single node</td>
<td>1</td>
</tr>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, supported platforms - aws, vmware, ibmcloud, bm</td>
<td>aws</td>
</tr>
<tr>
<td>TIMEOUT</td>
<td>Duration to wait for completion of node scenario injection</td>
<td>180</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration to stop the node before running the start action - not supported for vmware and ibm cloud type</td>
<td>120</td>
</tr>
<tr>
<td>VERIFY_SESSION</td>
<td>Only needed for vmware - Set to True if you want to verify the vSphere client session using certificates</td>
<td>False</td>
</tr>
<tr>
<td>SKIP_OPENSHIFT_CHECKS</td>
<td>Only needed for vmware - Set to True if you don&rsquo;t want to wait for the status of the nodes to change on OpenShift before passing the scenario</td>
<td>False</td>
</tr>
<tr>
<td>BMC_USER</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc username</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>BMC_PASSWORD</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc password</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>BMC_ADDR</td>
<td>Only needed for Baremetal ( bm ) - IPMI/bmc username</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios 
</span></span></code></pre></div><p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>VMware Vsphere</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_IP</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_IP_address&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_username&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">VSPHERE_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vSphere_client_password&gt;
</span></span></code></pre></div><p>Ibmcloud</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IBMC_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://&lt;region&gt;.iaas.cloud.ibm.com/v1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">IBMC_APIKEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;ibmcloud_api_key&gt;
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc/IPMI user&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc/IPMI password&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">BMC_ADDR</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;bmc address&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_TENANT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_CLIENT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AZURE_CLIENT_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/ANZY7HhPdWTNaWt4xMFanF6Q5">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-affd85910adbdf9ad08c6ed992c6bb14">3.10 - Pod Network Scenarios</h1>
    
	<h3 id="pod-outage">Pod outage<a class="td-heading-self-link" href="#pod-outage" aria-label="Heading self-link"></a></h3>
<p>Scenario to block the traffic ( Ingress/Egress ) of a pod matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during downtime. This helps with planning the requirements accordingly, be it improving the timeouts or tweaking the alerts etc.
With the current network policies, it is not possible to explicitly block ports which are enabled by allowed network policy rule. This chaos scenario addresses this issue by using OVS flow rules to block ports related to the pod. It supports OpenShiftSDN and OVNKubernetes based networks.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3113de3ae94ded0c459e52ecda391a77">3.10.1 - Pod Scenarios using Krkn</h1>
    
	<h5 id="sample-scenario-config-using-a-plugin">Sample scenario config (using a plugin)<a class="td-heading-self-link" href="#sample-scenario-config-using-a-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_network_outage</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">direction</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Optioinal - List of directions to apply filters</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">ingress                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Blocks ingress traffic, Default both egress and ingress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ingress_ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                 </span><span style="color:#8f5902;font-style:italic"># Optional - List of ports to block traffic on</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#0000cf;font-weight:bold">8443</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Blocks 8443, Default [], i.e. all ports.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Blocks access to openshift console</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="pod-network-shaping">Pod Network shaping<a class="td-heading-self-link" href="#pod-network-shaping" aria-label="Heading self-link"></a></h3>
<p>Scenario to introduce network latency, packet loss, and bandwidth restriction in the Pod&rsquo;s network interface. The purpose of this scenario is to observe faults caused by random variations in the network.</p>
<h5 id="sample-scenario-config-for-egress-traffic-shaping-using-plugin">Sample scenario config for egress traffic shaping (using plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-egress-traffic-shaping-using-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_egress_shaping</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Applies traffic shaping to access openshift console.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Add 500ms latency to egress traffic from the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="sample-scenario-config-for-ingress-traffic-shaping-using-plugin">Sample scenario config for ingress traffic shaping (using plugin)<a class="td-heading-self-link" href="#sample-scenario-config-for-ingress-traffic-shaping-using-plugin" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod_ingress_shaping</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-console  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Required - Namespace of the pod to which filter need to be applied.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;component=ui&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Applies traffic shaping to access openshift console.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">latency</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">500ms            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Add 500ms latency to egress traffic from the pod.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h5 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h5>
<ul>
<li>Pick the pods to introduce the network anomaly either from label_selector or pod_name.</li>
<li>Identify the pod interface name on the node.</li>
<li>Set traffic shaping config on pod&rsquo;s interface using tc and netem.</li>
<li>Wait for the duration time.</li>
<li>Remove traffic shaping config on pod&rsquo;s interface.</li>
<li>Remove the job that spawned the pod.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5edf70896392385f5e879c8c6af1559c">3.10.2 - Pod Network Chaos Scenarios using Krkn-hub</h1>
    
	<p>This scenario runs network chaos at the pod level on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code>
See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Required - Namespace of the pod to which filter need to be applied</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the pod(s) to target</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>POD_NAME</td>
<td>When label_selector is not specified, pod matching the name will be selected for the chaos scenario</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>INSTANCE_COUNT</td>
<td>Number of pods to perform action/select that match the label selector</td>
<td>1</td>
</tr>
<tr>
<td>TRAFFIC_TYPE</td>
<td>List of directions to apply filters - egress/ingress ( needs to be a list )</td>
<td>[ingress, egress]</td>
</tr>
<tr>
<td>INGRESS_PORTS</td>
<td>Ingress ports to block ( needs to be a list )</td>
<td>[] i.e all ports</td>
</tr>
<tr>
<td>EGRESS_PORTS</td>
<td>Egress ports to block ( needs to be a list )</td>
<td>[] i.e all ports</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Ensure that it is at least about twice of test_duration</td>
<td>300</td>
</tr>
<tr>
<td>TEST_DURATION</td>
<td>Duration of the test run</td>
<td>120</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-network-chaos
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-abccb6686f7f738ead88a179903bd631">3.11 - Pod Scenarios</h1>
    
	<p>Krkn recently replaced PowerfulSeal with its own internal pod scenarios using a plugin system. This scenario disrupts the pods matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-95b830de59fc16f5bfb39617cfcd5402">3.11.1 - Pod Scenarios using Krkn</h1>
    
	<h4 id="example-config">Example Config<a class="td-heading-self-link" href="#example-config" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes for which a basic chaos scenario config exists today.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">kraken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">chaos_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">plugin_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">path/to/scenario.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You can then create the scenario file with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># yaml-language-server: $schema=../plugin.schema.json</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kill-pods</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace_pattern</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">^kube-system$</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s-app=kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">krkn_pod_recovery_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span></code></pre></div><p>Please adjust the schema reference to point to the <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/plugin.schema.json">schema file</a>. This file will give you code completion and documentation for the available options in your IDE.</p>
<h4 id="pod-chaos-scenarios">Pod Chaos Scenarios<a class="td-heading-self-link" href="#pod-chaos-scenarios" aria-label="Heading self-link"></a></h4>
<p>The following are the components of Kubernetes/OpenShift for which a basic chaos scenario config exists today.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Working</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/kube/pod.yml">Basic pod scenario</a></td>
<td>Kill a pod.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/etcd.yml">Etcd</a></td>
<td>Kills a single/multiple etcd replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/openshift-kube-apiserver.yml">Kube ApiServer</a></td>
<td>Kills a single/multiple kube-apiserver replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/openshift-apiserver.yml">ApiServer</a></td>
<td>Kills a single/multiple apiserver replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/prometheus.yml">Prometheus</a></td>
<td>Kills a single/multiple prometheus replicas.</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td><a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/regex_openshift_pod_kill.yml">OpenShift System Pods</a></td>
<td>Kills random pods running in the OpenShift system namespaces.</td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dd864f90e71659610098eefe5ef8e784">3.11.2 - Pod Scenarios using Krkn-hub</h1>
    
	<p>This scenario disrupts the pods matching the label in the specified namespace on a Kubernetes/OpenShift cluster.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pod-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster ( supports regex )</td>
<td>openshift-.*</td>
</tr>
<tr>
<td>POD_LABEL</td>
<td>Label of the pod(s) to target</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAME_PATTERN</td>
<td>Regex pattern to match the pods in NAMESPACE  when POD_LABEL is not specified</td>
<td>.*</td>
</tr>
<tr>
<td>DISRUPTION_COUNT</td>
<td>Number of pods to disrupt</td>
<td>1</td>
</tr>
<tr>
<td>KILL_TIMEOUT</td>
<td>Timeout to wait for the target pod(s) to be removed in seconds</td>
<td>180</td>
</tr>
<tr>
<td>EXPECTED_RECOVERY_TIME</td>
<td>Fails if the pod disrupted do not recover within the timeout set</td>
<td>120</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452351?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ce8b54635e230b2999da190ebd1e41be">3.12 - Power Outage Scenarios</h1>
    
	<p>This scenario shuts down Kubernetes/OpenShift cluster for the specified duration to simulate power outages, brings it back online and checks if it&rsquo;s healthy.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-86b7bbcde807ac105b3ed9bf4854bc3d">3.12.1 - Power Outage Scenario using Krkn</h1>
    
	<p>Power Outage/ Cluster shut down scenario can be injected by placing the shut_down config file under cluster_shut_down_scenario option in the kraken config. Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/openshift/cluster_shut_down_scenario.yml">cluster_shut_down_scenario</a> config file.</p>
<p>Refer to <a href="/docs/scenarios/cloud_setup/">cloud setup</a> to configure your cli properly for the cloud provider of the cluster you want to shut down.</p>
<p>Current accepted cloud types:</p>
<ul>
<li><a href="/docs/scenarios/cloud_setup/#azure">Azure</a></li>
<li><a href="/docs/scenarios/cloud_setup/#gcp">GCP</a></li>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
<li><a href="/docs/scenarios/cloud_setup/#openstack">Openstack</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">cluster_shut_down_scenario</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># Scenario to stop all the nodes for specified duration and restart the nodes.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                                            </span><span style="color:#8f5902;font-style:italic"># Number of times to execute the cluster_shut_down scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">shut_down_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">120</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Duration in seconds to shut down the cluster.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cloud_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Cloud type on which Kubernetes/OpenShift runs.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f78409366ed557faa404a782e364505b">3.12.2 - Power Outage Scenario using Krkn-Hub</h1>
    
	<p>This scenario shuts down Kubernetes/OpenShift cluster for the specified duration to simulate power outages, brings it back online and checks if it&rsquo;s healthy. More information can be found <a href="/docs/scenarios/power-outage-scenarios/">here</a></p>
<p>Right now power outage and cluster shutdown are one in the same. We originally created this scenario to stop all the nodes and then start them back up how a customer would shut their cluster down.</p>
<p>In a real life chaos scenario though, we figured this scenario was close to if the power went out on the aws side so all of our ec2 nodes would be stopped/powered off.
We tried to look at if aws cli had a way to forcefully poweroff the nodes (not gracefully) and they don&rsquo;t currently support so this scenario is as close as we can get to &ldquo;pulling the plug&rdquo;</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:power-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>SHUTDOWN_DURATION</td>
<td>Duration in seconds to shut down the cluster</td>
<td>1200</td>
</tr>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, <a href="https://github.com/krkn-chaos/krkn/blob/master/docs/node_scenarios.md">supported cloud platforms</a></td>
<td>aws</td>
</tr>
<tr>
<td>TIMEOUT</td>
<td>Time in seconds to wait for each node to be stopped or running after the cluster comes back</td>
<td>600</td>
</tr>
</tbody>
</table>
<p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/r0zLbh70XK7gnc4s5v0ZzSXGo">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-894d789e8e0ad80e01add4fc659d4230">3.13 - PVC Scenario</h1>
    
	<p>Scenario to fill up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it. The purpose of this scenario is to fill up a volume to understand faults caused by the application using this volume.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-042a0835bd60597669c3f484912f9e1e">3.13.1 - PVC Scenario using Krkn</h1>
    
	<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<pre tabindex="0"><code>pvc_scenario:
  pvc_name: &lt;pvc_name&gt;          # Name of the target PVC.
  pod_name: &lt;pod_name&gt;          # Name of the pod where the PVC is mounted. It will be ignored if the pvc_name is defined.
  namespace: &lt;namespace_name&gt;   # Namespace where the PVC is.
  fill_percentage: 50           # Target percentage to fill up the cluster. Value must be higher than current percentage. Valid values are between 0 and 99.
  duration: 60                  # Duration in seconds for the fault.
</code></pre><h5 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h5>
<ul>
<li>Get the pod name where the PVC is mounted.</li>
<li>Get the volume name mounted in the container pod.</li>
<li>Get the container name where the PVC is mounted.</li>
<li>Get the mount path where the PVC is mounted in the pod.</li>
<li>Get the PVC capacity and current used capacity.</li>
<li>Calculate file size to fill the PVC to the target fill_percentage.</li>
<li>Connect to the pod.</li>
<li>Create a temp file <code>kraken.tmp</code> with random data on the mount path:
<ul>
<li><code>dd bs=1024 count=$file_size &lt;/dev/urandom &gt; /mount_path/kraken.tmp</code></li>
</ul>
</li>
<li>Wait for the duration time.</li>
<li>Remove the temp file created:
<ul>
<li><code>rm kraken.tmp</code></li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a07e0c044e3bf878a9d652efab248a8a">3.13.2 - PVC Scenario using Krkn-Hub</h1>
    
	<p>This scenario fills up a given PersistenVolumeClaim by creating a temp file on the PVC from a pod associated with it. The purpose of this scenario is to fill up a volume to understand faults cause by the application using this volume. For more information refer the following <a href="/docs/scenarios/pvc-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>If both <code>PVC_NAME</code> and <code>POD_NAME</code> are defined, <code>POD_NAME</code> value will be overridden from the <code>Mounted By:</code> value on PVC definition.</p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>PVC_NAME</td>
<td>Targeted PersistentVolumeClaim in the cluster (if null, POD_NAME is required)</td>
<td></td>
</tr>
<tr>
<td>POD_NAME</td>
<td>Targeted pod in the cluster (if null, PVC_NAME is required)</td>
<td></td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Targeted namespace in the cluster (required)</td>
<td></td>
</tr>
<tr>
<td>FILL_PERCENTAGE</td>
<td>Targeted percentage to be filled up in the PVC</td>
<td>50</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration in seconds with the PVC filled up</td>
<td>60</td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Set NAMESPACE environment variable to <code>openshift-.*</code> to pick and disrupt pods randomly in openshift system namespaces, the DAEMON_MODE can also be enabled to disrupt the pods every x seconds in the background to check the reliability.

</div>

<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:pvc-scenarios
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-71b2337dd184e179e48995c1b262ac17">3.14 - Service Disruption Scenarios</h1>
    
	<p>Using this type of scenario configuration one is able to delete crucial objects in a specific namespace, or a namespace matching a certain regex string.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c229626aef295356c4fa6fb05ffe42db">3.14.1 - Service Disruption Scenarios using Krkn</h1>
    
	<h2 id="configuration-options">Configuration Options:<a class="td-heading-self-link" href="#configuration-options" aria-label="Heading self-link"></a></h2>
<p><strong>namespace:</strong> Specific namespace or regex style namespace of what you want to delete. Gets all namespaces if not specified; set to &quot;&quot; if you want to use the label_selector field.</p>
<p>Set to &lsquo;^.*$&rsquo; and label_selector to &quot;&quot; to randomly select any namespace in your cluster.</p>
<p><strong>label_selector:</strong> Label on the namespace you want to delete. Set to &quot;&quot; if you are using the namespace variable.</p>
<p><strong>delete_count:</strong> Number of namespaces to kill in each run. Based on matching namespace and label specified, default is 1.</p>
<p><strong>runs:</strong> Number of runs/iterations to kill namespaces, default is 1.</p>
<p><strong>sleep:</strong> Number of seconds to wait between each iteration/count of killing namespaces. Defaults to 10 seconds if not set</p>
<p>Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/regex_namespace.yaml">namespace_scenarios_example</a> config file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;^.*$&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;^.*ingress.*$&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">runs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sleep</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="steps">Steps<a class="td-heading-self-link" href="#steps" aria-label="Heading self-link"></a></h3>
<p>This scenario will select a namespace (or multiple) dependent on the configuration and will kill all of the below object types in that namespace and will wait for them to be Running in the post action</p>
<ol>
<li>Services</li>
<li>Daemonsets</li>
<li>Statefulsets</li>
<li>Replicasets</li>
<li>Deployments</li>
</ol>
<h4 id="post-action">Post Action<a class="td-heading-self-link" href="#post-action" aria-label="Heading self-link"></a></h4>
<p>We do a post chaos check to wait and verify the specific objects in each namespace are Ready</p>
<p>Here there are two options:</p>
<ol>
<li>Pass a custom script in the main config scenario list that will run before the chaos and verify the output matches post chaos scenario.</li>
</ol>
<p>See <a href="https://github.com/cloud-bulldozer/kraken/tree/master/scenarios/post_action_namespace.py">scenarios/post_action_namespace.py</a> for an example</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">     </span>- - <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/regex_namespace.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">scenarios/post_action_namespace.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ol>
<li>Allow kraken to wait and check all killed objects in the namespaces become &lsquo;Running&rsquo; again. Kraken keeps a list of the specific
objects in namespaces that were killed to verify all that were affected recover properly.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">wait_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;seconds to wait for namespace to recover&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-afd27124a9063adebb9970a5b2f94b01">3.14.2 - Service Disruption Scenario using Krkn-Hub</h1>
    
	<p>This scenario deletes main objects within a namespace in your Kubernetes/OpenShift cluster. More information can be found <a href="/docs/scenarios/service-disruption-scenarios/">here</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the namespace to target. Set this parameter only if NAMESPACE is not set</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Name of the namespace you want to target. Set this parameter only if LABEL_SELECTOR is not set</td>
<td>&ldquo;openshift-etcd&rdquo;</td>
</tr>
<tr>
<td>SLEEP</td>
<td>Number of seconds to wait before polling to see if namespace exists again</td>
<td>15</td>
</tr>
<tr>
<td>DELETE_COUNT</td>
<td>Number of namespaces to kill in each run, based on matching namespace and label specified</td>
<td>1</td>
</tr>
<tr>
<td>RUNS</td>
<td>Number of runs to execute the action</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:service-disruption-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/kKPSI0D7upV9HQWH5jnroTaKb">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ce393854ff3da73a278e77f5f3f45ac4">3.15 - Service Hijacking Scenario</h1>
    
	<p>Service Hijacking Scenarios aim to simulate fake HTTP responses from a workload targeted by a Service already deployed in the cluster. This scenario is executed by deploying a custom-made web service and modifying the target Service selector to direct traffic to this web service for a specified duration.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-0326ec69aa2cf1ccbeb0b57479a77dba">3.15.1 - Service Hijacking Scenarios using Krkn</h1>
    
	<p>The web service&rsquo;s source code is available <a href="https://github.com/krkn-chaos/krkn-service-hijacking">here</a>.
It employs a time-based test plan from the scenario configuration file, which specifies the behavior of resources during the chaos scenario as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">service_target_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http-web-svc</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The port of the service to be hijacked (can be named or numeric, based on the workload and service configuration).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">service_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nginx-service</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The name of the service that will be hijacked.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">service_namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The namespace where the target service is located.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">quay.io/krkn-chaos/krkn-service-hijacking:v0.1.3</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Image of the krkn web service to be deployed to receive traffic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">chaos_duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Total duration of the chaos scenario in seconds.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">plan</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">resource</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/list/index.php&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Specifies the resource or path to respond to in the scenario. For paths, both the path and query parameters are captured but ignored. For resources, only query parameters are captured.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#8f5902;font-style:italic"># A time-based plan consisting of steps can be defined for each resource.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">GET:                      # One or more HTTP methods can be specified for each step. Note</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Non-standard methods are supported for fully custom web services (e.g., using NONEXISTENT instead of POST).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Duration in seconds for this step before moving to the next one, if defined. Otherwise, this step will continue until the chaos scenario ends.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">500</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#8f5902;font-style:italic"># HTTP status code to be returned in this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># MIME type of the response for this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">|           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># The response payload for this step.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>{<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#4e9a06">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;internal server error&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">201</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            {
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">              &#34;status&#34;:&#34;resource created&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            }</span><span style="color:#f8f8f8;text-decoration:underline">            
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">POST</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">401</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            {
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">               &#34;status&#34;: &#34;unauthorized&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            }</span><span style="color:#f8f8f8;text-decoration:underline">            
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">404</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mime_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;text/plain&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">payload</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;not found&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The scenario will focus on the <code>service_name</code> within the <code>service_namespace</code>,
substituting the selector with a randomly generated one, which is added as a label in the mock service manifest.
This allows multiple scenarios to be executed in the same namespace, each targeting different services without
causing conflicts.</p>
<p>The newly deployed mock web service will expose a <code>service_target_port</code>,
which can be either a named or numeric port based on the service configuration.
This ensures that the Service correctly routes HTTP traffic to the mock web service during the chaos run.</p>
<p>Each step will last for <code>duration</code> seconds from the deployment of the mock web service in the cluster.
For each HTTP resource, defined as a top-level YAML property of the plan
(it could be a specific resource, e.g., /list/index.php, or a path-based resource typical in MVC frameworks),
one or more HTTP request methods can be specified. Both standard and custom request methods are supported.</p>
<p>During this time frame, the web service will respond with:</p>
<ul>
<li><code>status</code>: The <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-6">HTTP status code</a> (can be standard or custom).</li>
<li><code>mime_type</code>: The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME type</a> (can be standard or custom).</li>
<li><code>payload</code>: The response body to be returned to the client.</li>
</ul>
<p>At the end of the step <code>duration</code>, the web service will proceed to the next step (if available) until
the global <code>chaos_duration</code> concludes. At this point, the original service will be restored,
and the custom web service and its resources will be undeployed.</p>
<p><strong>NOTE</strong>: Some clients (e.g., cURL, jQuery) may optimize queries using lightweight methods (like HEAD or OPTIONS)
to probe API behavior. If these methods are not defined in the test plan, the web service may respond with
a <code>405</code> or <code>404</code> status code. If you encounter unexpected behavior, consider this use case.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8645cf3ca8634c69a0c8ad7ac90fbe06">3.15.2 - Service Hijacking Scenario using Krkn-Hub</h1>
    
	<p>This scenario reroutes traffic intended for a target service to a custom web service that is automatically deployed by Krkn.
This web service responds with user-defined HTTP statuses, MIME types, and bodies.
For more details, please refer to the following <a href="/docs/scenarios/service-hijacking-scenario/">documentation</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>Unlike other krkn-hub scenarios, this one requires a specific configuration due to its unique structure.
You must set up the scenario in a local file following the <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/kube/service_hijacking.yaml">scenario syntax</a>,
and then pass this file&rsquo;s base64-encoded content to the container via the SCENARIO_BASE64 variable.</p>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>.
Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code>
environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run  --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>              -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>              -v &lt;path_to_kubeconfig&gt;:/home/krkn/.kube/config:Z quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>              
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                       -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>                                     -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    ecause the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:
example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="all_scenarios_env.md">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SCENARIO_BASE64</td>
<td>Base64 encoded service-hijacking scenario file. Note that the <strong>-w0</strong> option in the command substitution <code>SCENARIO_BASE64=&quot;$(base64 -w0 &lt;scenario_file&gt;)&quot;</code> is <strong>mandatory</strong> in order to remove line breaks from the base64 command output</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run -e <span style="color:#000">SCENARIO_BASE64</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>base64 -w0 &lt;scenario_file&gt;<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --net<span style="color:#ce5c00;font-weight:bold">=</span>host <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>             -d quay.io/krkn-chaos/krkn-hub:service-hijacking
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a4fbbfbd8b11ce2dd79180e169a6c09c">3.16 - Time Scenarios</h1>
    
	<p>Using this type of scenario configuration, one is able to change the time and/or date of the system for pods or nodes.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4e099f299e4e2e9c590fc5a8f3dbdb1f">3.16.1 - Time Scenarios using Krkn</h1>
    
	<h3 id="configuration-options">Configuration Options:<a class="td-heading-self-link" href="#configuration-options" aria-label="Heading self-link"></a></h3>
<p><strong>action:</strong> skew_time or skew_date.</p>
<p><strong>object_type:</strong> pod or node.</p>
<p><strong>namespace:</strong> namespace of the pods you want to skew. Needs to be set if setting a specific pod name.</p>
<p><strong>label_selector:</strong> Label on the nodes or pods you want to skew.</p>
<p><strong>container_name:</strong> Container name in pod you want to reset time on. If left blank it will randomly select one.</p>
<p><strong>object_name:</strong> List of the names of pods or nodes you want to skew.</p>
<p>Refer to <a href="https://github.com/krkn-chaos/krkn/blob/main/scenarios/time_scenarios_example.yml">time_scenarios_example</a> config file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">time_scenarios</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">skew_time</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">apiserver-868595fcbb-6qnsc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">apiserver-868595fcbb-mb9j5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">action</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">skew_date</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">object_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">label_selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/worker</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f029f0161de9931fff733ccc2fde58e5">3.16.2 - Time Skew Scenarios using Krkn-Hub</h1>
    
	<p>This scenario skews the date and time of the nodes and pods matching the label on a Kubernetes/OpenShift cluster. More information can be found <a href="/docs/scenarios/time-scenarios/">here</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:time-scenarios
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJECT_TYPE</td>
<td>Object to target. Supported options: pod, node</td>
<td>pod</td>
</tr>
<tr>
<td>LABEL_SELECTOR</td>
<td>Label of the container(s) or nodes to target</td>
<td>k8s-app=etcd</td>
</tr>
<tr>
<td>ACTION</td>
<td>Action to run. Supported actions: skew_time, skew_date</td>
<td>skew_date</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>List of the names of pods or nodes you want to skew ( optional parameter )</td>
<td>[]</td>
</tr>
<tr>
<td>CONTAINER_NAME</td>
<td>Container in the specified pod to target in case the pod has multiple containers running. Random container is picked if empty</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>Namespace of the pods you want to skew, need to be set only if setting a specific pod name</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/zMBAdzHE40oPXkFVIz0exEoOX">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-de67113eb2d27bfedac46c07b5c4db22">3.17 - Zone Outage Scenarios</h1>
    
	<p>Scenario to create outage in a targeted zone in the public cloud to understand the impact on both Kubernetes/OpenShift control plane as well as applications running on the worker nodes in that zone. It tweaks the network acl of the zone to simulate the failure and that in turn will stop both ingress and egress traffic from all the nodes in a particular zone for the specified duration and reverts it back to the previous state.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a98bdfa4b92598e3eeed675e2a73ea11">3.17.1 - Zone Outage Scenarios using Krkn</h1>
    
	<p>Zone outage can be injected by placing the zone_outage config file under zone_outages option in the <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml">kraken config</a>. Refer to <a href="https://github.com/redhat-chaos/krkn/blob/main/scenarios/zone_outage.yaml">zone_outage_scenario</a> config file for the parameters that need to be defined.</p>
<p>Refer to <a href="/docs/scenarios/cloud_setup/">cloud setup</a> to configure your cli properly for the cloud provider of the cluster you want to shut down.</p>
<h5 id="current-accepted-cloud-types">Current accepted cloud types:<a class="td-heading-self-link" href="#current-accepted-cloud-types" aria-label="Heading self-link"></a></h5>
<ul>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
</ul>
<h5 id="sample-scenario-config">Sample scenario config<a class="td-heading-self-link" href="#sample-scenario-config" aria-label="Heading self-link"></a></h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">zone_outage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                         </span><span style="color:#8f5902;font-style:italic"># Scenario to create an outage of a zone by tweaking network ACL.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cloud_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws                                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Cloud type on which Kubernetes/OpenShift runs. aws is the only platform supported currently for this scenario.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">duration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">600</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># Duration in seconds after which the zone will be back online.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vpc_id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                            </span><span style="color:#8f5902;font-style:italic"># Cluster virtual private network to target.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">subnet_id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">subnet1, subnet2]                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># List of subnet-id&#39;s to deny both ingress and egress traffic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    vpc_id and subnet_id can be obtained from the cloud web console by selecting one of the instances in the targeted zone ( us-west-2a for example ).

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Multiple zones will experience downtime in case of targeting multiple subnets which might have an impact on the cluster health especially if the zones have control plane components deployed.

</div>

<h5 id="debugging-steps-in-case-of-failures">Debugging steps in case of failures<a class="td-heading-self-link" href="#debugging-steps-in-case-of-failures" aria-label="Heading self-link"></a></h5>
<p>In case of failures during the steps which revert back the network acl to allow traffic and bring back the cluster nodes in the zone, the nodes in the particular zone will be in <code>NotReady</code> condition. Here is how to fix it:</p>
<ul>
<li>OpenShift by default deploys the nodes in different zones for fault tolerance, for example us-west-2a, us-west-2b, us-west-2c. The cluster is associated with a virtual private network and each zone has its own subnet with a network acl which defines the ingress and egress traffic rules at the zone level unlike security groups which are at an instance level.</li>
<li>From the cloud web console, select one of the instances in the zone which is down and go to the subnet_id specified in the config.</li>
<li>Look at the network acl associated with the subnet and you will see both ingress and egress traffic being denied which is expected as Kraken deliberately injects it.</li>
<li>Kraken just switches the network acl while still keeping the original or default network acl around, switching to the default network acl from the drop-down menu will get back the nodes in the targeted zone into Ready state.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ac460820001befdfa88a92bc5f36f753">3.17.2 - Zone Outage Scenarios using Krkn-Hub</h1>
    
	<p>This scenario disrupts a targeted zone in the public cloud by blocking egress and ingress traffic to understand the impact on both Kubernetes/OpenShift platforms control plane as well as applications running on the worker nodes in that zone. More information is documented <a href="/docs/scenarios/zone-outage-scenarios/">here</a></p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<p>If enabling <a href="/docs/cerberus/">Cerberus</a> to monitor the cluster and pass/fail the scenario post chaos, refer <a href="/docs/cerberus/">docs</a>. Make sure to start it before injecting the chaos and set <code>CERBERUS_ENABLED</code> environment variable for the chaos injection container to autoconnect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>$ podman logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ podman inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker run <span style="color:#204a87;font-weight:bold">$(</span>./get_docker_params.sh<span style="color:#204a87;font-weight:bold">)</span> --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>OR 
</span></span><span style="display:flex;"><span>$ docker run -e &lt;VARIABLE&gt;<span style="color:#ce5c00;font-weight:bold">=</span>&lt;value&gt; --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:zone-outages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ docker logs -f &lt;container_name or container_id&gt; <span style="color:#8f5902;font-style:italic"># Streams Kraken logs</span>
</span></span><span style="display:flex;"><span>$ docker inspect &lt;container-name or container-id&gt; --format <span style="color:#4e9a06">&#34;{{.State.ExitCode}}&#34;</span> <span style="color:#8f5902;font-style:italic"># Outputs exit code which can considered as pass/fail for the scenario</span>
</span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Tip</h4>

    Because the container runs with a non-root user, ensure the kube config is globally readable before mounting it in the container. You can achieve this with the following commands:
<code>kubectl config view --flatten &gt; ~/kubeconfig &amp;&amp; chmod 444 ~/kubeconfig &amp;&amp; docker run $(./get_docker_params.sh) --name=&lt;container_name&gt; --net=host -v ~kubeconfig:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:&lt;scenario&gt;</code>

</div>

<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<p>See list of variables that apply to all scenarios <a href="/docs/scenarios/all-scenario-env/">here</a> that can be used/set in addition to these scenario specific variables</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLOUD_TYPE</td>
<td>Cloud platform on top of which cluster is running, <a href="/docs/scenarios/cloud_setup/">supported cloud platforms</a></td>
<td>aws</td>
</tr>
<tr>
<td>DURATION</td>
<td>Duration in seconds after which the zone will be back online</td>
<td>600</td>
</tr>
<tr>
<td>VPC_ID</td>
<td>cluster virtual private network to target ( REQUIRED )</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>SUBNET_ID</td>
<td>subnet-id to deny both ingress and egress traffic ( REQUIRED ). Format: [subenet1, subnet2]</td>
<td>&quot;&quot;</td>
</tr>
</tbody>
</table>
<p>The following environment variables need to be set for the scenarios that requires intereacting with the cloud platform API to perform the actions:</p>
<p>Amazon Web Services</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_ACCESS_KEY_ID</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_SECRET_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">export</span> <span style="color:#000">AWS_DEFAULT_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;&gt;
</span></span></code></pre></div><p>Google Cloud Platform</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Azure</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>OpenStack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>Baremetal</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>TBD
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    In case of using custom metrics profile or alerts profile when <code>CAPTURE_METRICS</code> or <code>ENABLE_ALERTS</code> is enabled, mount the metrics profile from the host on which the container is run using podman/docker under <code>/home/krkn/kraken/config/metrics-aggregated.yaml</code> and <code>/home/krkn/kraken/config/alerts</code>.

</div>

For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --net<span style="color:#ce5c00;font-weight:bold">=</span>host --env-host<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -v &lt;path-to-custom-metrics-profile&gt;:/home/krkn/kraken/config/metrics-aggregated.yaml -v &lt;path-to-custom-alerts-profile&gt;:/home/krkn/kraken/config/alerts -v &lt;path-to-kube-config&gt;:/home/krkn/.kube/config:Z -d quay.io/krkn-chaos/krkn-hub:container-scenarios
</span></span></code></pre></div><h4 id="demo">Demo<a class="td-heading-self-link" href="#demo" aria-label="Heading self-link"></a></h4>
<p>You can find a link to a demo of the scenario <a href="https://asciinema.org/a/452672?speed=3&theme=solarized-dark">here</a></p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-31dc471e07bb163ac298937597cfdea2">3.18 - All Scenarios Variables</h1>
    
	<p>These variables are to be used for the top level configuration template that are shared by all the scenarios</p>
<p>See the description and default values below</p>
<h4 id="supported-parameters">Supported parameters<a class="td-heading-self-link" href="#supported-parameters" aria-label="Heading self-link"></a></h4>
<p>The following environment variables can be set on the host running the container to tweak the scenario/faults being injected:</p>
<p>example:
<code>export &lt;parameter_name&gt;=&lt;value&gt;</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>CERBERUS_ENABLED</td>
<td>Set this to true if cerberus is running and monitoring the cluster</td>
<td>False</td>
</tr>
<tr>
<td>CERBERUS_URL</td>
<td>URL to poll for the go/no-go signal</td>
<td>http://0.0.0.0:8080</td>
</tr>
<tr>
<td>WAIT_DURATION</td>
<td>Duration in seconds to wait between each chaos scenario</td>
<td>60</td>
</tr>
<tr>
<td>ITERATIONS</td>
<td>Number of times to execute the scenarios</td>
<td>1</td>
</tr>
<tr>
<td>DAEMON_MODE</td>
<td>Iterations are set to infinity which means that the kraken will cause chaos forever</td>
<td>False</td>
</tr>
<tr>
<td>PUBLISH_KRAKEN_STATUS</td>
<td>If you want</td>
<td>True</td>
</tr>
<tr>
<td>SIGNAL_ADDRESS</td>
<td>Address to print kraken status to</td>
<td>0.0.0.0</td>
</tr>
<tr>
<td>PORT</td>
<td>Port to print kraken status to</td>
<td>8081</td>
</tr>
<tr>
<td>SIGNAL_STATE</td>
<td>Waits for the RUN signal when set to PAUSE before running the scenarios, refer <a href="https://github.com/redhat-chaos/krkn/blob/master/docs/signal.md">docs</a> for more details</td>
<td>RUN</td>
</tr>
<tr>
<td>DEPLOY_DASHBOARDS</td>
<td>Deploys mutable grafana loaded with dashboards visualizing performance metrics pulled from in-cluster prometheus. The dashboard will be exposed as a route.</td>
<td>False</td>
</tr>
<tr>
<td>CAPTURE_METRICS</td>
<td>Captures metrics as specified in the profile from in-cluster prometheus. Default metrics captures are listed <a href="https://github.com/redhat-chaos/krkn/blob/master/config/metrics-aggregated.yaml">here</a></td>
<td>False</td>
</tr>
<tr>
<td>ENABLE_ALERTS</td>
<td>Evaluates expressions from in-cluster prometheus and exits 0 or 1 based on the severity set. <a href="https://github.com/redhat-chaos/krkn/blob/master/config/alerts">Default profile</a>. More details can be found <a href="https://github.com/redhat-chaos/krkn#alerts">here</a></td>
<td>False</td>
</tr>
<tr>
<td>ALERTS_PATH</td>
<td>Path to the alerts file to use when ENABLE_ALERTS is set</td>
<td>config/alerts</td>
</tr>
<tr>
<td>CHECK_CRITICAL_ALERTS</td>
<td>When enabled will check prometheus for critical alerts firing post chaos</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_ENABLED</td>
<td>Enable/disables the telemetry collection feature</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_API_URL</td>
<td>telemetry service endpoint</td>
<td><a href="https://ulnmf9xv7j.execute-api.us-west-2.amazonaws.com/production">https://ulnmf9xv7j.execute-api.us-west-2.amazonaws.com/production</a></td>
</tr>
<tr>
<td>TELEMETRY_USERNAME</td>
<td>telemetry service username</td>
<td>redhat-chaos</td>
</tr>
<tr>
<td>TELEMETRY_PASSWORD</td>
<td></td>
<td>No default</td>
</tr>
<tr>
<td>TELEMETRY_PROMETHEUS_BACKUP</td>
<td>enables/disables prometheus data collection</td>
<td>True</td>
</tr>
<tr>
<td>TELEMTRY_FULL_PROMETHEUS_BACKUP</td>
<td>if is set to False only the /prometheus/wal folder will be downloaded</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_BACKUP_THREADS</td>
<td>number of telemetry download/upload threads</td>
<td>5</td>
</tr>
<tr>
<td>TELEMETRY_ARCHIVE_PATH</td>
<td>local path where the archive files will be temporarly stored</td>
<td>/tmp</td>
</tr>
<tr>
<td>TELEMETRY_MAX_RETRIES</td>
<td>maximum number of upload retries (if 0 will retry forever)</td>
<td>0</td>
</tr>
<tr>
<td>TELEMETRY_RUN_TAG</td>
<td>if set, this will be appended to the run folder in the bucket (useful to group the runs</td>
<td>chaos</td>
</tr>
<tr>
<td>TELEMETRY_GROUP</td>
<td>if set will archive the telemetry in the S3 bucket on a folder named after the value</td>
<td>default</td>
</tr>
<tr>
<td>TELEMETRY_ARCHIVE_SIZE</td>
<td>the size of the prometheus data archive size in KB. The lower the size of archive is</td>
<td>1000</td>
</tr>
<tr>
<td>TELEMETRY_LOGS_BACKUP</td>
<td>Logs backup to s3</td>
<td>False</td>
</tr>
<tr>
<td>TELEMETRY_FILTER_PATTER</td>
<td>Filter logs based on certain time stamp patterns</td>
<td>[&quot;(\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\.\d+).+&quot;,&ldquo;kinit (\d+/\d+/\d+\s\d{2}:\d{2}:\d{2})\s+&rdquo;,&quot;(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d+Z).+&quot;]</td>
</tr>
<tr>
<td>TELEMETRY_CLI_PATH</td>
<td>OC Cli path, if not specified will be search in $PATH</td>
<td><em>blank</em></td>
</tr>
<tr>
<td>ELASTIC_SERVER</td>
<td>Be able to track telemtry data in elasticsearch, this is the url of the elasticsearch data storage</td>
<td><em>blank</em></td>
</tr>
<tr>
<td>ELASTIC_INDEX</td>
<td>Elastic search index pattern to post results to</td>
<td><em>blank</em></td>
</tr>
</tbody>
</table>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    For setting the TELEMETRY_ARCHIVE_SIZE,the higher the number of archive files will be produced and uploaded (and processed by backup_thread simultaneously).For unstable/slow connection is better to keep this value low increasing the number of backup_threads, in this way, on upload failure, the retry will happen only on the failed chunk without affecting the whole upload.

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41ff6593888c87620d21a5a31c783466">3.19 - Supported Cloud Providers</h1>
    
	<ul>
<li><a href="/docs/scenarios/cloud_setup/#aws">AWS</a></li>
<li><a href="/docs/scenarios/cloud_setup/#gcp">GCP</a></li>
<li><a href="/docs/scenarios/cloud_setup/#openstack">Openstack</a></li>
<li><a href="/docs/scenarios/cloud_setup/#azure">Azure</a></li>
<li><a href="/docs/scenarios/cloud_setup/#alibaba">Alibaba</a></li>
<li><a href="/docs/scenarios/cloud_setup/#vmware">VMware</a></li>
<li><a href="/docs/scenarios/cloud_setup/#ibmcloud">IBMCloud</a></li>
</ul>
<h2 id="aws">AWS<a class="td-heading-self-link" href="#aws" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with AWS make sure <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a> is installed and properly <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">configured</a> using an AWS account</p>
<h2 id="gcp">GCP<a class="td-heading-self-link" href="#gcp" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with GCP make sure <a href="https://cloud.google.com/sdk/docs/install#linux">GCP CLI</a> is installed.</p>
<p>A google service account is required to give proper authentication to GCP for node actions. See <a href="https://cloud.google.com/docs/authentication/getting-started">here</a> for how to create a service account.</p>
<p><strong>NOTE</strong>: A user with &lsquo;resourcemanager.projects.setIamPolicy&rsquo; permission is required to grant project-level permissions to the service account.</p>
<p>After creating the service account you will need to enable the account using the following: <code>export GOOGLE_APPLICATION_CREDENTIALS=&quot;&lt;serviceaccount.json&gt;&quot;</code></p>
<h2 id="openstack">Openstack<a class="td-heading-self-link" href="#openstack" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: For clusters with Openstack Cloud, ensure to create and source the <a href="https://docs.openstack.org/newton/user-guide/common/cli-set-environment-variables-using-openstack-rc.html">OPENSTACK RC file</a> to set the OPENSTACK environment variables from the server where Kraken runs.</p>
<h2 id="azure">Azure<a class="td-heading-self-link" href="#azure" aria-label="Heading self-link"></a></h2>
<p><strong>NOTE</strong>: You will need to create a service principal and give it the correct access, see <a href="https://docs.openshift.com/container-platform/4.5/installing/installing_azure/installing-azure-account.html">here</a> for creating the service principal and setting the proper permissions.</p>
<p>To properly run the service principal requires â€œAzure Active Directory Graph/Application.ReadWrite.OwnedByâ€ api permission granted and â€œUser Access Administratorâ€.</p>
<p>Before running you will need to set the following:</p>
<ol>
<li>
<p><code>export AZURE_SUBSCRIPTION_ID=&lt;subscription_id&gt;</code></p>
</li>
<li>
<p><code>export AZURE_TENANT_ID=&lt;tenant_id&gt;</code></p>
</li>
<li>
<p><code>export AZURE_CLIENT_SECRET=&lt;client secret&gt;</code></p>
</li>
<li>
<p><code>export AZURE_CLIENT_ID=&lt;client id&gt;</code></p>
</li>
</ol>
<h2 id="alibaba">Alibaba<a class="td-heading-self-link" href="#alibaba" aria-label="Heading self-link"></a></h2>
<p>See the <a href="https://www.alibabacloud.com/help/en/alibaba-cloud-cli/latest/installation-guide">Installation guide</a> to install alicloud cli.</p>
<ol>
<li>
<p><code>export ALIBABA_ID=&lt;access_key_id&gt;</code></p>
</li>
<li>
<p><code>export ALIBABA_SECRET=&lt;access key secret&gt;</code></p>
</li>
<li>
<p><code>export ALIBABA_REGION_ID=&lt;region id&gt;</code></p>
</li>
</ol>
<p>Refer to <a href="https://www.alibabacloud.com/help/en/elastic-compute-service/latest/regions-and-zones#concept-2459516">region and zone page</a> to get the region id for the region you are running on.</p>
<p>Set cloud_type to either alibaba or alicloud in your node scenario yaml file.</p>
<h2 id="vmware">VMware<a class="td-heading-self-link" href="#vmware" aria-label="Heading self-link"></a></h2>
<p>Set the following environment variables</p>
<ol>
<li>
<p><code>export VSPHERE_IP=&lt;vSphere_client_IP_address&gt;</code></p>
</li>
<li>
<p><code>export VSPHERE_USERNAME=&lt;vSphere_client_username&gt;</code></p>
</li>
<li>
<p><code>export VSPHERE_PASSWORD=&lt;vSphere_client_password&gt;</code></p>
</li>
</ol>
<p>These are the credentials that you would normally use to access the vSphere client.</p>
<h2 id="ibmcloud">IBMCloud<a class="td-heading-self-link" href="#ibmcloud" aria-label="Heading self-link"></a></h2>
<p>If no api key is set up with proper VPC resource permissions, use the following to create:</p>
<ul>
<li>Access group</li>
<li>Service id with the following access
<ul>
<li>With policy <strong>VPC Infrastructure Services</strong></li>
<li>Resources = All</li>
<li>Roles:
<ul>
<li>Editor</li>
<li>Administrator</li>
<li>Operator</li>
<li>Viewer</li>
</ul>
</li>
</ul>
</li>
<li>API Key</li>
</ul>
<p>Set the following environment variables</p>
<ol>
<li>
<p><code>export IBMC_URL=https://&lt;region&gt;.iaas.cloud.ibm.com/v1</code></p>
</li>
<li>
<p><code>export IBMC_APIKEY=&lt;ibmcloud_api_key&gt;</code></p>
</li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c0ffe4f5ae7990ffa2481add52e8ce49">4 - Chaos Testing Guide</h1>
    
	<h3 id="table-of-contents">Table of Contents<a class="td-heading-self-link" href="#table-of-contents" aria-label="Heading self-link"></a></h3>
<ul>
<li><a href="/docs/chaos-testing-guide/#test-strategies-and-methodology">Test Stratagies and Methodology</a></li>
<li><a href="/docs/chaos-testing-guide/#best-practices">Best Practices</a></li>
<li><a href="/docs/chaos-testing-guide/#tooling">Tooling</a>
<ul>
<li><a href="/docs/chaos-testing-guide/#cluster-recovery-checks-metrics-evaluation-and-passfail-criteria">Cluster recovery checks, metrics evaluation and pass/fail criteria</a></li>
</ul>
</li>
<li><a href="/docs/chaos-testing-guide/#scenarios">Scenarios</a></li>
<li><a href="/docs/chaos-testing-guide/#test-environment-recommendations---how-and-where-to-run-chaos-tests">Test Environment Recommendations - how and where to run chaos tests</a></li>
<li><a href="/docs/chaos-testing-guide/#chaos-testing-in-practice">Chaos testing in Practice</a>
<ul>
<li><a href="/docs/chaos-testing-guide/#openshift-organization">OpenShift organization</a></li>
<li><a href="/docs/chaos-testing-guide/#startx-lab">startx-lab</a></li>
</ul>
</li>
</ul>
<h3 id="test-strategies-and-methodology">Test Strategies and Methodology<a class="td-heading-self-link" href="#test-strategies-and-methodology" aria-label="Heading self-link"></a></h3>
<p>Failures in production are costly. To help mitigate risk to service health, consider the following strategies and approaches to service testing:</p>
<ul>
<li>
<p>Be proactive vs reactive. We have different types of test suites in place - unit, integration and end-to-end - that help expose bugs in code in a controlled environment.  Through implementation of a chaos engineering strategy, we can discover potential causes of service degradation. We need to understand the systems&rsquo; behavior under unpredictable conditions in order to find the areas to harden, and use performance data points to size the clusters to handle failures in order to keep downtime to a minimum.</p>
</li>
<li>
<p>Test the resiliency of a system under turbulent conditions by running tests that are designed to disrupt while monitoring the systems adaptability and performance:</p>
<ul>
<li>Establish and define your steady state and metrics - understand the behavior and performance under stable conditions and define the metrics that will be used to evaluate the systemâ€™s behavior.  Then decide on acceptable outcomes before injecting chaos.</li>
<li>Analyze the statuses and metrics of all components during the chaos test runs.</li>
<li>Improve the areas that are not resilient and performant by comparing the key metrics and Service Level Objectives (SLOs) to the stable conditions before the chaos.
For example: evaluating the API server latency or application uptime to see if the key performance indicators and service level indicators are still within acceptable limits.</li>
</ul>
</li>
</ul>
<h3 id="best-practices">Best Practices<a class="td-heading-self-link" href="#best-practices" aria-label="Heading self-link"></a></h3>
<p>Now that we understand the test methodology, let us take a look at the best practices for an Kubernetes cluster.  On that platform there are user applications and cluster workloads that need to be designed for stability and to provide the best user experience possible:</p>
<ul>
<li>
<p>Alerts with appropriate severity should get fired.</p>
<ul>
<li>Alerts are key to identify when a component starts degrading, and can help focus the investigation effort on affected system components.</li>
<li>Alerts should have proper severity, description, notification policy, escalation policy, and SOP in order to reduce MTTR for responding SRE or Ops resources.</li>
<li>Detailed information on the alerts consistency can be found <a href="https://github.com/openshift/enhancements/blob/master/enhancements/monitoring/alerting-consistency.md">here</a>.</li>
</ul>
</li>
<li>
<p>Minimal performance impact - Network, CPU, Memory, Disk, Throughput etc.</p>
<ul>
<li>The system, as well as the applications, should be designed to have minimal performance impact during disruptions to ensure stability and also to avoid hogging resources that other applications can use.
We want to look at this in terms of CPU, Memory, Disk, Throughput, Network etc.</li>
<li>We want to look at this in terms of CPU, Memory, Disk, Throughput, Network etc.</li>
</ul>
</li>
<li>
<p>Appropriate CPU/Memory limits set to avoid performance throttling and OOM kills.</p>
<ul>
<li>There might be rogue applications hogging resources ( CPU/Memory ) on the nodes which might lead to applications underperforming or worse getting OOM killed. It is important to ensure that applications and system components have reserved resources for the kube-scheduler to take into consideration in order to keep them performing at the expected levels.</li>
</ul>
</li>
<li>
<p>Services dependent on the system under test need to handle the failure gracefully to avoid performance degradation and downtime - appropriate timeouts.</p>
<ul>
<li>In a distributed system, services deployed coordinate with each other and might have external dependencies. Each of the services deployed as a deployment, pod, or container, need to handle the downtime of other dependent services gracefully instead of crashing due to not having appropriate timeouts, fallback logic etc.</li>
</ul>
</li>
<li>
<p>Proper node sizing to avoid cascading failures and ensure cluster stability especially when the cluster is large and dense</p>
<ul>
<li>The platform needs to be sized taking into account the resource usage spikes that might occur during chaotic events. For example, if one of the main nodes goes down, the other two main nodes need to have enough resources to handle the load. The resource usage depends on the load or number of objects that are running being managed by the Control Plane ( Api Server, Etcd, Controller and Scheduler ). As such, itâ€™s critical to test such conditions, understand the behavior, and leverage the data to size the platform appropriately. This can help keep the applications stable during unplanned events without the control plane undergoing cascading failures which can potentially bring down the entire cluster.</li>
</ul>
</li>
<li>
<p>Proper node sizing to avoid application failures and maintain stability.</p>
<ul>
<li>An application pod might use more resources during reinitialization after a crash, so it is important to take that into account for sizing the nodes in the cluster to accommodate it. For example, monitoring solutions like Prometheus need high amounts of memory to replay the write ahead log ( WAL ) when it restarts. As such, itâ€™s critical to test such conditions, understand the behavior, and leverage the data to size the platform appropriately. This can help keep the application stable during unplanned events without undergoing degradation in performance or even worse hog the resources on the node which can impact other applications and system pods.</li>
</ul>
</li>
<li>
<p>Minimal initialization time and fast recovery logic.</p>
<ul>
<li>The controller watching the component should recognize a failure as soon as possible. The component needs to have minimal initialization time to avoid extended downtime or overloading the replicas if it is a highly available configuration. The cause of failure can be because of issues with the infrastructure on top of which it is running, application failures, or because of service failures that it depends on.</li>
</ul>
</li>
<li>
<p>High Availability deployment strategy.</p>
<ul>
<li>There should be multiple replicas ( both Kubernetes and application control planes ) running preferably in different availability zones to survive outages while still serving the user/system requests. Avoid single points of failure.</li>
</ul>
</li>
<li>
<p>Backed by persistent storage</p>
<ul>
<li>It is important to have the system/application backed by persistent storage. This is especially important in cases where the application is a database or a stateful application given that a node, pod, or container failure will wipe off the data.</li>
</ul>
</li>
<li>
<p>There should be fallback routes to the backend in case of using CDN, for example, Akamai in case of console.redhat.com - a managed service deployed on top of Kubernetes dedicated:</p>
<ul>
<li>Content delivery networks (CDNs) are commonly used to host resources such as images, JavaScript files, and CSS. The average web page is nearly 2 MB in size, and offloading heavy resources to third-parties is extremely effective for reducing backend server traffic and latency. However, this makes each CDN an additional point of failure for every site that relies on it. If the CDN fails, its customers could also fail.</li>
<li>To test how the application reacts to failures, drop all network traffic between the system and CDN. The application should still serve the content to the user irrespective of the failure.</li>
</ul>
</li>
<li>
<p>Appropriate caching and Content Delivery Network should be enabled to be performant and usable when there is a latency on the client side.</p>
<ul>
<li>Not every user or machine has access to unlimited bandwidth, there might be a delay on the user side ( client ) to access the APIâ€™s due to limited bandwidth, throttling or latency depending on the geographic location. It is important to inject latency between the client and API calls to understand the behavior and optimize things including caching wherever possible, using CDNâ€™s or opting for different protocols like HTTP/2 or HTTP/3 vs HTTP.</li>
</ul>
</li>
</ul>
<h3 id="tooling">Tooling<a class="td-heading-self-link" href="#tooling" aria-label="Heading self-link"></a></h3>
<p>Now that we looked at the best practices, In this section, we will go through how <a href="https://github.com/redhat-chaos/krkn">Kraken</a> - a chaos testing framework can help test the resilience of Kubernetes and make sure the applications and services are following the best practices.</p>
<h4 id="cluster-recovery-checks-metrics-evaluation-and-passfail-criteria">Cluster recovery checks, metrics evaluation and pass/fail criteria<a class="td-heading-self-link" href="#cluster-recovery-checks-metrics-evaluation-and-passfail-criteria" aria-label="Heading self-link"></a></h4>
<ul>
<li>
<p>Most of the scenarios have built in checks to verify if the targeted component recovered from the failure after the specified duration of time but there might be cases where other components might have an impact because of a certain failure and itâ€™s extremely important to make sure that the system/application is healthy as a whole post chaos. This is exactly where <a href="(/docs/cerberus)">Cerberus</a> comes to the rescue.
If the monitoring tool, cerberus is enabled it will consume the signal and continue running chaos or not based on that signal.</p>
</li>
<li>
<p>Apart from checking the recovery and cluster health status, itâ€™s equally important to evaluate the performance metrics like latency, resource usage spikes, throughput, etcd health like disk fsync, leader elections etc. To help with this, Kraken has a way to evaluate promql expressions from the incluster prometheus and set the exit status to 0 or 1 based on the severity set for each of the query. Details on how to use this feature can be found <a href="https://github.com/redhat-chaos/krkn#alerts">here</a>.</p>
</li>
<li>
<p>The overall pass or fail of kraken is based on the recovery of the specific component (within a certain amount of time), the cerberus health signal which tracks the health of the entire cluster and metrics evaluation from incluster prometheus.</p>
</li>
</ul>
<h3 id="scenarios">Scenarios<a class="td-heading-self-link" href="#scenarios" aria-label="Heading self-link"></a></h3>
<p>Let us take a look at how to run the chaos scenarios on your Kubernetes clusters using Kraken-hub - a lightweight wrapper around Kraken to ease the runs by providing the ability to run them by just running container images using podman with parameters set as environment variables. This eliminates the need to carry around and edit configuration files and makes it easy for any CI framework integration. Here are the scenarios supported:</p>
<ul>
<li>
<p>Pod Scenarios (<a href="/docs/scenarios/pod-scenario/">Documentation</a>)</p>
<ul>
<li>Disrupts Kubernetes/Kubernetes and applications deployed as pods:
<ul>
<li>Helps understand the availability of the application, the initialization timing and recovery status.</li>
</ul>
</li>
<li><a href="https://asciinema.org/a/452351?speed=3&theme=solarized-dark">Demo</a></li>
</ul>
</li>
<li>
<p>Container Scenarios (<a href="/docs/scenarios/container-scenario/">Documentation</a>)</p>
<ul>
<li>Disrupts Kubernetes/Kubernetes and applications deployed as containers running as part of a pod(s) using a specified kill signal to mimic failures:
<ul>
<li>Helps understand the impact and recovery timing when the program/process running in the containers are disrupted - hangs, paused, killed etc., using various kill signals, i.e. SIGHUP, SIGTERM, SIGKILL etc.</li>
</ul>
</li>
<li><a href="https://asciinema.org/a/BXqs9JSGDSEKcydTIJ5LpPZBM?speed=3&theme=solarized-dark">Demo</a></li>
</ul>
</li>
<li>
<p>Node Scenarios (<a href="/docs/scenarios/node-scenarios/">Documentation</a>)</p>
<ul>
<li>Disrupts nodes as part of the cluster infrastructure by talking to the cloud API. AWS, Azure, GCP, OpenStack and Baremetal are the supported platforms as of now. Possible disruptions include:
<ul>
<li>Terminate nodes</li>
<li>Fork bomb inside the node</li>
<li>Stop the node</li>
<li>Crash the kubelet running on the node</li>
<li>etc.</li>
</ul>
</li>
<li><a href="https://asciinema.org/a/ANZY7HhPdWTNaWt4xMFanF6Q5">Demo</a></li>
</ul>
</li>
<li>
<p>Zone Outages (<a href="/docs/scenarios/zone-outage-scenarios/">Documentation</a>)</p>
<ul>
<li>Creates outage of availability zone(s) in a targeted region in the public cloud where the Kubernetes cluster is running by tweaking the network acl of the zone to simulate the failure, and that in turn will stop both ingress and egress traffic from all nodes in a particular zone for the specified duration and reverts it back to the previous state.
<ul>
<li>Helps understand the impact on both Kubernetes/Kubernetes control plane as well as applications and services running on the worker nodes in that zone.</li>
<li>Currently, only set up for AWS cloud platform: 1 VPC and multiples subnets within the VPC can be specified.</li>
<li><a href="https://asciinema.org/a/452672?speed=3&theme=solarized-dark">Demo</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Application Outages (<a href="/docs/scenarios/application-outage/">Documentation</a>)</p>
<ul>
<li>Scenario to block the traffic ( Ingress/Egress ) of an application matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during the downtime.
<ul>
<li>Helps understand how the dependent services react to the unavailability.</li>
<li><a href="https://asciinema.org/a/452403?speed=3&theme=solarized-dark">Demo</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Power Outages (<a href="/docs/scenarios/power-outage-scenarios/">Documentation</a>)</p>
<ul>
<li>This scenario imitates a power outage by shutting down of the entire cluster for a specified duration of time, then restarts all the nodes after the specified time and checks the health of the cluster.
<ul>
<li>There are various use cases in the customer environments. For example, when some of the clusters are shutdown in cases where the applications are not needed to run in a particular time/season in order to save costs.</li>
<li>The nodes are stopped in parallel to mimic a power outage i.e., pulling off the plug</li>
</ul>
</li>
<li><a href="https://asciinema.org/a/r0zLbh70XK7gnc4s5v0ZzSXGo">Demo</a></li>
</ul>
</li>
<li>
<p>Resource Hog (<a href="/docs/scenarios/arcaflow-scenarios/">Documenattion</a>)</p>
<ul>
<li>Hogs CPU, Memory and IO on the targeted nodes
<ul>
<li>Helps understand if the application/system components have reserved resources to not get disrupted because of rogue applications, or get performance throttled.
<ul>
<li>CPU Hog (<a href="/docs/scenarios/arcaflow-scenarios/">Documentation</a>, <a href="https://asciinema.org/a/452762">Demo</a>)</li>
<li>Memory Hog (<a href="/docs/scenarios/arcaflow-scenarios/">Documentation</a>, <a href="https://asciinema.org/a/452742?speed=3&theme=solarized-dark">Demo</a>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Time Skewing (<a href="/docs/scenarios/time-scenarios/">Documentation</a>)</p>
<ul>
<li>Manipulate the system time and/or date of specific pods/nodes.
<ul>
<li>Verify scheduling of objects so they continue to work.</li>
<li>Verify time gets reset properly.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Namespace Failures (<a href="https://github.com/redhat-chaos/krkn-hub/blob/main/docs/namespace-scenarios.md">Documentation</a>)</p>
<ul>
<li>Delete namespaces for the specified duration.
<ul>
<li>Helps understand the impact on other components and tests/improves recovery time of the components in the targeted namespace.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Persistent Volume Fill (<a href="/docs/scenarios/pvc-scenario/">Documentation</a>)</p>
<ul>
<li>Fills up the persistent volumes, up to a given percentage, used by the pod for the specified duration.
<ul>
<li>Helps understand how an application deals when it is no longer able to write data to the disk. For example, kafkaâ€™s behavior when it is not able to commit data to the disk.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Network Chaos (<a href="/docs/scenarios/network-chaos-scenario/">Documentation</a>)</p>
<ul>
<li>Scenarios supported includes:
<ul>
<li>Network latency</li>
<li>Packet loss</li>
<li>Interface flapping</li>
<li>DNS errors</li>
<li>Packet corruption</li>
<li>Bandwidth limitation</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Pod Network Scenario (<a href="/docs/scenarios/pod-network-scenario/">Documentation</a>)</p>
<ul>
<li>Scenario to block the traffic ( Ingress/Egress ) of a pod matching the labels for the specified duration of time to understand the behavior of the service/other services which depend on it during downtime. This helps with planning the requirements accordingly, be it improving the timeouts or tweaking the alerts etc.</li>
<li>With the current network policies, it is not possible to explicitly block ports which are enabled by allowed network policy rule. This chaos scenario addresses this issue by using OVS flow rules to block ports related to the pod. It supports OpenShiftSDN and OVNKubernetes based networks.</li>
</ul>
</li>
<li>
<p>Service Disruption Scenarios (<a href="/docs/scenarios/service-disruption-scenarios/">Documentation</a>)</p>
<ul>
<li>Using this type of scenario configuration one is able to delete crucial objects in a specific namespace, or a namespace matching a certain regex string.</li>
</ul>
</li>
<li>
<p>Service Hijacking Scenarios (<a href="/docs/scenarios/service-hijacking-scenario/">Documentation</a>)</p>
<ul>
<li>Service Hijacking Scenarios aim to simulate fake HTTP responses from a workload targeted by a Service already deployed in the cluster. This scenario is executed by deploying a custom-made web service and modifying the target Service selector to direct traffic to this web service for a specified duration.</li>
</ul>
</li>
</ul>
<h3 id="test-environment-recommendations---how-and-where-to-run-chaos-tests">Test Environment Recommendations - how and where to run chaos tests<a class="td-heading-self-link" href="#test-environment-recommendations---how-and-where-to-run-chaos-tests" aria-label="Heading self-link"></a></h3>
<p>Let us take a look at few recommendations on how and where to run the chaos tests:</p>
<ul>
<li>
<p>Run the chaos tests continuously in your test pipelines:</p>
<ul>
<li>Software, systems, and infrastructure does change â€“ and the condition/health of each can change pretty rapidly. A good place to run tests is in your CI/CD pipeline running on a regular cadence.</li>
</ul>
</li>
<li>
<p>Run the chaos tests manually to learn from the system:</p>
<ul>
<li>When running a Chaos scenario or Fault tests, it is more important to understand how the system responds and reacts, rather than mark the execution as pass or fail.</li>
<li>It is important to define the scope of the test before the execution to avoid some issues from masking others.</li>
</ul>
</li>
<li>
<p>Run the chaos tests in production environments or mimic the load in staging environments:</p>
<ul>
<li>As scary as a thought about testing in production is, production is the environment that users are in and traffic spikes/load are real. To fully test the robustness/resilience of a production system, running Chaos Engineering experiments in a production environment will provide needed insights. A couple of things to keep in mind:
<ul>
<li>Minimize blast radius and have a backup plan in place to make sure the users and customers do not undergo downtime.</li>
<li>Mimic the load in a staging environment in case Service Level Agreements  are too tight to cover any downtime.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Enable Observability:</p>
<ul>
<li>Chaos Engineering Without Observability &hellip; Is Just Chaos.</li>
<li>Make sure to have logging and monitoring installed on the cluster to help with understanding the behaviour as to why it is happening. In case of running the tests in the CI where it is not humanly possible to monitor the cluster all the time, it is recommended to leverage Cerberus to capture the state during the runs and metrics collection in Kraken to store metrics long term even after the cluster is gone.</li>
<li>Kraken ships with dashboards that will help understand API, Etcd and Kubernetes cluster level stats and performance metrics.</li>
<li>Pay attention to Prometheus alerts. Check if they are firing as expected.</li>
</ul>
</li>
<li>
<p>Run multiple chaos tests at once to mimic the production outages:</p>
<ul>
<li>For example, hogging both IO and Network at the same time instead of running them separately to observe the impact.</li>
<li>You might have existing test cases, be it related to Performance, Scalability or QE. Run the chaos in the background during the test runs to observe the impact. Signaling feature in Kraken can help with coordinating the chaos runs i.e., start, stop, pause the scenarios based on the state of the other test jobs.</li>
</ul>
</li>
</ul>
<h4 id="chaos-testing-in-practice">Chaos testing in Practice<a class="td-heading-self-link" href="#chaos-testing-in-practice" aria-label="Heading self-link"></a></h4>
<h5 id="openshift-organization">OpenShift organization<a class="td-heading-self-link" href="#openshift-organization" aria-label="Heading self-link"></a></h5>
<p>Within the OpenShift organization we use kraken to perform chaos testing throughout a release before the code is available to customers.</p>
<pre><code>1. We execute kraken during our regression test suite.

    i. We cover each of the chaos scenarios across different clouds.

        a. Our testing is predominantly done on AWS, Azure and GCP.

2. We run the chaos scenarios during a long running reliability test.

    i. During this test we perform different types of tasks by different users on the cluster.

    ii. We have added the execution of kraken to perform at certain times throughout the long running test and monitor the health of the cluster.

    iii. This test can be seen here: https://github.com/openshift/svt/tree/master/reliability-v2

3. We are starting to add in test cases that perform chaos testing during an upgrade (not many iterations of this have been completed).
</code></pre>
<h5 id="startx-lab">startx-lab<a class="td-heading-self-link" href="#startx-lab" aria-label="Heading self-link"></a></h5>
<p><strong>NOTE</strong>: Requests for enhancements and any issues need to be filed at the mentioned links given that they are not natively supported in Kraken.</p>
<p>The following content covers the implementation details around how Startx is leveraging Kraken:</p>
<ul>
<li>Using kraken as part of a tekton pipeline</li>
</ul>
<p>You can find on <a href="https://artifacthub.io/packages/search?kind=7&ts_query_web=kraken">artifacthub.io</a> the
<a href="https://artifacthub.io/packages/tekton-task/startx-tekton-catalog/kraken-scenario">kraken-scenario</a> <code>tekton-task</code>
which can be used to start a kraken chaos scenarios as part of a chaos pipeline.</p>
<p>To use this task, you must have :</p>
<ul>
<li>Openshift pipeline enabled (or tekton CRD loaded for Kubernetes clusters)</li>
<li>1 Secret named <code>kraken-aws-creds</code> for scenarios using aws</li>
<li>1 ConfigMap named <code>kraken-kubeconfig</code> with credentials to the targeted cluster</li>
<li>1 ConfigMap named <code>kraken-config-example</code> with kraken configuration file (config.yaml)</li>
<li>1 ConfigMap named <code>kraken-common-example</code> with all kraken related files</li>
<li>The <code>pipeline</code> SA with be autorized to run with priviveged SCC</li>
</ul>
<p>You can create theses resources using the following sequence :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc project default
</span></span><span style="display:flex;"><span>oc adm policy add-scc-to-user privileged -z pipeline
</span></span><span style="display:flex;"><span>oc apply -f https://github.com/startxfr/tekton-catalog/raw/stable/task/kraken-scenario/0.1/samples/common.yaml
</span></span></code></pre></div><p>Then you must change content of <code>kraken-aws-creds</code> secret, <code>kraken-kubeconfig</code> and <code>kraken-config-example</code> configMap
to reflect your cluster configuration. Refer to the <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml">kraken configuration</a>
and <a href="https://github.com/startxfr/tekton-catalog/blob/stable/task/kraken-scenario/0.1/samples/">configuration examples</a>
for details on how to configure theses resources.</p>
<ul>
<li>Start as a single taskrun</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>oc apply -f https://github.com/startxfr/tekton-catalog/raw/stable/task/kraken-scenario/0.1/samples/taskrun.yaml
</span></span></code></pre></div><ul>
<li>Start as a pipelinerun</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000">oc apply -f https://github.com/startxfr/tekton-catalog/raw/stable/task/kraken-scenario/0.1/samples/pipelinerun.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ul>
<li>Deploying kraken using a helm-chart</li>
</ul>
<p>You can find on <a href="https://artifacthub.io/packages/search?kind=0&ts_query_web=kraken">artifacthub.io</a> the
<a href="https://artifacthub.io/packages/helm/startx/chaos-kraken">chaos-kraken</a> <code>helm-chart</code>
which can be used to deploy a kraken chaos scenarios.</p>
<p>Default configuration create the following resources :</p>
<ul>
<li>1 project named <strong>chaos-kraken</strong></li>
<li>1 scc with privileged context for kraken deployment</li>
<li>1 configmap with kraken 21 generic scenarios, various scripts and configuration</li>
<li>1 configmap with kubeconfig of the targeted cluster</li>
<li>1 job named kraken-test-xxx</li>
<li>1 service to the kraken pods</li>
<li>1 route to the kraken service</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install the startx helm repository</span>
</span></span><span style="display:flex;"><span>helm repo add startx https://startxfr.github.io/helm-repository/packages/
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install the kraken project</span>
</span></span><span style="display:flex;"><span>helm install --set project.enabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> chaos-kraken-project  startx/chaos-kraken
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Deploy the kraken instance</span>
</span></span><span style="display:flex;"><span>helm install <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.enabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.aws.credentials.region<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;eu-west-3&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.aws.credentials.key_id<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;AKIAXXXXXXXXXXXXXXXX&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.aws.credentials.secret<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.kubeconfig.token.server<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://api.mycluster:6443&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--set kraken.kubeconfig.token.token<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;sha256~XXXXXXXXXX_PUT_YOUR_TOKEN_HERE_XXXXXXXXXXXX&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>-n chaos-kraken <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>chaos-kraken-instance startx/chaos-kraken
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-70fda4d115500a0f25e876b6cccb9693">5 - Cerberus</h1>
    
	<h1 id="cerberus">Cerberus<a class="td-heading-self-link" href="#cerberus" aria-label="Heading self-link"></a></h1>
<p>Guardian of Kubernetes and OpenShift Clusters</p>
<p>Cerberus watches the Kubernetes/OpenShift clusters for dead nodes, system component failures/health and exposes a go or no-go signal which can be consumed by other workload generators or applications in the cluster and act accordingly.</p>
<h3 id="workflow">Workflow<a class="td-heading-self-link" href="#workflow" aria-label="Heading self-link"></a></h3>
<p><img alt="Cerberus workflow" src="/images/cerberus-workflow.png"></p>
<h3 id="installation">Installation<a class="td-heading-self-link" href="#installation" aria-label="Heading self-link"></a></h3>
<p>Instructions on how to setup, configure and run Cerberus can be found at <a href="/docs/cerberus/installation/">Installation</a>.</p>
<h3 id="what-kubernetesopenshift-components-can-cerberus-monitor">What Kubernetes/OpenShift components can Cerberus monitor?<a class="td-heading-self-link" href="#what-kubernetesopenshift-components-can-cerberus-monitor" aria-label="Heading self-link"></a></h3>
<p>Following are the components of Kubernetes/OpenShift that Cerberus can monitor today, we will be adding more soon.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Working</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nodes</td>
<td>Watches all the nodes including masters, workers as well as nodes created using custom MachineSets</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Namespaces</td>
<td>Watches all the pods including containers running inside the pods in the namespaces specified in the config</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Cluster Operators</td>
<td>Watches all Cluster Operators</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Masters Schedulability</td>
<td>Watches and warns if masters nodes are marked as schedulable</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Routes</td>
<td>Watches specified routes</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>CSRs</td>
<td>Warns if any CSRs are not approved</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Critical Alerts</td>
<td>Warns the user on observing abnormal behavior which might effect the health of the cluster</td>
<td>:heavy_check_mark:</td>
</tr>
<tr>
<td>Bring your own checks</td>
<td>Users can bring their own checks and Ceberus runs and includes them in the reporting as wells as go/no-go signal</td>
<td>:heavy_check_mark:</td>
</tr>
</tbody>
</table>
<p>An explanation of all the components that Cerberus can monitor are explained <a href="/docs/cerberus/config/">here</a></p>
<h3 id="how-does-cerberus-report-cluster-health">How does Cerberus report cluster health?<a class="td-heading-self-link" href="#how-does-cerberus-report-cluster-health" aria-label="Heading self-link"></a></h3>
<p>Cerberus exposes the cluster health and failures through a go/no-go signal, report and metrics API.</p>
<h4 id="go-or-no-go-signal">Go or no-go signal<a class="td-heading-self-link" href="#go-or-no-go-signal" aria-label="Heading self-link"></a></h4>
<p>When the cerberus is configured to run in the daemon mode, it will continuosly monitor the components specified, runs a light weight http server at http://0.0.0.0:8080 and publishes the signal i.e True or False depending on the components status. The tools can consume the signal and act accordingly.</p>
<h4 id="report">Report<a class="td-heading-self-link" href="#report" aria-label="Heading self-link"></a></h4>
<p>The report is generated in the run directory and it contains the information about each check/monitored component status per iteration with timestamps. It also displays information about the components in case of failure. Refer <a href="docs/example_report.md">report</a> for example.</p>
<p>You can use the &ldquo;-o &lt;file_path_name&gt;&rdquo; option to change the location of the created report</p>
<h4 id="metrics-api">Metrics API<a class="td-heading-self-link" href="#metrics-api" aria-label="Heading self-link"></a></h4>
<p>Cerberus exposes the metrics including the failures observed during the run through an API. Tools consuming Cerberus can query the API to get a blob of json with the observed failures to scrape and act accordingly. For example, we can query for etcd failures within a start and end time and take actions to determine pass/fail for test cases or report whether the cluster is healthy or unhealthy for that duration.</p>
<ul>
<li>The failures in the past 1 hour can be retrieved in the json format by visiting http://0.0.0.0:8080/history.</li>
<li>The failures in a specific time window can be retrieved in the json format by visiting http://0.0.0.0:8080/history?loopback=<interval>.</li>
<li>The failures between two time timestamps, the failures of specific issues types and the failures related to specific components can be retrieved in the json format by visiting http://0.0.0.0:8080/analyze url. The filters have to be applied to scrape the failures accordingly.</li>
</ul>
<h3 id="slack-integration">Slack integration<a class="td-heading-self-link" href="#slack-integration" aria-label="Heading self-link"></a></h3>
<p>Cerberus supports reporting failures in slack. Refer <a href="/docs/cerberus/slack/">slack integration</a> for information on how to set it up.</p>
<h3 id="node-problem-detector">Node Problem Detector<a class="td-heading-self-link" href="#node-problem-detector" aria-label="Heading self-link"></a></h3>
<p>Cerberus also consumes <a href="https://github.com/kubernetes/node-problem-detector">node-problem-detector</a> to detect various failures in Kubernetes/OpenShift nodes. More information on setting it up can be found at <a href="/docs/cerberus/node-problem-detector/">node-problem-detector</a></p>
<h3 id="bring-your-own-checks">Bring your own checks<a class="td-heading-self-link" href="#bring-your-own-checks" aria-label="Heading self-link"></a></h3>
<p>Users can add additional checks to monitor components that are not being monitored by Cerberus and consume it as part of the go/no-go signal.  This can be accomplished by placing relative paths of files containing additional checks under custom_checks in config file. All the checks should be placed within the main function of the file. If the additional checks need to be considered in determining the go/no-go signal of Cerberus, the main function can return a boolean value for the same. Having a dict return value of the format {&lsquo;status&rsquo;:status, &lsquo;message&rsquo;:message} shall send signal to Cerberus along with message to be displayed in slack notification. However, it&rsquo;s optional to return a value.
Refer to <a href="https://github.com/openshift-scale/cerberus/blob/master/custom_checks/custom_check_sample.py">example_check</a> for an example custom check file.</p>
<h3 id="alerts">Alerts<a class="td-heading-self-link" href="#alerts" aria-label="Heading self-link"></a></h3>
<p>Monitoring metrics and alerting on abnormal behavior is critical as they are the indicators for clusters health. Information on supported alerts can be found at <a href="/docs/cerberus/alerts/">alerts</a>.</p>
<h3 id="use-cases">Use cases<a class="td-heading-self-link" href="#use-cases" aria-label="Heading self-link"></a></h3>
<p>There can be number of use cases, here are some of them:</p>
<ul>
<li>
<p>We run tools to push the limits of Kubernetes/OpenShift to look at the performance and scalability. There are a number of instances where system components or nodes start to degrade, which invalidates the results and the workload generator continues to push the cluster until it is unrecoverable.</p>
</li>
<li>
<p>When running chaos experiments on a kubernetes/OpenShift cluster, they can potentially break the components unrelated to the targeted components which means that the chaos experiment won&rsquo;t be able to find it. The go/no-go signal can be used here to decide whether the cluster recovered from the failure injection as well as to decide whether to continue with the next chaos scenario.</p>
</li>
</ul>
<h3 id="tools-consuming-cerberus">Tools consuming Cerberus<a class="td-heading-self-link" href="#tools-consuming-cerberus" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><a href="https://github.com/cloud-bulldozer/benchmark-operator">Benchmark Operator</a>: The intent of this Operator is to deploy common workloads to establish a performance baseline of Kubernetes cluster on your provider. Benchmark Operator consumes Cerberus to determine if the cluster was healthy during the benchmark run. More information can be found at <a href="https://github.com/cloud-bulldozer/benchmark-operator#cerberus-integration">cerberus-integration</a>.</p>
</li>
<li>
<p><a href="https://github.com/openshift-scale/kraken/">Kraken</a>: Tool to inject deliberate failures into Kubernetes/OpenShift clusters to check if it is resilient. Kraken consumes Cerberus to determine if the cluster is healthy as a whole in addition to the targeted component during chaos testing. More information can be found at <a href="https://github.com/openshift-scale/kraken#kraken-scenario-passfail-criteria-and-report">cerberus-integration</a>.</p>
</li>
</ul>
<h3 id="blogs-and-other-useful-resources">Blogs and other useful resources<a class="td-heading-self-link" href="#blogs-and-other-useful-resources" aria-label="Heading self-link"></a></h3>
<ul>
<li><a href="https://www.openshift.com/blog/openshift-scale-ci-part-4-introduction-to-cerberus-guardian-of-kubernetes/openshift-clouds">https://www.openshift.com/blog/openshift-scale-ci-part-4-introduction-to-cerberus-guardian-of-kubernetes/openshift-clouds</a></li>
<li><a href="https://www.openshift.com/blog/reinforcing-cerberus-guardian-of-openshift/kubernetes-clusters">https://www.openshift.com/blog/reinforcing-cerberus-guardian-of-openshift/kubernetes-clusters</a></li>
</ul>
<h3 id="contributions">Contributions<a class="td-heading-self-link" href="#contributions" aria-label="Heading self-link"></a></h3>
<p>We are always looking for more enhancements, fixes to make it better, any contributions are most welcome. Feel free to report or work on the issues filed on github.</p>
<p><a href="/docs/cerberus/contribute/">More information on how to Contribute</a></p>
<h3 id="community">Community<a class="td-heading-self-link" href="#community" aria-label="Heading self-link"></a></h3>
<p>Key Members(slack_usernames): paige, rook, mffiedler, mohit, dry923, rsevilla, ravi</p>
<ul>
<li><a href="https://kubernetes.slack.com"><strong>#sig-scalability on Kubernetes Slack</strong></a></li>
<li><a href="https://coreos.slack.com"><strong>#forum-perfscale on CoreOS Slack</strong></a></li>
</ul>
<h3 id="credits">Credits<a class="td-heading-self-link" href="#credits" aria-label="Heading self-link"></a></h3>
<p>Thanks to Mary Shakshober ( <a href="https://github.com/maryshak1996">https://github.com/maryshak1996</a> ) for designing the logo.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2ff67b136c71c2a08174669fbf2d344d">5.1 - Installation</h1>
    
	<p>Following ways are supported to run Cerberus:</p>
<ul>
<li>Standalone python program through Git or python package</li>
<li>Containerized version using either Podman or Docker as the runtime</li>
<li>Kubernetes or OpenShift deployment</li>
</ul>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Only OpenShift 4.x versions are tested.

</div>

<h2 id="git">Git<a class="td-heading-self-link" href="#git" aria-label="Heading self-link"></a></h2>
<p>Pick the latest stable release to install <a href="https://github.com/redhat-chaos/cerberus/releases/">here</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git clone https://github.com/redhat-chaos/cerberus.git --branch &lt;release&gt;
</span></span></code></pre></div><h3 id="install-the-dependencies">Install the dependencies<a class="td-heading-self-link" href="#install-the-dependencies" aria-label="Heading self-link"></a></h3>
<p><strong>NOTE</strong>: Recommended to use a virtual environment(pyenv,venv) so as to prevent conflicts with already installed packages.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ pip3 install -r requirements.txt
</span></span></code></pre></div><h3 id="configure-and-run">Configure and Run<a class="td-heading-self-link" href="#configure-and-run" aria-label="Heading self-link"></a></h3>
<p>Setup the <a href="https://github.com/redhat-chaos/cerberus/tree/master/config">config</a> according to your requirements. Information on the available options can be found at <a href="/docs/cerberus/usage/">usage</a>.</p>
<h4 id="run">Run<a class="td-heading-self-link" href="#run" aria-label="Heading self-link"></a></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python3 start_cerberus.py --config &lt;config_file_location&gt;
</span></span></code></pre></div><p><strong>NOTE</strong>: When config file location is not passed, default <a href="https://github.com/redhat-chaos/cerberus/tree/master/config">config</a> is used.</p>
<h2 id="python-package">Python Package<a class="td-heading-self-link" href="#python-package" aria-label="Heading self-link"></a></h2>
<p>Cerberus is also available as a python package to ease the installation and setup.</p>
<p>To install the lastest release:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ pip3 install cerberus-client
</span></span></code></pre></div><h3 id="configure-and-run-1">Configure and Run<a class="td-heading-self-link" href="#configure-and-run-1" aria-label="Heading self-link"></a></h3>
<p>Setup the <a href="https://github.com/redhat-chaos/cerberus/tree/master/config">config</a> according to your requirements. Information on the available options can be found at <a href="/docs/cerberus/usage/">usage</a>.</p>
<h4 id="run-1">Run<a class="td-heading-self-link" href="#run-1" aria-label="Heading self-link"></a></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cerberus_client -c &lt;config_file_location&gt;<span style="color:#4e9a06">`</span>
</span></span></code></pre></div><p>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    When config_file_location is not passed, default <a href="https://github.com/redhat-chaos/cerberus/tree/master/config">config</a> is used.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Itâ€™s recommended to run Cerberus either using the containerized  or github version to be able to use the latest enhancements and fixes.

</div>
</p>
<h2 id="containerized-version">Containerized version<a class="td-heading-self-link" href="#containerized-version" aria-label="Heading self-link"></a></h2>
<p>Assuming docker ( 17.05 or greater with multi-build support ) is intalled on the host, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker pull quay.io/redhat-chaos/cerberus
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Setup the [config](https://github.com/redhat-chaos/cerberus/tree/master/config) according to your requirements. Information on the available options can be found at [usage](usage.md).</span>
</span></span><span style="display:flex;"><span>$ docker run --name<span style="color:#ce5c00;font-weight:bold">=</span>cerberus --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path_to_kubeconfig&gt;:/root/.kube/config -v &lt;path_to_cerberus_config&gt;:/root/cerberus/config/config.yaml -d quay.io/redhat-chaos/cerberus:latest
</span></span><span style="display:flex;"><span>$ docker logs -f cerberus
</span></span></code></pre></div><p>Similarly, podman can be used to achieve the same:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ podman pull quay.io/redhat-chaos/cerberus
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Setup the [config](https://github.com/redhat-chaos/cerberus/tree/master/config) according to your requirements. Information on the available options can be found at [usage](usage.md).</span>
</span></span><span style="display:flex;"><span>$ podman run --name<span style="color:#ce5c00;font-weight:bold">=</span>cerberus --net<span style="color:#ce5c00;font-weight:bold">=</span>host -v &lt;path_to_kubeconfig&gt;:/root/.kube/config:Z -v &lt;path_to_cerberus_config&gt;:/root/cerberus/config/config.yaml:Z -d quay.io/redhat-chaos/cerberus:latest
</span></span><span style="display:flex;"><span>$ podman logs -f cerberus
</span></span></code></pre></div><p>The go/no-go signal ( True or False ) gets published at http://<code>&lt;hostname&gt;</code>:8080. Note that the cerberus will only support ipv4 for the time being.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The report is generated at /root/cerberus/cerberus.report inside the container, it can mounted to a directory on the host in case we want to capture it.

</div>

<p>If you want to build your own Cerberus image, see <a href="https://github.com/redhat-chaos/cerberus/tree/master/containers/build_own_image-README.md">here</a>.
To run Cerberus on Power (ppc64le) architecture, build and run a containerized version by following the instructions given <a href="https://github.com/cloud-bulldozer/cerberus/tree/master/containers/build_own_image-README.md">here</a>.</p>
<h2 id="run-containerized-cerberus-as-a-kubernetesopenshift-deployment">Run containerized Cerberus as a Kubernetes/OpenShift deployment<a class="td-heading-self-link" href="#run-containerized-cerberus-as-a-kubernetesopenshift-deployment" aria-label="Heading self-link"></a></h2>
<p>Refer to the <a href="https://github.com/redhat-chaos/cerberus/blob/master/containers/README.md#cerberus-as-a-kubernetesopenshift-application">instructions</a> for information on how to run cerberus as a Kubernetes or OpenShift application.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-72c880d1d638941a4e30e0c6916c8f47">5.2 - Config</h1>
    
	<p>Cerberus Config Components Explained</p>
<ul>
<li><a href="/docs/cerberus/config/#config">Sample Config</a></li>
<li><a href="/docs/cerberus/config/#watch-nodes">Watch Nodes</a></li>
<li><a href="/docs/cerberus/config/#watch-cluster-operators">Watch Operators</a></li>
<li><a href="/docs/cerberus/config/#watch-routes">Watch Routes</a></li>
<li><a href="/docs/cerberus/config/#watch-master-schedulable-status">Watch Master Schedulable Status</a></li>
<li><a href="/docs/cerberus/config/#watch-namespaces">Watch Namespaces</a></li>
<li><a href="/docs/cerberus/config/#watch-terminating-namespaces">Watch Terminating Namespaces</a></li>
<li><a href="/docs/cerberus/config/#publish-status">Publish Status</a></li>
<li><a href="/docs/cerberus/config/#inspect-components">Inpsect Components</a></li>
<li><a href="/docs/cerberus/config/#custom-checks">Custom Checks</a></li>
</ul>
<h3 id="config">Config<a class="td-heading-self-link" href="#config" aria-label="Heading self-link"></a></h3>
<p>Set the components to monitor and the tunings like duration to wait between each check in the config file located at config/config.yaml. A sample config looks like:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">cerberus</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">distribution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift                             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Distribution can be kubernetes or openshift</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubeconfig_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/root/.kube/config                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path to kubeconfig</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8081</span><span style="color:#f8f8f8;text-decoration:underline">                                           </span><span style="color:#8f5902;font-style:italic"># http server port where cerberus status is published</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_nodes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Set to True for the cerberus to monitor the cluster nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_cluster_operators</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#8f5902;font-style:italic"># Set to True for cerberus to monitor cluster operators</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_terminating_namespaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                   </span><span style="color:#8f5902;font-style:italic"># Set to True to monitor if any namespaces (set below under &#39;watch_namespaces&#39; start terminating</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_url_routes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Route url&#39;s you want to monitor, this is a double array with the url and optional authorization parameter</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_master_schedulable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># When enabled checks for the schedulable master nodes with given label.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">label</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_namespaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># List of namespaces to be monitored</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-etcd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-monitoring</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-machine-api</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-ingress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-sdn                                  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># When enabled, it will check for the cluster sdn and monitor that namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_namespaces_ignore_pattern</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#8f5902;font-style:italic"># Ignores pods matching the regex pattern in the namespaces specified under watch_namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cerberus_publish_status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus starts a light weight http server and publishes the status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">inspect_components</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Enable it only when OpenShift client is supported to run</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus collects logs, events and metrics of failed components</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">prometheus_url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># The prometheus url/route is automatically obtained in case of OpenShift, please set it when the distribution is Kubernetes.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">prometheus_bearer_token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                             </span><span style="color:#8f5902;font-style:italic"># The bearer token is automatically obtained in case of OpenShift, please set it when the distribution is Kubernetes. This is needed to authenticate with prometheus.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># This enables Cerberus to query prometheus and alert on observing high Kube API Server latencies.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">slack_integration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                             </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus reports the failed iterations in the slack channel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># The following env vars needs to be set: SLACK_API_TOKEN ( Bot User OAuth Access Token ) and SLACK_CHANNEL ( channel to send notifications in case of failures )</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># When slack_integration is enabled, a watcher can be assigned for each day. The watcher of the day is tagged while reporting failures in the slack channel. Values are slack member ID&#39;s.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watcher_slack_ID:                                        # (NOTE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Defining the watcher id&#39;s is optional and when the watcher slack id&#39;s are not defined, the slack_team_alias tag is used if it is set else no tag is used while reporting failures in the slack channel.)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Monday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Tuesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Wednesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Thursday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Friday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Saturday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Sunday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">slack_team_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># The slack team alias to be tagged while reporting failures in the slack channel when no watcher is assigned</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">custom_checks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">custom_checks/custom_check_sample.py      </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Relative paths of files conataining additional user defined checks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">tunings</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">timeout</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">                                          </span><span style="color:#8f5902;font-style:italic"># Number of seconds before requests fail</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">iterations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">                                        </span><span style="color:#8f5902;font-style:italic"># Iterations to loop before stopping the watch, it will be replaced with infinity when the daemon mode is enabled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">sleep_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">                                       </span><span style="color:#8f5902;font-style:italic"># Sleep duration between each iteration</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kube_api_request_chunk_size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">250</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Large requests will be broken into the specified chunk size to reduce the load on API server and improve responsiveness.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">daemon_mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Iterations are set to infinity which means that the cerberus will monitor the resources forever</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cores_usage_percentage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># Set the fraction of cores to be used for multiprocessing</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">database_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/tmp/cerberus.db                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path where cerberus database needs to be stored</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reuse_database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#8f5902;font-style:italic"># When enabled, the database is reused to store the failures</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="watch-nodes">Watch Nodes<a class="td-heading-self-link" href="#watch-nodes" aria-label="Heading self-link"></a></h4>
<p>This flag returns any nodes where the KernelDeadlock is not set to False and does not have a <code>Ready</code> status</p>
<h4 id="watch-cluster-operators">Watch Cluster Operators<a class="td-heading-self-link" href="#watch-cluster-operators" aria-label="Heading self-link"></a></h4>
<p>When <code>watch_cluster_operators</code> is set to True, this will monitor the degraded status of all the cluster operators and report a failure if any are degraded.
If set to False will not query or report the status of the cluster operators</p>
<h4 id="watch-routes">Watch Routes<a class="td-heading-self-link" href="#watch-routes" aria-label="Heading self-link"></a></h4>
<p>This parameter expects a double array with each item having the url and an optional bearer token or authorization for each of the url&rsquo;s to properly connect</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">watch_url_routes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- - <span style="color:#000">&lt;url&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">&lt;authorization&gt; (optional)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- - <span style="color:#000">https://prometheus-k8s-openshift-monitoring.apps.****.devcluster.openshift.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">Bearer ****</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- - <span style="color:#000">http://nodejs-mongodb-example-default.apps.****.devcluster.openshift.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h4 id="watch-master-schedulable-status">Watch Master Schedulable Status<a class="td-heading-self-link" href="#watch-master-schedulable-status" aria-label="Heading self-link"></a></h4>
<p>When this check is enabled, cerberus queries each of the nodes for the given label and verifies the taint effect does not equal &ldquo;NoSchedule&rdquo;</p>
<pre tabindex="0"><code>watch_master_schedulable:                            # When enabled checks for the schedulable master nodes with given label.
    enabled: True
    label: &lt;label of master nodes&gt;
</code></pre><h4 id="watch-namespaces">Watch Namespaces<a class="td-heading-self-link" href="#watch-namespaces" aria-label="Heading self-link"></a></h4>
<p>It supports monitoring pods in any namespaces specified in the config, the watch is enabled for system components mentioned in the <a href="https://github.com/openshift-scale/cerberus/blob/master/config/config.yaml">config</a> by default as they are critical for running the operations on Kubernetes/OpenShift clusters.</p>
<p><code>watch_namespaces</code> support regex patterns. Any valid regex pattern can be used to watch all the namespaces matching the regex pattern.
For example, <code>^openshift-.*$</code> can be used to watch all namespaces that start with <code>openshift-</code> or <code>openshift</code> can be used to watch all namespaces that have <code>openshift</code> in it.
Or you can use <code>^.*$</code> to watch all namespaces in your cluster</p>
<h4 id="watch-terminating-namespaces">Watch Terminating Namespaces<a class="td-heading-self-link" href="#watch-terminating-namespaces" aria-label="Heading self-link"></a></h4>
<p>When <code>watch_terminating_namespaces</code> is set to True, this will monitor the status of all the namespaces defind under watch namespaces and report a failure if any are terminating.
If set to False will not query or report the status of the terminating namespaces</p>
<h4 id="publish-status">Publish Status<a class="td-heading-self-link" href="#publish-status" aria-label="Heading self-link"></a></h4>
<p>Parameter to set if you want to publish the go/no-go signal to the http server</p>
<h4 id="inspect-components">Inspect Components<a class="td-heading-self-link" href="#inspect-components" aria-label="Heading self-link"></a></h4>
<p><code>inspect_components</code> if set to True will perform an <code>oc adm inspect namespace &lt;namespace&gt;</code> when any namespace has any failing pods</p>
<h4 id="custom-checks">Custom Checks<a class="td-heading-self-link" href="#custom-checks" aria-label="Heading self-link"></a></h4>
<p>Users can add additional checks to monitor components that are not being monitored by Cerberus and consume it as part of the go/no-go signal.  This can be accomplished by placing relative paths of files containing additional checks under custom_checks in config file. All the checks should be placed within the main function of the file. If the additional checks need to be considered in determining the go/no-go signal of Cerberus, the main function can return a boolean value for the same. Having a dict return value of the format {&lsquo;status&rsquo;:status, &lsquo;message&rsquo;:message} shall send signal to Cerberus along with message to be displayed in slack notification. However, it&rsquo;s optional to return a value.</p>
<p>Refer to <a href="https://github.com/openshift-scale/cerberus/blob/master/custom_checks/custom_check_sample.py">example_check</a> for an example custom check file.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-35bbedcac6771a21142e8ca78bc8e0ff">5.3 - Example Report</h1>
    
	<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>2020-03-26 22:05:06,393 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Starting ceberus
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,401 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Initializing client to talk to the Kubernetes cluster
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,434 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Fetching cluster info
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,739 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Publishing cerberus status at http://0.0.0.0:8080
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,753 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Starting http server at http://0.0.0.0:8080
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,753 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Daemon mode enabled, cerberus will monitor forever
</span></span><span style="display:flex;"><span>2020-03-26 22:05:06,753 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Ignoring the iterations <span style="color:#204a87">set</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,104 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Node status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,133 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Etcd member pods status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,161 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: OpenShift apiserver status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,546 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Kube ApiServer status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,717 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Monitoring stack status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,720 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Kube controller status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,746 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Machine API components status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,945 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: Kube scheduler status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:25,963 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: OpenShift ingress status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:26,077 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 4: OpenShift SDN status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:26,077 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> HTTP requests served: <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>2020-03-26 22:05:26,077 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Sleeping <span style="color:#204a87;font-weight:bold">for</span> the specified duration: <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,134 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Node status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,162 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Etcd member pods status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,190 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: OpenShift apiserver status: True
</span></span><span style="display:flex;"><span>127.0.0.1 - - <span style="color:#ce5c00;font-weight:bold">[</span>26/Mar/2020 22:05:31<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#0000cf;font-weight:bold">200</span> -
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,588 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Kube ApiServer status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,759 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Monitoring stack status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,763 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Kube controller status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,788 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Machine API components status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:31,989 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: Kube scheduler status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:32,007 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: OpenShift ingress status: True
</span></span><span style="display:flex;"><span>2020-03-26 22:05:32,118 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Iteration 5: OpenShift SDN status: False
</span></span><span style="display:flex;"><span>2020-03-26 22:05:32,118 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> HTTP requests served: <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>2020-03-26 22:05:32,118 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Sleeping <span style="color:#204a87;font-weight:bold">for</span> the specified duration: <span style="color:#0000cf;font-weight:bold">5</span>
</span></span><span style="display:flex;"><span>+--------------------------------------------------Failed Components--------------------------------------------------+
</span></span><span style="display:flex;"><span>2020-03-26 22:05:37,123 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Failed openshfit sdn components: <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#39;sdn-xmqhd&#39;</span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> ------------------------- Iteration Stats ---------------------------------------------
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Time taken to run watch_nodes in iteration 1: 0.0996248722076416 seconds
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Time taken to run watch_cluster_operators in iteration 1: 0.3672499656677246 seconds
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Time taken to run watch_namespaces in iteration 1: 1.085144281387329 seconds
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> Time taken to run entire_iteration in iteration 1: 4.107403039932251 seconds
</span></span><span style="display:flex;"><span>2020-05-23 23:26:43,041 <span style="color:#ce5c00;font-weight:bold">[</span>INFO<span style="color:#ce5c00;font-weight:bold">]</span> ---------------------------------------------------------------------------------------
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4c228cfc2415b191b59fb8446f977274">5.4 - Usage</h1>
    
	<h3 id="config">Config<a class="td-heading-self-link" href="#config" aria-label="Heading self-link"></a></h3>
<p>Set the supported components to monitor and the tunings like number of iterations to monitor and duration to wait between each check in the config file located at config/config.yaml. A sample config looks like:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">cerberus</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">distribution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">openshift                             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Distribution can be kubernetes or openshift</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kubeconfig_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">~/.kube/config                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path to kubeconfig</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8080</span><span style="color:#f8f8f8;text-decoration:underline">                                           </span><span style="color:#8f5902;font-style:italic"># http server port where cerberus status is published</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_nodes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Set to True for the cerberus to monitor the cluster nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_cluster_operators</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#8f5902;font-style:italic"># Set to True for cerberus to monitor cluster operators. Parameter is optional, will set to True if not specified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_url_routes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Route url&#39;s you want to monitor</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- - <span style="color:#000">https://...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">Bearer ****                                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This parameter is optional, specify authorization need for get call to route</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- - <span style="color:#000">http://...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_master_schedulable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># When enabled checks for the schedulable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                                     </span><span style="color:#000">master nodes with given label.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">label</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-role.kubernetes.io/master</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watch_namespaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># List of namespaces to be monitored</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-etcd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-monitoring</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-machine-api</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-ingress</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#000">openshift-sdn</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cerberus_publish_status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus starts a light weight http server and publishes the status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">inspect_components</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#8f5902;font-style:italic"># Enable it only when OpenShift client is supported to run.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus collects logs, events and metrics of failed components</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">prometheus_url</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                      </span><span style="color:#8f5902;font-style:italic"># The prometheus url/route is automatically obtained in case of OpenShift, please set it when the distribution is Kubernetes.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">prometheus_bearer_token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                             </span><span style="color:#8f5902;font-style:italic"># The bearer token is automatically obtained in case of OpenShift, please set it when the distribution is Kubernetes. This is needed to authenticate with prometheus.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># This enables Cerberus to query prometheus and alert on observing high Kube API Server latencies.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">slack_integration</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                             </span><span style="color:#8f5902;font-style:italic"># When enabled, cerberus reports status of failed iterations in the slack channel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># The following env vars need to be set: SLACK_API_TOKEN ( Bot User OAuth Access Token ) and SLACK_CHANNEL ( channel to send notifications in case of failures )</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                                         </span><span style="color:#8f5902;font-style:italic"># When slack_integration is enabled, a watcher can be assigned for each day. The watcher of the day is tagged while reporting failures in the slack channel. Values are slack member ID&#39;s.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watcher_slack_ID:                                        # (NOTE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Defining the watcher id&#39;s is optional and when the watcher slack id&#39;s are not defined, the slack_team_alias tag is used if it is set else no tag is used while reporting failures in the slack channel.)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Monday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Tuesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Wednesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Thursday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Friday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Saturday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Sunday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">slack_team_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># The slack team alias to be tagged while reporting failures in the slack channel when no watcher is assigned</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">custom_checks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                       </span><span style="color:#8f5902;font-style:italic"># Relative paths of files conataining additional user defined checks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">custom_checks/custom_check_sample.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">custom_check.py</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">tunings</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">iterations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">                                        </span><span style="color:#8f5902;font-style:italic"># Iterations to loop before stopping the watch, it will be replaced with infinity when the daemon mode is enabled</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">sleep_time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">                                       </span><span style="color:#8f5902;font-style:italic"># Sleep duration between each iteration</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">kube_api_request_chunk_size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">250</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># Large requests will be broken into the specified chunk size to reduce the load on API server and improve responsiveness.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">daemon_mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">True</span><span style="color:#f8f8f8;text-decoration:underline">                                    </span><span style="color:#8f5902;font-style:italic"># Iterations are set to infinity which means that the cerberus will monitor the resources forever</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cores_usage_percentage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># Set the fraction of cores to be used for multiprocessing</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">database_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/tmp/cerberus.db                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Path where cerberus database needs to be stored</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">reuse_database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">False</span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#8f5902;font-style:italic"># When enabled, the database is reused to store the failures</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    watch_namespaces support regex patterns. Any valid regex pattern can be used to watch all the namespaces matching the regex pattern. For example, <code>^openshift-.*$</code> can be used to watch all namespaces that start with <code>openshift-</code> or <code>openshift</code> can be used to watch all namespaces that have <code>openshift</code> in it.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The current implementation can monitor only one cluster from one host. It can be used to monitor multiple clusters provided multiple instances of Cerberus are launched on different hosts.

</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The components especially the namespaces needs to be changed depending on the distribution i.e Kubernetes or OpenShift. The default specified in the config assumes that the distribution is OpenShift. A config file for Kubernetes is located at config/kubernetes_config.yaml

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-757a8dd261ba40e0ca5b0593378a7086">5.5 - Alerts</h1>
    
	<p>Cerberus consumes the metrics from Prometheus deployed on the cluster to report the alerts.</p>
<p>When provided the prometheus url and bearer token in the config, Cerberus reports the following alerts:</p>
<ul>
<li>
<p>KubeAPILatencyHigh: alerts at the end of each iteration and warns if 99th percentile latency for given requests to the kube-apiserver is above 1 second. It is the official SLI/SLO defined for Kubernetes.</p>
</li>
<li>
<p>High number of etcd leader changes: alerts the user when an increase in etcd leader changes are observed on the cluster. Frequent elections may be a sign of insufficient resources, high network latency, or disruptions by other components and should be investigated.</p>
</li>
</ul>
<p><strong>NOTE</strong>: The prometheus url and bearer token are automatically picked from the cluster if the distribution is OpenShift since it&rsquo;s the default metrics solution. In case of Kubernetes, they need to be provided in the config if prometheus is deployed.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b190bfdc5464d39eeebf07936769c72a">5.6 - Node Problem Detector</h1>
    
	<p><a href="https://github.com/kubernetes/node-problem-detector">node-problem-detector</a> aims to make various node problems visible to the upstream layers in cluster management stack.</p>
<h3 id="installation">Installation<a class="td-heading-self-link" href="#installation" aria-label="Heading self-link"></a></h3>
<p>Please follow the instructions in the <a href="https://github.com/kubernetes/node-problem-detector#installation">installation</a> section to setup Node Problem Detector on Kubernetes. The following instructions are setting it up on OpenShift:</p>
<ol>
<li>Create <code>openshift-node-problem-detector</code> namespace <a href="https://github.com/openshift/node-problem-detector-operator/blob/master/deploy/ns.yaml">ns.yaml</a> with        <code>oc create -f ns.yaml</code></li>
<li>Add cluster role with <code>oc adm policy add-cluster-role-to-user system:node-problem-detector -z default -n openshift-node-problem-detector</code></li>
<li>Add security context constraints with <code>oc adm policy add-scc-to-user privileged system:serviceaccount:openshift-node-problem-detector:default </code></li>
<li>Edit <a href="https://github.com/kubernetes/node-problem-detector/blob/master/deployment/node-problem-detector.yaml">node-problem-detector.yaml</a> to fit your environment.</li>
<li>Edit <a href="https://github.com/kubernetes/node-problem-detector/blob/master/deployment/node-problem-detector-config.yaml">node-problem-detector-config.yaml</a> to configure node-problem-detector.</li>
<li>Create the ConfigMap with    <code>oc create -f node-problem-detector-config.yaml</code></li>
<li>Create the DaemonSet with <code>oc create -f node-problem-detector.yaml</code></li>
</ol>
<p>Once installed you will see node-problem-detector pods in openshift-node-problem-detector namespace.
Now enable openshift-node-problem-detector in the <a href="https://github.com/openshift-scale/cerberus/blob/master/config/config.yaml">config.yaml</a>.
Cerberus just monitors <code>KernelDeadlock</code> condition provided by the node problem detector as it is system critical and can hinder node performance.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f6d34f30535049c05bb8b5e73a3d5b92">5.7 - Slack Integration</h1>
    
	<p>The user has the option to enable/disable the slack integration ( disabled by default ). To use the slack integration, the user has to first create an <a href="https://api.slack.com/apps?new_granular_bot_app=1">app</a> and add a bot to it on slack. SLACK_API_TOKEN and SLACK_CHANNEL environment variables have to be set. SLACK_API_TOKEN refers to Bot User OAuth Access Token and SLACK_CHANNEL refers to the slack channel ID the user wishes to receive the notifications. Make sure the Slack Bot Token Scopes contains this permission [calls:read] [channels:read] [chat:write] [groups:read] [im:read] [mpim:read]</p>
<ul>
<li>Reports when cerberus starts monitoring a cluster in the specified slack channel.</li>
<li>Reports the component failures in the slack channel.</li>
<li>A watcher can be assigned for each day of the week. The watcher of the day is tagged while reporting failures in the slack channel instead of everyone. (NOTE: Defining the watcher id&rsquo;s is optional and when the watcher slack id&rsquo;s are not defined, the slack_team_alias tag is used if it is set else no tag is used while reporting failures in the slack channel.)</li>
</ul>
<h4 id="go-or-no-go-signal">Go or no-go signal<a class="td-heading-self-link" href="#go-or-no-go-signal" aria-label="Heading self-link"></a></h4>
<p>When the cerberus is configured to run in the daemon mode, it will continuosly monitor the components specified, runs a simple http server at http://0.0.0.0:8080 and publishes the signal i.e True or False depending on the components status. The tools can consume the signal and act accordingly.</p>
<h4 id="failures-in-a-time-window">Failures in a time window<a class="td-heading-self-link" href="#failures-in-a-time-window" aria-label="Heading self-link"></a></h4>
<ol>
<li>The failures in the past 1 hour can be retrieved in the json format by visiting http://0.0.0.0:8080/history.</li>
<li>The failures in a specific time window can be retrieved in the json format by visiting http://0.0.0.0:8080/history?loopback=<interval>.</li>
<li>The failures between two time timestamps, the failures of specific issues types and the failures related to specific components can be retrieved in the json format by visiting http://0.0.0.0:8080/analyze url. The filters have to be applied to scrape the failures accordingly.</li>
</ol>
<h4 id="sample-slack-config">Sample Slack Config<a class="td-heading-self-link" href="#sample-slack-config" aria-label="Heading self-link"></a></h4>
<p>This is a snippet of how would your slack config could look like within your <code>cerberus_config.yaml</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">watcher_slack_ID</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Monday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">U1234ABCD  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># replace with your Slack ID from Profile-&gt; More -&gt; Copy Member ID</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Tuesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Same or different ID can be used for remaining days depending on who you want to tag</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Wednesday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Thursday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Friday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Saturday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">Sunday</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">slack_team_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span>@<span style="color:#000">group_or_team_id</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6c4f8214a4098b69dd33dbf386bacb8a">5.8 - Contribute</h1>
    
	<h3 id="how-to-contribute">How to contribute<a class="td-heading-self-link" href="#how-to-contribute" aria-label="Heading self-link"></a></h3>
<p>Contributions are always appreciated.</p>
<p>How to:</p>
<ul>
<li><a href="/docs/cerberus/contribute/#pull-request">Submit Pull Request</a></li>
<li><a href="/docs/cerberus/contribute/#fix-formatting">Fix Formatting</a></li>
<li><a href="/docs/cerberus/contribute/#squash-commits">Squash Commits</a></li>
</ul>
<h2 id="pull-request">Pull request<a class="td-heading-self-link" href="#pull-request" aria-label="Heading self-link"></a></h2>
<p>In order to submit a change or a PR, please fork the project and follow instructions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git clone http://github.com/&lt;me&gt;/cerberus
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">cd</span> cerberus
</span></span><span style="display:flex;"><span>$ git checkout -b &lt;branch_name&gt;
</span></span><span style="display:flex;"><span>$ &lt;make change&gt;
</span></span><span style="display:flex;"><span>$ git add &lt;changes&gt;
</span></span><span style="display:flex;"><span>$ git commit -a
</span></span><span style="display:flex;"><span>$ &lt;insert good message&gt;
</span></span><span style="display:flex;"><span>$ git push
</span></span></code></pre></div><h2 id="fix-formatting">Fix Formatting<a class="td-heading-self-link" href="#fix-formatting" aria-label="Heading self-link"></a></h2>
<p>Cerberus uses <a href="https://pre-commit.com">pre-commit</a> framework to maintain the code linting and python code styling.
The CI would run the pre-commit check on each pull request.
We encourage our contributors to follow the same pattern, while contributing to the code.</p>
<p>The pre-commit configuration file is present in the repository <code>.pre-commit-config.yaml</code>
It contains the different code styling and linting guide which we use for the application.</p>
<p>Following command can be used to run the pre-commit:
<code>pre-commit run --all-files</code></p>
<p>If pre-commit is not installed in your system, it can be install with : <code>pip install pre-commit</code></p>
<h2 id="squash-commits">Squash Commits<a class="td-heading-self-link" href="#squash-commits" aria-label="Heading self-link"></a></h2>
<p>If there are mutliple commits, please rebase/squash multiple commits
before creating the PR by following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git checkout &lt;my-working-branch&gt;
</span></span><span style="display:flex;"><span>$ git rebase -i HEAD~&lt;num_of_commits_to_merge&gt;
</span></span><span style="display:flex;"><span>   -OR-
</span></span><span style="display:flex;"><span>$ git rebase -i &lt;commit_id_of_first_change_commit&gt;
</span></span></code></pre></div><p>In the interactive rebase screen, set the first commit to <code>pick</code> and all others to <code>squash</code> (or whatever else you may need to do).</p>
<p>Push your rebased commits (you may need to force), then issue your PR.</p>
<pre tabindex="0"><code>$ git push origin &lt;my-working-branch&gt; --force
</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e28bedba0f169b3cc306e40f3a990286">6 - Chaos Recommendation Tool</h1>
    
	<p>This tool, designed for Redhat Kraken, operates through the command line and offers recommendations for chaos testing. It suggests probable chaos test cases that can disrupt application services by analyzing their behavior and assessing their susceptibility to specific fault types.</p>
<p>This tool profiles an application and gathers telemetry data such as CPU, Memory, and Network usage, analyzing it to suggest probable chaos scenarios. For optimal results, it is recommended to activate the utility while the application is under load.</p>
<h2 id="pre-requisites">Pre-requisites<a class="td-heading-self-link" href="#pre-requisites" aria-label="Heading self-link"></a></h2>
<ul>
<li>Openshift Or Kubernetes Environment where the application is hosted</li>
<li>Access to the metrics via the exposed Prometheus endpoint</li>
<li>Python3.9</li>
</ul>
<h2 id="usage">Usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h2>
<ol>
<li>
<p>To run</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ python3.9 -m venv chaos
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">source</span> chaos/bin/activate
</span></span><span style="display:flex;"><span>$ git clone https://github.com/krkn-chaos/krkn.git 
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">cd</span> krkn
</span></span><span style="display:flex;"><span>$ pip3 install -r requirements.txt
</span></span><span style="display:flex;"><span>Edit configuration file:
</span></span><span style="display:flex;"><span>$ vi config/recommender_config.yaml 
</span></span><span style="display:flex;"><span>$ python3.9 utils/chaos_recommender/chaos_recommender.py -c utils/chaos_recommender/recommender_config.yaml
</span></span></code></pre></div></li>
<li>
<p>Follow the prompts to provide the required information.</p>
</li>
</ol>
<h2 id="configuration">Configuration<a class="td-heading-self-link" href="#configuration" aria-label="Heading self-link"></a></h2>
<p>To run the recommender with a config file specify the config file path with the <code>-c</code> argument.
You can customize the default values by editing the <code>recommender_config.yaml</code> file. The configuration file contains the following options:</p>
<ul>
<li><code>application</code>: Specify the application name.</li>
<li><code>namespaces</code>: Specify the namespaces names (separated by coma or space). If you want to profile</li>
<li><code>labels</code>: Specify the labels (not used).</li>
<li><code>kubeconfig</code>: Specify the location of the kubeconfig file (not used).</li>
<li><code>prometheus_endpoint</code>: Specify the prometheus endpoint (must).</li>
<li><code>auth_token</code>: Auth token to connect to prometheus endpoint (must).</li>
<li><code>scrape_duration</code>: For how long data should be fetched, e.g., &lsquo;1m&rsquo; (must).</li>
<li><code>chaos_library</code>: &ldquo;kraken&rdquo; (currently it only supports kraken).</li>
<li><code>json_output_file</code>: True or False (by default False).</li>
<li><code>json_output_folder_path</code>: Specify folder path where output should be saved. If empty the default path is used.</li>
<li><code>chaos_tests</code>: (for output purpose only do not change if not needed)
<ul>
<li><code>GENERAL</code>: list of general purpose tests available in Krkn</li>
<li><code>MEM</code>: list of memory related tests available in Krkn</li>
<li><code>NETWORK</code>: list of network related tests available in Krkn</li>
<li><code>CPU</code>: list of memory related tests available in Krkn</li>
</ul>
</li>
<li><code>threshold</code>: Specify the threshold to use for comparison and identifying outliers</li>
<li><code>cpu_threshold</code>: Specify the cpu threshold to compare with the cpu limits set on the pods and identify outliers</li>
<li><code>mem_threshold</code>: Specify the memory threshold to compare with the memory limits set on the pods and identify outliers</li>
</ul>
<p><em>TIP:</em> to collect prometheus endpoint and token from your OpenShift cluster you can run the following commands:
<code>prometheus_url=$(kubectl get routes -n openshift-monitoring prometheus-k8s --no-headers | awk '{print $2}') #TO USE YOUR CURRENT SESSION TOKEN token=$(oc whoami -t) #TO CREATE A NEW TOKEN token=$(kubectl create token -n openshift-monitoring prometheus-k8s --duration=6h || oc sa new-token -n openshift-monitoring prometheus-k8s)</code></p>
<p>You can also provide the input values through command-line arguments launching the recommender with <code>-o</code> option:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  -o, --options         Evaluate <span style="color:#204a87">command</span> line options
</span></span><span style="display:flex;"><span>  -a APPLICATION, --application APPLICATION
</span></span><span style="display:flex;"><span>                        Kubernetes application name
</span></span><span style="display:flex;"><span>  -n NAMESPACES, --namespaces NAMESPACE
</span></span><span style="display:flex;"><span>                        Kubernetes application namespaces separated by space
</span></span><span style="display:flex;"><span>  -l LABELS, --labels LABELS
</span></span><span style="display:flex;"><span>                        Kubernetes application labels
</span></span><span style="display:flex;"><span>  -p PROMETHEUS_ENDPOINT, --prometheus-endpoint PROMETHEUS_ENDPOINT
</span></span><span style="display:flex;"><span>                        Prometheus endpoint URI
</span></span><span style="display:flex;"><span>  -k KUBECONFIG, --kubeconfig KUBECONFIG
</span></span><span style="display:flex;"><span>                        Kubeconfig path
</span></span><span style="display:flex;"><span>  -t TOKEN, --token TOKEN
</span></span><span style="display:flex;"><span>                        Kubernetes authentication token
</span></span><span style="display:flex;"><span>  -s SCRAPE_DURATION, --scrape-duration SCRAPE_DURATION
</span></span><span style="display:flex;"><span>                        Prometheus scrape duration
</span></span><span style="display:flex;"><span>  -i LIBRARY, --library LIBRARY
</span></span><span style="display:flex;"><span>                        Chaos library
</span></span><span style="display:flex;"><span>  -L LOG_LEVEL, --log-level LOG_LEVEL
</span></span><span style="display:flex;"><span>                        log level <span style="color:#ce5c00;font-weight:bold">(</span>DEBUG, INFO, WARNING, ERROR, CRITICAL
</span></span><span style="display:flex;"><span>  -J <span style="color:#ce5c00;font-weight:bold">[</span>FOLDER_PATH<span style="color:#ce5c00;font-weight:bold">]</span>, --json-output-file <span style="color:#ce5c00;font-weight:bold">[</span>FOLDER_PATH<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                        Create output file, the path to the folder can be specified, <span style="color:#204a87;font-weight:bold">if</span> not specified the default folder is used.
</span></span><span style="display:flex;"><span>  -M MEM <span style="color:#ce5c00;font-weight:bold">[</span>MEM ...<span style="color:#ce5c00;font-weight:bold">]</span>, --MEM MEM <span style="color:#ce5c00;font-weight:bold">[</span>MEM ...<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                        Memory related chaos tests <span style="color:#ce5c00;font-weight:bold">(</span>space separated list<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -C CPU <span style="color:#ce5c00;font-weight:bold">[</span>CPU ...<span style="color:#ce5c00;font-weight:bold">]</span>, --CPU CPU <span style="color:#ce5c00;font-weight:bold">[</span>CPU ...<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                        CPU related chaos tests <span style="color:#ce5c00;font-weight:bold">(</span>space separated list<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -N NETWORK <span style="color:#ce5c00;font-weight:bold">[</span>NETWORK ...<span style="color:#ce5c00;font-weight:bold">]</span>, --NETWORK NETWORK <span style="color:#ce5c00;font-weight:bold">[</span>NETWORK ...<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                        Network related chaos tests <span style="color:#ce5c00;font-weight:bold">(</span>space separated list<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  -G GENERIC <span style="color:#ce5c00;font-weight:bold">[</span>GENERIC ...<span style="color:#ce5c00;font-weight:bold">]</span>, --GENERIC GENERIC <span style="color:#ce5c00;font-weight:bold">[</span>GENERIC ...<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                        Memory related chaos tests <span style="color:#ce5c00;font-weight:bold">(</span>space separated list<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  --threshold THRESHOLD
</span></span><span style="display:flex;"><span>                        Threshold
</span></span><span style="display:flex;"><span>  --cpu_threshold CPU_THRESHOLD
</span></span><span style="display:flex;"><span>                        CPU threshold to compare with the cpu limits
</span></span><span style="display:flex;"><span>  --mem_threshold MEM_THRESHOLD
</span></span><span style="display:flex;"><span>                        Memory threshold to compare with the memory limits
</span></span></code></pre></div><p>If you provide the input values through command-line arguments, the corresponding config file inputs would be ignored.</p>
<h2 id="podman--docker-image">Podman &amp; Docker image<a class="td-heading-self-link" href="#podman--docker-image" aria-label="Heading self-link"></a></h2>
<p>To run the recommender image please visit the <a href="/docs/installation/krkn-hub/">krkn-hub</a> for further infos.</p>
<h2 id="how-it-works">How it works<a class="td-heading-self-link" href="#how-it-works" aria-label="Heading self-link"></a></h2>
<p>After obtaining telemetry data, sourced either locally or from Prometheus, the tool conducts a comprehensive data analysis to detect anomalies. Employing the Z-score method and heatmaps, it identifies outliers by evaluating CPU, memory, and network usage against established limits. Services with Z-scores surpassing a specified threshold are categorized as outliers. This categorization classifies services as network, CPU, or memory-sensitive, consequently leading to the recommendation of relevant test cases.</p>
<h2 id="customizing-thresholds-and-options">Customizing Thresholds and Options<a class="td-heading-self-link" href="#customizing-thresholds-and-options" aria-label="Heading self-link"></a></h2>
<p>You can customize the thresholds and options used for data analysis and identifying the outliers by setting the threshold, cpu_threshold and mem_threshold parameters in the config.</p>
<h2 id="additional-files">Additional Files<a class="td-heading-self-link" href="#additional-files" aria-label="Heading self-link"></a></h2>
<ul>
<li><code>recommender_config.yaml</code>: The configuration file containing default values for application, namespace, labels, and kubeconfig.</li>
</ul>
<p>Happy Chaos!</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-99a93ef9534d11fef4be3e4b3b1a6381">7 - Contribution Guidelines</h1>
    
	<h3 id="adding-new-scenariostesting-changes">Adding New Scenarios/Testing Changes<a class="td-heading-self-link" href="#adding-new-scenariostesting-changes" aria-label="Heading self-link"></a></h3>
<p>Refer to the 2 docs below to be able to test your own images with any changes and be able to contribute them to the repository</p>
<ul>
<li><a href="/docs/contribution-guidelines/testing-changes/">Testing Your Changes</a></li>
<li><a href="/docs/contribution-guidelines/contribute/">Contribute</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-cb673d42652e2dadae972711a10addab">7.1 - Testing your changes</h1>
    
	<h1 id="how-to-test-your-changesadditions">How to Test Your Changes/Additions<a class="td-heading-self-link" href="#how-to-test-your-changesadditions" aria-label="Heading self-link"></a></h1>
<h2 id="install-podmandocker-compose">Install Podman/Docker Compose<a class="td-heading-self-link" href="#install-podmandocker-compose" aria-label="Heading self-link"></a></h2>
<p>You can use either podman-compose or docker-compose for this step</p>
<p><strong>NOTE:</strong> Podman might not work on Mac&rsquo;s</p>
<p><code>pip3 install docker-compose</code></p>
<p>OR</p>
<p>To get latest podman-compose features we need, use this installation command</p>
<p><code>pip3 install https://github.com/containers/podman-compose/archive/devel.tar.gz</code></p>
<h2 id="current-list-of-scenario-types">Current list of Scenario Types<a class="td-heading-self-link" href="#current-list-of-scenario-types" aria-label="Heading self-link"></a></h2>
<p>Scenario Types:</p>
<ul>
<li>pod-scenarios</li>
<li>node-scenarios</li>
<li>zone-outages</li>
<li>time-scenarios</li>
<li>cerberus</li>
<li>cluster-shutdown</li>
<li>container-scenarios</li>
<li>node-cpu-hog</li>
<li>node-io-hog</li>
<li>node-memory-hog</li>
<li>application-outages</li>
</ul>
<h2 id="adding-a-new-scenario">Adding a New Scenario<a class="td-heading-self-link" href="#adding-a-new-scenario" aria-label="Heading self-link"></a></h2>
<ol>
<li>
<p>Create folder with scenario name</p>
</li>
<li>
<p>Create generic scenario template with enviornment variables</p>
<p>a. See <a href="../application-outages/app_outages.yaml.template">scenario.yaml</a> for example</p>
<p>b. Almost all parameters should be set using a variable (these will be set in the env.sh file or through the command line environment variables)</p>
</li>
<li>
<p>Add defaults for any environment variables in an &ldquo;env.sh&rdquo; file</p>
<p>a.  See <a href="../application-outages/env.sh">env.sh</a> for example</p>
</li>
<li>
<p>Create script to run.sh chaos scenario
a. See <a href="../application-outages/run.sh">run.sh</a> for example</p>
<p>b. edit line 16 with your scenario yaml template</p>
<p>c. edit line 17 and 23 with your yaml config location</p>
</li>
<li>
<p>Create Dockerfile template</p>
<p>a. See <a href="../application-outages/Dockerfile.template">dockerfile</a> for example</p>
<p>b. Lines to edit</p>
<pre><code> i. 15: replace &quot;application-outages&quot; with your folder name 

 ii. 17: replace &quot;application-outages&quot; with your folder name

 iii. 19: replace &quot;application-outages&quot; with your folder name and config file name 
</code></pre>
</li>
<li>
<p>Add service/scenario to <a href="/docker-compose.yaml">docker-compose.yaml</a> file following syntax of other services</p>
</li>
<li>
<p>Point the dockerfile parameter in your docker-compose to the Dockerfile file in your new folder</p>
</li>
<li>
<p>Update this doc and main README with new scenario type</p>
</li>
<li>
<p>Add CI test for new scenario</p>
<p>a. See <a href="../CI/tests/test_application_outages.sh">test_application_outages.sh</a> for example</p>
<p>b. Lines to change</p>
<pre><code> i. 14 and 31: Give a new function name 

 ii.  19: Give it a meaningful container name

 iii. Edit line 20 to give scenario type defined in docker-compose file 
</code></pre>
<p>c. Add test name to <a href="../CI/tests/all_tests">all_tests</a> file</p>
</li>
</ol>
<p>NOTE:</p>
<ol>
<li>If you added any variables or new sections be sure to update <a href="../config.yaml.template">config.yaml.template</a></li>
<li>Similar to above, also add the default parameter values to <a href="../env.sh">env.sh</a></li>
</ol>
<h2 id="build-your-changes">Build Your Changes<a class="td-heading-self-link" href="#build-your-changes" aria-label="Heading self-link"></a></h2>
<ol>
<li>Run <a href="../build.sh">build.sh</a> to get Dockerfiles for each scenario</li>
<li>Edit the docker-compose.yaml file to point to your quay.io repository (optional)</li>
<li>Build your image(s) from base kraken-hub directory</li>
</ol>
<p>Builds all images in docker-compose file
<code>docker-compose build</code></p>
<p>Builds single image defined by service/scenario name
<code>docker-compose build &lt;scenario_type&gt;</code></p>
<p>OR</p>
<p>Builds all images in podman-compose file
<code>podman-compose build</code></p>
<p>Builds single image defined by service/scenario name
<code>podman-compose build &lt;scenario_type&gt;</code></p>
<h2 id="push-images-to-your-quayio">Push Images to your quay.io<a class="td-heading-self-link" href="#push-images-to-your-quayio" aria-label="Heading self-link"></a></h2>
<p>All Images
<code>docker image push --all-tags quay.io/&lt;username&gt;/kraken-hub</code></p>
<p>Single image
<code>docker image push quay.io/&lt;username&gt;/kraken-hub:&lt;scenario_type&gt;</code></p>
<p>OR</p>
<p>Single Image (have to go one by one to push images through podman)
<code>podman image push quay.io/&lt;username&gt;/kraken-hub:&lt;scenario_type&gt;</code></p>
<h2 id="run-your-scenario">Run your scenario<a class="td-heading-self-link" href="#run-your-scenario" aria-label="Heading self-link"></a></h2>
<p><code>docker run -d -v &lt;kube_config_path&gt;:/root/.kube/config:Z quay.io/&lt;username&gt;/kraken-hub:&lt;scenario_type&gt;</code></p>
<p>OR</p>
<p><code>podman run -d -v &lt;kube_config_path&gt;:/root/.kube/config:Z quay.io/&lt;username&gt;/kraken-hub:&lt;scenario_type&gt;</code></p>
<h2 id="follow-contribute-guide">Follow Contribute guide<a class="td-heading-self-link" href="#follow-contribute-guide" aria-label="Heading self-link"></a></h2>
<p>Once all you&rsquo;re happy with your changes, follow the <a href="/docs/contribution-guidelines/testing-changes/#docs/contribute.md">contribution</a> guide on how to create your own branch and squash your commits</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-17ea1d6a1e6627d08a7d6f4d2898cca1">7.2 - Contributions</h1>
    
	<h1 id="how-to-contribute">How to contribute<a class="td-heading-self-link" href="#how-to-contribute" aria-label="Heading self-link"></a></h1>
<p>Contributions are always appreciated.</p>
<p>How to:</p>
<ul>
<li><a href="/docs/contribution-guidelines/contribute/#pull-request">Submit Pull Request</a></li>
<li><a href="/docs/contribution-guidelines/contribute/#squash-commits">Squash Commits</a></li>
</ul>
<h2 id="pull-request">Pull request<a class="td-heading-self-link" href="#pull-request" aria-label="Heading self-link"></a></h2>
<p>In order to submit a change or a PR, please fork the project and follow instructions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git clone http://github.com/&lt;me&gt;/kraken-hub
</span></span><span style="display:flex;"><span>$ <span style="color:#204a87">cd</span> kraken-hub
</span></span><span style="display:flex;"><span>$ git checkout -b &lt;branch_name&gt;
</span></span><span style="display:flex;"><span>$ &lt;make change&gt;
</span></span><span style="display:flex;"><span>$ git add &lt;changes&gt;
</span></span><span style="display:flex;"><span>$ git commit -a
</span></span><span style="display:flex;"><span>$ &lt;insert good message&gt;
</span></span><span style="display:flex;"><span>$ git push
</span></span></code></pre></div><h2 id="squash-commits">Squash Commits<a class="td-heading-self-link" href="#squash-commits" aria-label="Heading self-link"></a></h2>
<p>If there are mutliple commits, please rebase/squash multiple commits
before creating the PR by following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git checkout &lt;my-working-branch&gt;
</span></span><span style="display:flex;"><span>$ git rebase -i HEAD~&lt;num_of_commits_to_merge&gt;
</span></span><span style="display:flex;"><span>   -OR-
</span></span><span style="display:flex;"><span>$ git rebase -i &lt;commit_id_of_first_change_commit&gt;
</span></span></code></pre></div><p>In the interactive rebase screen, set the first commit to <code>pick</code> and all others to <code>squash</code> (or whatever else you may need to do).</p>
<p>Push your rebased commits (you may need to force), then issue your PR.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ git push origin &lt;my-working-branch&gt; --force
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0021252844b4e6fe46ed5340a858b6d3">8 - Krkn Roadmap</h1>
    
	<p>Following are a list of enhancements that we are planning to work on adding support in Krkn. Of course any help/contributions are greatly appreciated.</p>
<ul>
<li><input disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/424">Ability to run multiple chaos scenarios in parallel under load to mimic real world outages</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/423">Centralized storage for chaos experiments artifacts</a></li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/394">Support for causing DNS outages</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/tree/main/utils/chaos-recommender">Chaos recommender</a> to suggest scenarios having probability of impacting the service under test using profiling results</li>
<li><input disabled="" type="checkbox"> Chaos AI integration to improve test coverage while reducing fault space to save costs and execution time</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/393">Support for pod level network traffic shaping</a></li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/124">Ability to visualize the metrics that are being captured by Kraken and stored in Elasticsearch</a></li>
<li><input checked="" disabled="" type="checkbox"> Support for running all the scenarios of Kraken on Kubernetes distribution - see <a href="https://github.com/krkn-chaos/krkn/issues/185">https://github.com/krkn-chaos/krkn/issues/185</a>, <a href="https://github.com/redhat-chaos/krkn/issues/186">https://github.com/redhat-chaos/krkn/issues/186</a></li>
<li><input checked="" disabled="" type="checkbox"> Continue to improve <a href="https://krkn-chaos.github.io/krkn">Chaos Testing Guide</a> in terms of adding best practices, test environment recommendations and scenarios to make sure the OpenShift platform, as well the applications running on top it, are resilient and performant under chaotic conditions.</li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/495">Switch documentation references to Kubernetes</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krkn/issues/497">OCP and Kubernetes functionalities segregation</a></li>
<li><input checked="" disabled="" type="checkbox"> <a href="https://github.com/krkn-chaos/krknctl">Krknctl - client for running Krkn scenarios with ease</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d39a8a737bc5c13f36e41aa92a0c7602">9 - </h1>
    
	<h3 id="config">Config<a class="td-heading-self-link" href="#config" aria-label="Heading self-link"></a></h3>
<p>Set the scenarios to inject and the tunings like duration to wait between each scenario in the config file located at <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml">config/config.yaml</a>.</p>
<p><strong>NOTE</strong>: <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config_performance.yaml">config</a> can be used if leveraging the <a href="https://github.com/redhat-chaos/krkn#setting-up-infrastructure-dependencies">automated way</a> to install the infrastructure pieces.</p>
<p>Config components:</p>
<ul>
<li><a href="/docs/config/#kraken">Kraken</a></li>
<li><a href="/docs/config/#cerberus">Cerberus</a></li>
<li><a href="/docs/config/#performance-monitoring">Performance Monitoring</a></li>
<li><a href="/docs/config/#tunings">Tunings</a></li>
</ul>
<h1 id="kraken">Kraken<a class="td-heading-self-link" href="#kraken" aria-label="Heading self-link"></a></h1>
<p>This section defines scenarios and specific data to the chaos run</p>
<h2 id="distribution">Distribution<a class="td-heading-self-link" href="#distribution" aria-label="Heading self-link"></a></h2>
<p>Either <strong>openshift</strong> or <strong>kubernetes</strong> depending on the type of cluster you want to run chaos on.
The prometheus url/route and bearer token are automatically obtained in case of OpenShift, please set it when the distribution is Kubernetes.</p>
<h2 id="exit-on-failure">Exit on failure<a class="td-heading-self-link" href="#exit-on-failure" aria-label="Heading self-link"></a></h2>
<p><strong>exit_on_failure</strong>:  Exit when a post action check or cerberus run fails</p>
<h2 id="publish-kraken-status">Publish kraken status<a class="td-heading-self-link" href="#publish-kraken-status" aria-label="Heading self-link"></a></h2>
<p><strong>publish_kraken_status</strong>: Can be accessed at http://0.0.0.0:8081 (or what signal_address and port you set in signal address section)
<strong>signal_state</strong>: State you want kraken to start at; will wait for the RUN signal to start running a chaos iteration. When set to PAUSE before running the scenarios, refer to <a href="/docs/signal/">signal.md</a> for more details</p>
<h2 id="signal-address">Signal Address<a class="td-heading-self-link" href="#signal-address" aria-label="Heading self-link"></a></h2>
<p><strong>signal_address</strong>: Address to listen/post the signal state to
<strong>port</strong>: port to listen/post the signal state to</p>
<h2 id="chaos-scenarios">Chaos Scenarios<a class="td-heading-self-link" href="#chaos-scenarios" aria-label="Heading self-link"></a></h2>
<p><strong>chaos_scenarios</strong>: List of different types of chaos scenarios you want to run with paths to their specific yaml file configurations</p>
<p>If a scenario has a post action check script, it will be run before and after each scenario to validate the component under test starts and ends at the same state</p>
<p>Currently the scenarios are run one after another (in sequence) and will exit if one of the scenarios fail, without moving onto the next one</p>
<p>Chaos scenario types:</p>
<ul>
<li>container_scenarios</li>
<li>plugin_scenarios</li>
<li>node_scenarios</li>
<li>time_scenarios</li>
<li>cluster_shut_down_scenarios</li>
<li>namespace_scenarios</li>
<li>zone_outages</li>
<li>application_outages</li>
<li>pvc_scenarios</li>
<li>network_chaos</li>
</ul>
<h1 id="cerberus">Cerberus<a class="td-heading-self-link" href="#cerberus" aria-label="Heading self-link"></a></h1>
<p>Parameters to set for enabling of cerberus checks at the end of each executed scenario. The given url will pinged after the scenario and post action check have been completed for each scenario and iteration.
<strong>cerberus_enabled</strong>: Enable it when cerberus is previously installed
<strong>cerberus_url</strong>: When cerberus_enabled is set to True, provide the url where cerberus publishes go/no-go signal
<strong>check_applicaton_routes</strong>:  When enabled will look for application unavailability using the routes specified in the cerberus config and fails the run</p>
<h1 id="performance-monitoring">Performance Monitoring<a class="td-heading-self-link" href="#performance-monitoring" aria-label="Heading self-link"></a></h1>
<p>There are 2 main sections defined in this part of the config <a href="metrics.md">metrics</a> and <a href="alerts.md">alerts</a>; read more about each of these configurations in their respective docs</p>
<h1 id="tunings">Tunings<a class="td-heading-self-link" href="#tunings" aria-label="Heading self-link"></a></h1>
<p><strong>wait_duration</strong>: Duration to wait between each chaos scenario
<strong>iterations</strong>: Number of times to execute the scenarios
<strong>daemon_mode</strong>: True or False; If true, iterations are set to infinity which means that the kraken will cause chaos forever and number of iterations is ignored</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a39c9f7aa728d5fa3b973bc6ba49228a">10 - </h1>
    
	<h2 id="getting-started-running-chaos-scenarios">Getting Started Running Chaos Scenarios<a class="td-heading-self-link" href="#getting-started-running-chaos-scenarios" aria-label="Heading self-link"></a></h2>
<h4 id="adding-new-scenarios">Adding New Scenarios<a class="td-heading-self-link" href="#adding-new-scenarios" aria-label="Heading self-link"></a></h4>
<p>Adding a new scenario is as simple as adding a new config file under <a href="https://github.com/redhat-chaos/krkn/tree/main/scenarios">scenarios directory</a> and defining it in the main kraken <a href="https://github.com/redhat-chaos/krkn/blob/main/config/config.yaml#L8">config</a>.
You can either copy an existing yaml file and make it your own, or fill in one of the templates below to suit your needs.</p>
<h3 id="templates">Templates<a class="td-heading-self-link" href="#templates" aria-label="Heading self-link"></a></h3>
<h4 id="pod-scenario-yaml-template">Pod Scenario Yaml Template<a class="td-heading-self-link" href="#pod-scenario-yaml-template" aria-label="Heading self-link"></a></h4>
<p>For example, for adding a pod level scenario for a new application, refer to the sample scenario below to know what fields are necessary and what to add in each location:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># yaml-language-server: $schema=../plugin.schema.json</span>
</span></span><span style="display:flex;"><span>- id: kill-pods
</span></span><span style="display:flex;"><span>  config:
</span></span><span style="display:flex;"><span>    namespace_pattern: ^&lt;namespace&gt;$
</span></span><span style="display:flex;"><span>    label_selector: &lt;pod label&gt;
</span></span><span style="display:flex;"><span>    kill: &lt;number of pods to kill&gt;
</span></span><span style="display:flex;"><span>    krkn_pod_recovery_time: &lt;expected <span style="color:#204a87">time</span> <span style="color:#204a87;font-weight:bold">for</span> the pod to become ready&gt;
</span></span></code></pre></div><h4 id="node-scenario-yaml-template">Node Scenario Yaml Template<a class="td-heading-self-link" href="#node-scenario-yaml-template" aria-label="Heading self-link"></a></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node_scenarios:
</span></span><span style="display:flex;"><span>  - actions:  <span style="color:#8f5902;font-style:italic"># Node chaos scenarios to be injected.</span>
</span></span><span style="display:flex;"><span>    - &lt;chaos scenario&gt;
</span></span><span style="display:flex;"><span>    - &lt;chaos scenario&gt;
</span></span><span style="display:flex;"><span>    node_name: &lt;node name&gt;  <span style="color:#8f5902;font-style:italic"># Can be left blank.</span>
</span></span><span style="display:flex;"><span>    label_selector: &lt;node label&gt;
</span></span><span style="display:flex;"><span>    instance_kill_count: &lt;number of nodes on which to perform action&gt;
</span></span><span style="display:flex;"><span>    timeout: &lt;duration to <span style="color:#204a87">wait</span> <span style="color:#204a87;font-weight:bold">for</span> completion&gt;
</span></span><span style="display:flex;"><span>    cloud_type: &lt;cloud provider&gt;
</span></span></code></pre></div><h4 id="time-chaos-scenario-template">Time Chaos Scenario Template<a class="td-heading-self-link" href="#time-chaos-scenario-template" aria-label="Heading self-link"></a></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>time_scenarios:
</span></span><span style="display:flex;"><span>  - action: <span style="color:#4e9a06">&#39;skew_time&#39;</span> or <span style="color:#4e9a06">&#39;skew_date&#39;</span>
</span></span><span style="display:flex;"><span>    object_type: <span style="color:#4e9a06">&#39;pod&#39;</span> or <span style="color:#4e9a06">&#39;node&#39;</span>
</span></span><span style="display:flex;"><span>    label_selector: &lt;label of pod or node&gt;
</span></span></code></pre></div><h3 id="common-scenario-edits">Common Scenario Edits<a class="td-heading-self-link" href="#common-scenario-edits" aria-label="Heading self-link"></a></h3>
<p>If you just want to make small changes to pre-existing scenarios, feel free to edit the scenario file itself.</p>
<h4 id="example-of-quick-pod-scenario-edit">Example of Quick Pod Scenario Edit:<a class="td-heading-self-link" href="#example-of-quick-pod-scenario-edit" aria-label="Heading self-link"></a></h4>
<p>If you want to kill 2 pods instead of 1 in any of the pre-existing scenarios, you can either edit the number located at filters -&gt; randomSample -&gt; size or the runs under the config -&gt; runStrategy section.</p>
<h4 id="example-of-quick-nodes-scenario-edit">Example of Quick Nodes Scenario Edit:<a class="td-heading-self-link" href="#example-of-quick-nodes-scenario-edit" aria-label="Heading self-link"></a></h4>
<p>If your cluster is build on GCP instead of AWS, just change the cloud type in the node_scenarios_example.yml file.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8b98cd9a1c9e3bb7243f12e47e925f13">11 - </h1>
    
	<h3 id="signaling-to-kraken">Signaling to Kraken<a class="td-heading-self-link" href="#signaling-to-kraken" aria-label="Heading self-link"></a></h3>
<p>This functionality allows a user to be able to pause or stop the kraken run at any time no matter the number of iterations or daemon_mode set in the config.</p>
<p>If publish_kraken_status is set to True in the config, kraken will start up a connection to a url at a certain port to decide if it should continue running.</p>
<p>By default, it will get posted to http://0.0.0.0:8081/</p>
<p>An example use case for this feature would be coordinating kraken runs based on the status of the service installation or load on the cluster.</p>
<h4 id="states">States<a class="td-heading-self-link" href="#states" aria-label="Heading self-link"></a></h4>
<p>There are 3 states in the kraken status:</p>
<p><code>PAUSE</code>: When the Kraken signal is &lsquo;PAUSE&rsquo;, this will pause the kraken test and wait for the wait_duration until the signal returns to RUN.</p>
<p><code>STOP</code>: When the Kraken signal is &lsquo;STOP&rsquo;, end the kraken run and print out report.</p>
<p><code>RUN</code>: When the Kraken signal is &lsquo;RUN&rsquo;, continue kraken run based on iterations.</p>
<h4 id="configuration">Configuration<a class="td-heading-self-link" href="#configuration" aria-label="Heading self-link"></a></h4>
<p>In the config you need to set these parameters to tell kraken which port to post the kraken run status to.
As well if you want to publish and stop running based on the kraken status or not.
The signal is set to <code>RUN</code> by default, meaning it will continue to run the scenarios. It can set to <code>PAUSE</code> for Kraken to act as listener and wait until set to <code>RUN</code> before injecting chaos.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    port: <span style="color:#0000cf;font-weight:bold">8081</span>
</span></span><span style="display:flex;"><span>    publish_kraken_status: True
</span></span><span style="display:flex;"><span>    signal_state: RUN
</span></span></code></pre></div><h4 id="setting-signal">Setting Signal<a class="td-heading-self-link" href="#setting-signal" aria-label="Heading self-link"></a></h4>
<p>You can reset the kraken status during kraken execution with a <code>set_stop_signal.py</code> script with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>import http.client as cli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> cli.HTTPConnection<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;0.0.0.0&#34;</span>, <span style="color:#4e9a06">&#34;&lt;port&gt;&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>conn.request<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;POST&#34;</span>, <span style="color:#4e9a06">&#34;/STOP&#34;</span>, <span style="color:#ce5c00;font-weight:bold">{})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># conn.request(&#39;POST&#39;, &#39;/PAUSE&#39;, {})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># conn.request(&#39;POST&#39;, &#39;/RUN&#39;, {})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">response</span> <span style="color:#ce5c00;font-weight:bold">=</span> conn.getresponse<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>print<span style="color:#ce5c00;font-weight:bold">(</span>response.read<span style="color:#ce5c00;font-weight:bold">()</span>.decode<span style="color:#ce5c00;font-weight:bold">())</span>
</span></span></code></pre></div><p>Make sure to set the correct port number in your set_stop_signal script.</p>
<h5 id="url-examples">Url Examples<a class="td-heading-self-link" href="#url-examples" aria-label="Heading self-link"></a></h5>
<p>To stop run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X POST http:/0.0.0.0:8081/STOP
</span></span></code></pre></div><p>To pause run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X POST http:/0.0.0.0:8081/PAUSE
</span></span></code></pre></div><p>To start running again:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X POST http:/0.0.0.0:8081/RUN
</span></span></code></pre></div>
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/krkn-chaos/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Slack" aria-label="Slack">
    <a target="_blank" rel="noopener" href="https://kubernetes.slack.com/archives/C05SFMHRWK1" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">The Krkn-Chaos authors</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
